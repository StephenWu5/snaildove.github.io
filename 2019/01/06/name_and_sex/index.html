<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-flash.min.css?v=1.0.2" rel="stylesheet">
  <script>
    (function(){
        if(''){
            if (prompt('please input password') !== ''){
                alert('false password！');
                history.back();
            }
        }
    })();
  </script>







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="kaggle," />





  <link rel="alternate" href="/atom.xml" title="SnailDove's blog" type="application/atom+xml" />






<meta name="description" content="本文用数据分析探索规律，效果好于一堆的随机森林和xgboost，超过参加这个比赛的很多ensemble模型，至少排在前306/10231（Top 3%），最终只选择name，sex，age，Ticket 4个特征，构建出新的特征，然后进行规则判断，即多个嵌套的if-else，再一次感受到了特征工程的强大。省了数据缺失弥补，其他繁琐的数据预处理，数据清洗，后续的调参和集成模型。另外，下一文将介绍">
<meta name="keywords" content="kaggle">
<meta property="og:type" content="article">
<meta property="og:title" content="kaggle首战Titanic 82.275%">
<meta property="og:url" content="https://snaildove.github.io/2019/01/06/name_and_sex/index.html">
<meta property="og:site_name" content="SnailDove&#39;s blog">
<meta property="og:description" content="本文用数据分析探索规律，效果好于一堆的随机森林和xgboost，超过参加这个比赛的很多ensemble模型，至少排在前306/10231（Top 3%），最终只选择name，sex，age，Ticket 4个特征，构建出新的特征，然后进行规则判断，即多个嵌套的if-else，再一次感受到了特征工程的强大。省了数据缺失弥补，其他繁琐的数据预处理，数据清洗，后续的调参和集成模型。另外，下一文将介绍">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/1548184260540.png">
<meta property="og:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_27_3.png">
<meta property="og:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_30_1.png">
<meta property="og:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_38_1.png">
<meta property="og:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_116_1.png">
<meta property="og:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_118_1.png">
<meta property="og:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_171_1.png">
<meta property="og:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_172_1.png">
<meta property="og:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_192_2.png">
<meta property="og:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_194_2.png">
<meta property="og:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_196_2.png">
<meta property="og:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_197_2.png">
<meta property="og:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_199_2.png">
<meta property="og:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_201_2.png">
<meta property="og:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_203_2.png">
<meta property="og:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_205_2.png">
<meta property="og:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_206_2.png">
<meta property="og:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_216_1.png">
<meta property="og:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_218_1.png">
<meta property="og:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_220_2.png">
<meta property="og:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_222_2.png">
<meta property="og:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_227_3.png">
<meta property="og:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_233_1.png">
<meta property="og:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_235_2.png">
<meta property="og:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_237_2.png">
<meta property="og:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_238_1.png">
<meta property="og:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_239_1.png">
<meta property="og:updated_time" content="2019-01-23T06:14:51.185Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="kaggle首战Titanic 82.275%">
<meta name="twitter:description" content="本文用数据分析探索规律，效果好于一堆的随机森林和xgboost，超过参加这个比赛的很多ensemble模型，至少排在前306/10231（Top 3%），最终只选择name，sex，age，Ticket 4个特征，构建出新的特征，然后进行规则判断，即多个嵌套的if-else，再一次感受到了特征工程的强大。省了数据缺失弥补，其他繁琐的数据预处理，数据清洗，后续的调参和集成模型。另外，下一文将介绍">
<meta name="twitter:image" content="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/1548184260540.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":5,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://snaildove.github.io/2019/01/06/name_and_sex/"/>





  <title>kaggle首战Titanic 82.275% | SnailDove's blog</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?9385c404e3043551a2c60f0d9b0b3113";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">SnailDove's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">蜗牛哥博客</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            Sitemap
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://snaildove.github.io/2019/01/06/name_and_sex/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="SnailDove">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SnailDove's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">kaggle首战Titanic 82.275%</h1>
        

        <div class="post-meta">
		  
            <i class="fa fa-thumb-tack"></i>
            <font color=7D26CD>sticky</font>
            <span class="post-meta-divider">|</span>
          
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-06T00:00:00+08:00">
                2019-01-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/中文/" itemprop="url" rel="index">
                    <span itemprop="name">中文</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-eye"></i>
                  <span class="post-meta-item-text">Hits</span>
              <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article</span>
                
                <span title="Words count in article">
                  16,974
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  98
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <script src="\assets\js\APlayer.min.js"> </script><p><img src="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/1548184260540.png" alt="1548184260540"></p>
<p>本文用数据分析探索规律，效果好于一堆的随机森林和xgboost，超过参加这个比赛的很多ensemble模型，至少排在前306/10231（Top 3%），最终只选择name，sex，age，Ticket 4个特征，构建出新的特征，然后进行规则判断，即多个嵌套的if-else，再一次感受到了特征工程的强大。省了数据缺失弥补，其他繁琐的数据预处理，数据清洗，后续的调参和集成模型。<br>另外，下一文将介绍Top2%方案，近期将会分享怎么XGBoost调参数跑这个比赛。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd <span class="comment">#数据分析</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np <span class="comment">#科学计算</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"><span class="keyword">import</span> pylab</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> LabelEncoder</span><br><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestRegressor</span><br><span class="line"></span><br><span class="line">sns.set_style(<span class="string">"whitegrid"</span>) </span><br><span class="line">%matplotlib inline</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dealWithNameFeature</span><span class="params">(dataset)</span>:</span></span><br><span class="line">    <span class="comment"># get Title feature</span></span><br><span class="line">    dataset[<span class="string">'Title'</span>] = dataset.Name.apply(<span class="keyword">lambda</span> x:getTitle(x))</span><br><span class="line">    <span class="comment"># get Surname feature</span></span><br><span class="line">    dataset[<span class="string">'Surname'</span>] = dataset.Name.apply(<span class="keyword">lambda</span> x: x.split(<span class="string">','</span>)[<span class="number">0</span>].strip())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSurnameGroupId</span><span class="params">(dataset)</span>:</span> </span><br><span class="line">    dataset[<span class="string">'SurnameGroupId'</span>] = dataset.apply(<span class="keyword">lambda</span> row : str(row.Surname + <span class="string">'-'</span> + str(row.Pclass) + <span class="string">'-'</span> + str(row.Embarked) + <span class="string">'-'</span> + str(row.Fare) + <span class="string">'-'</span> + row.Ticket[:<span class="number">-2</span>] + <span class="string">'__'</span>), axis = <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getTicketGroupId</span><span class="params">(dataset)</span>:</span>    </span><br><span class="line">    dataset[<span class="string">'TicketGroupId'</span>] = dataset.apply(<span class="keyword">lambda</span> row : str(str(row.Pclass) + <span class="string">'-'</span> + str(row.Embarked) + <span class="string">'-'</span> + str(row.Fare) + <span class="string">'-'</span> + row.Ticket), axis = <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSurnameGroupSize</span><span class="params">(dataset)</span>:</span> </span><br><span class="line">    surname_group_value_count = dataset.SurnameGroupId.value_counts()</span><br><span class="line">    dataset[<span class="string">'SurnameGroupSize'</span>] = dataset.apply(<span class="keyword">lambda</span> row : surname_group_value_count.loc[row.SurnameGroupId], axis=<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">addNanniesCousinsFriends</span><span class="params">(dataset, only_boy_female = False, verbose = False)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    @dataset</span></span><br><span class="line"><span class="string">    @only_boy_female: only adding solo boys and females to surname groups if only_boy_female is True</span></span><br><span class="line"><span class="string">                otherwise: adding solo passengers to surname groups</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">if</span> only_boy_female:</span><br><span class="line">        solo_passengers = dataset.loc[(dataset.SurnameGroupSize == <span class="number">1</span>) &amp; (index_boy | index_female)]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        solo_passengers = dataset.loc[(dataset.SurnameGroupSize == <span class="number">1</span>)]</span><br><span class="line">    <span class="keyword">if</span> verbose:</span><br><span class="line">        print(<span class="string">'Tottaly %d solo passengers satifies the condtions'</span> % solo_passengers.shape[<span class="number">0</span>])</span><br><span class="line">    nannies_cousins_firends = set()</span><br><span class="line">    count_nannies_cousins_firends = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> index, solo_passenger <span class="keyword">in</span> solo_passengers.iterrows():</span><br><span class="line">        items = dataset.loc[(dataset.TicketGroupId == solo_passenger.TicketGroupId) &amp; (dataset.PassengerId != solo_passenger.PassengerId)]</span><br><span class="line">        <span class="keyword">if</span> items.shape[<span class="number">0</span>] &gt; <span class="number">0</span>:</span><br><span class="line">            count_nannies_cousins_firends += <span class="number">1</span></span><br><span class="line">            nannies_cousins_firends.add(solo_passenger.SurnameGroupId)</span><br><span class="line">            nannies_cousins_firends.add(items.iloc[<span class="number">0</span>,:].SurnameGroupId)</span><br><span class="line">            dataset.loc[dataset.PassengerId == solo_passenger.PassengerId, <span class="string">'SurnameGroupId'</span>] = items.iloc[<span class="number">0</span>,:].SurnameGroupId</span><br><span class="line">    <span class="keyword">if</span> verbose:</span><br><span class="line">        print(<span class="string">'Totally adding %d  nannies, cousins and firends to surname groups'</span> % count_nannies_cousins_firends)</span><br><span class="line">    <span class="keyword">return</span> nannies_cousins_firends</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">engineeringFeatures</span><span class="params">(dataset = None, verbose = False)</span>:</span></span><br><span class="line">    dealWithNameFeature(dataset)</span><br><span class="line">    getSurnameGroupId(dataset)</span><br><span class="line">    getTicketGroupId(dataset)</span><br><span class="line">    getSurnameGroupSize(dataset)</span><br><span class="line">    addNanniesCousinsFriends(dataset, verbose = verbose, only_boy_female=<span class="keyword">True</span>)</span><br><span class="line">    <span class="comment"># resize the surname group size </span></span><br><span class="line">    getSurnameGroupSize(dataset)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSurnameGroupSurvived</span><span class="params">(dataset, indicies_train_set)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    get the 'SurnameGroupSurvived' feature in train set </span></span><br><span class="line"><span class="string">    @dataset : combination of train set and test set </span></span><br><span class="line"><span class="string">    @indices_train : indices of train set </span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    dataset[<span class="string">'SurnameGroupSurvived'</span>] = np.NaN</span><br><span class="line">    surname_group_survived_mean = dataset.loc[indicies_train_set, [<span class="string">'SurnameGroupId'</span>,<span class="string">'Survived'</span>]].groupby([<span class="string">'SurnameGroupId'</span>]).Survived.mean()</span><br><span class="line">    dataset.loc[indicies_train_set, [<span class="string">'SurnameGroupSurvived'</span>]] = dataset.loc[indicies_train_set,<span class="string">'SurnameGroupId'</span>].apply(<span class="keyword">lambda</span> x: surname_group_survived_mean.loc[x])</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setSurnameGroupSurvivedInTestSet</span><span class="params">(dataset, indices_test_set)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    set the 'SurnameGroupSurvived' feature in test set </span></span><br><span class="line"><span class="string">    @dataset : combination of train set and test set </span></span><br><span class="line"><span class="string">    @indices_test_set : indices of test set </span></span><br><span class="line"><span class="string">    '''</span> </span><br><span class="line">    <span class="keyword">for</span> idx <span class="keyword">in</span> indices_test_set:</span><br><span class="line">        tmp = dataset.loc[(dataset.SurnameGroupId == dataset.loc[idx, <span class="string">'SurnameGroupId'</span>]) &amp; (dataset.SurnameGroupSurvived.notnull()), [<span class="string">'SurnameGroupSurvived'</span>]]</span><br><span class="line">        <span class="keyword">if</span> tmp.shape[<span class="number">0</span>] &gt; <span class="number">0</span>:</span><br><span class="line">            dataset.loc[idx, <span class="string">'SurnameGroupSurvived'</span>] = tmp.values[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> (pd.isna(dataset.loc[idx, <span class="string">'SurnameGroupSurvived'</span>])):</span><br><span class="line">            <span class="keyword">if</span> dataset.loc[idx, <span class="string">'Pclass'</span>]  == <span class="number">3</span>:</span><br><span class="line">                dataset.loc[idx, <span class="string">'SurnameGroupSurvived'</span>] = <span class="number">1.0</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dataset.loc[idx, <span class="string">'SurnameGroupSurvived'</span>] = <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getWomanChildrenGroupSurvived</span><span class="params">(dataset, indicies_train_set)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    get the 'SurnameGroupSurvived' feature in train set</span></span><br><span class="line"><span class="string">    @dataset : combination of train set and test set</span></span><br><span class="line"><span class="string">    @indices_train : indices of train set</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    dataset[<span class="string">'WomanChildGroupSurvived'</span>] = np.NaN</span><br><span class="line">    indices_female = (dataset.Sex == <span class="string">'female'</span>) </span><br><span class="line">    indices_boy = (dataset.Title == <span class="string">'Master'</span>) | ((dataset.Sex == <span class="string">'male'</span>) &amp; (dataset.Age &lt;= children_age_upper_limit))</span><br><span class="line">    indices_WCG = (dataset.SurnameGroupSize &gt; <span class="number">1</span>) &amp; (indices_female | indices_boy)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Not to group sb, according to analysis above</span></span><br><span class="line">    dataset[<span class="string">'WomanChildGroupId'</span>] = dataset.SurnameGroupId</span><br><span class="line">    dataset.loc[~indices_WCG, <span class="string">'WomanChildGroupId'</span>] = <span class="string">'NoGroup'</span>  </span><br><span class="line">    </span><br><span class="line">    <span class="comment">## woman-child-group </span></span><br><span class="line">    woman_child_group_survived_mean = dataset.loc[indicies_train_set, [<span class="string">'WomanChildGroupId'</span>,<span class="string">'Survived'</span>]].groupby([<span class="string">'WomanChildGroupId'</span>]).Survived.mean()</span><br><span class="line">    dataset.loc[indicies_train_set, <span class="string">'WomanChildGroupSurvived'</span>] = dataset.loc[indicies_train_set, <span class="string">'WomanChildGroupId'</span>].apply(<span class="keyword">lambda</span> x: woman_child_group_survived_mean.loc[x])</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setWomenChildGroupSurvivedInTestSet</span><span class="params">(dataset, indices_test_set)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    set the 'SurnameGroupSurvived' feature in test set</span></span><br><span class="line"><span class="string">    @dataset : combination of train set and test set</span></span><br><span class="line"><span class="string">    @indices_test_set : indices of test set</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">for</span> idx <span class="keyword">in</span> indices_test_set:</span><br><span class="line">        tmp = dataset.loc[(dataset.WomanChildGroupId == dataset.loc[idx,<span class="string">'WomanChildGroupId'</span>]) &amp; (dataset.WomanChildGroupSurvived.notnull()), <span class="string">'WomanChildGroupSurvived'</span>] </span><br><span class="line">        <span class="keyword">if</span> tmp.shape[<span class="number">0</span>] &gt; <span class="number">0</span>:</span><br><span class="line">            dataset.loc[idx, <span class="string">'WomanChildGroupSurvived'</span>] = tmp.values[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> (pd.isna(dataset.loc[idx, <span class="string">'WomanChildGroupSurvived'</span>])):</span><br><span class="line">            <span class="keyword">if</span> dataset.loc[idx, <span class="string">'Pclass'</span>] == <span class="number">3</span>:</span><br><span class="line">                dataset.loc[idx, <span class="string">'WomanChildGroupSurvived'</span>] = <span class="number">0</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dataset.loc[idx, <span class="string">'WomanChildGroupSurvived'</span>] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">predictionByWomanBoyRules</span><span class="params">(dataset)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    the results of prediction stored in 'Predict' feature in the dataset</span></span><br><span class="line"><span class="string">    @dataset : combination of train set and test set</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    indices_female = (dataset.Sex == <span class="string">'female'</span>) </span><br><span class="line">    indices_boy = (dataset.Title == <span class="string">'Master'</span>) | ((dataset.Sex == <span class="string">'male'</span>) &amp; (dataset.Age &lt;= children_age_upper_limit))</span><br><span class="line">    indices_male_adult = (all_data.SurnameGroupSize &gt; <span class="number">1</span>) &amp; (~index_boy) &amp; (all_data.Sex == <span class="string">'male'</span>)</span><br><span class="line">    </span><br><span class="line">    dataset[<span class="string">'Predict'</span>] = <span class="number">0.0</span></span><br><span class="line">    dataset.loc[index_female, <span class="string">'Predict'</span>] = <span class="number">1.0</span></span><br><span class="line">    dataset.loc[(dataset.WomanChildGroupSurvived == <span class="number">0.0</span>) &amp; index_female &amp; (dataset.SurnameGroupSize &gt; <span class="number">1</span>), <span class="string">'Predict'</span>] = <span class="number">0.0</span></span><br><span class="line">    dataset.loc[(dataset.WomanChildGroupSurvived == <span class="number">1.0</span>) &amp; index_boy &amp; (dataset.SurnameGroupSize &gt; <span class="number">1</span>), <span class="string">'Predict'</span>] = <span class="number">1.0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#dataset.loc[index_female | index_boy, 'Predict'] = 1.0</span></span><br><span class="line">    <span class="comment">#dataset.loc[(dataset.WomanChildGroupSurvived == 0.0) &amp; (index_female | index_boy) &amp; (dataset.SurnameGroupSize &gt; 1), 'Predict'] = 0.0</span></span><br><span class="line">    <span class="comment">#dataset.loc[indices_male_adult &amp; (dataset.SurnameGroupSurvived == 1) &amp; (dataset.Pclass == 1), 'Predict'] = 1.0</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dataset</span><br></pre></td></tr></table></figure>
<h2 id="读取数据"><a href="#读取数据" class="headerlink" title="读取数据"></a>读取数据</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">train = pd.read_csv(<span class="string">'./data/train.csv'</span>)</span><br><span class="line">test = pd.read_csv(<span class="string">'./data/test.csv'</span>)</span><br><span class="line"></span><br><span class="line">all_data = pd.concat([train, test], ignore_index = <span class="keyword">True</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">train = pd.read_csv(<span class="string">"./data/train.csv"</span>)</span><br><span class="line">train.head()</span><br></pre></td></tr></table></figure>
<table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>PassengerId</th><br>      <th>Survived</th><br>      <th>Pclass</th><br>      <th>Name</th><br>      <th>Sex</th><br>      <th>Age</th><br>      <th>SibSp</th><br>      <th>Parch</th><br>      <th>Ticket</th><br>      <th>Fare</th><br>      <th>Cabin</th><br>      <th>Embarked</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>1</td><br>      <td>0</td><br>      <td>3</td><br>      <td>Braund, Mr. Owen Harris</td><br>      <td>male</td><br>      <td>22.0</td><br>      <td>1</td><br>      <td>0</td><br>      <td>A/5 21171</td><br>      <td>7.2500</td><br>      <td>NaN</td><br>      <td>S</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>2</td><br>      <td>1</td><br>      <td>1</td><br>      <td>Cumings, Mrs. John Bradley (Florence Briggs Th…</td><br>      <td>female</td><br>      <td>38.0</td><br>      <td>1</td><br>      <td>0</td><br>      <td>PC 17599</td><br>      <td>71.2833</td><br>      <td>C85</td><br>      <td>C</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>3</td><br>      <td>1</td><br>      <td>3</td><br>      <td>Heikkinen, Miss. Laina</td><br>      <td>female</td><br>      <td>26.0</td><br>      <td>0</td><br>      <td>0</td><br>      <td>STON/O2. 3101282</td><br>      <td>7.9250</td><br>      <td>NaN</td><br>      <td>S</td><br>    </tr><br>    <tr><br>      <th>3</th><br>      <td>4</td><br>      <td>1</td><br>      <td>1</td><br>      <td>Futrelle, Mrs. Jacques Heath (Lily May Peel)</td><br>      <td>female</td><br>      <td>35.0</td><br>      <td>1</td><br>      <td>0</td><br>      <td>113803</td><br>      <td>53.1000</td><br>      <td>C123</td><br>      <td>S</td><br>    </tr><br>    <tr><br>      <th>4</th><br>      <td>5</td><br>      <td>0</td><br>      <td>3</td><br>      <td>Allen, Mr. William Henry</td><br>      <td>male</td><br>      <td>35.0</td><br>      <td>0</td><br>      <td>0</td><br>      <td>373450</td><br>      <td>8.0500</td><br>      <td>NaN</td><br>      <td>S</td><br>    </tr><br>  </tbody><br></table>



<p>字段有：</p>
<ol>
<li>Passengerld =&gt; 乘客ID </li>
<li>Pclass =&gt; 乘客等级(1/2/3等舱位) </li>
<li>Name =&gt; 乘客姓名 </li>
<li>Sex =&gt; 性别 </li>
<li>Age =&gt; 年龄 </li>
<li>SibSp =&gt; 堂兄弟/妹个数 </li>
<li>Parch =&gt; 父母与小孩个数 </li>
<li>Ticket =&gt; 船票信息 </li>
<li>Fare =&gt; 票价 </li>
<li>Cabin =&gt; 客舱 </li>
<li>Embarked =&gt; 登船港口</li>
</ol>
<h3 id="查看数据集基本信息"><a href="#查看数据集基本信息" class="headerlink" title="查看数据集基本信息"></a>查看数据集基本信息</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train.info()</span><br></pre></td></tr></table></figure>
<pre><code>&lt;class &apos;pandas.core.frame.DataFrame&apos;&gt;
RangeIndex: 891 entries, 0 to 890
Data columns (total 12 columns):
PassengerId    891 non-null int64
Survived       891 non-null int64
Pclass         891 non-null int64
Name           891 non-null object
Sex            891 non-null object
Age            714 non-null float64
SibSp          891 non-null int64
Parch          891 non-null int64
Ticket         891 non-null object
Fare           891 non-null float64
Cabin          204 non-null object
Embarked       889 non-null object
dtypes: float64(2), int64(5), object(5)
memory usage: 83.6+ KB
</code></pre><h3 id="查看缺失数据"><a href="#查看缺失数据" class="headerlink" title="查看缺失数据"></a>查看缺失数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train.isnull().sum()</span><br></pre></td></tr></table></figure>
<pre><code>PassengerId      0
Survived         0
Pclass           0
Name             0
Sex              0
Age            177
SibSp            0
Parch            0
Ticket           0
Fare             0
Cabin          687
Embarked         2
dtype: int64
</code></pre><p>训练数据总共有891名乘客，但是很不幸，我们有些属性的数据不全</p>
<ol>
<li>Age(年龄)属性只有714名乘客有记录 </li>
<li>Cain(客舱)只有204名乘客是已知的；</li>
<li>Embarked 属性只缺2个</li>
</ol>
<p>看看测试数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">test.info()</span><br><span class="line">test.isnull().sum()</span><br></pre></td></tr></table></figure>
<pre><code>&lt;class &apos;pandas.core.frame.DataFrame&apos;&gt;
RangeIndex: 418 entries, 0 to 417
Data columns (total 11 columns):
PassengerId    418 non-null int64
Pclass         418 non-null int64
Name           418 non-null object
Sex            418 non-null object
Age            332 non-null float64
SibSp          418 non-null int64
Parch          418 non-null int64
Ticket         418 non-null object
Fare           417 non-null float64
Cabin          91 non-null object
Embarked       418 non-null object
dtypes: float64(2), int64(4), object(5)
memory usage: 36.0+ KB





PassengerId      0
Pclass           0
Name             0
Sex              0
Age             86
SibSp            0
Parch            0
Ticket           0
Fare             1
Cabin          327
Embarked         0
dtype: int64
</code></pre><p>测试数据中总共有481名乘客</p>
<ol>
<li>有更多缺失值Age(年龄)：86个缺失</li>
<li>Fare属性缺1位乘客的信息 </li>
<li>Cabin(客舱)只有91名乘客是已知的；</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_data.info()</span><br></pre></td></tr></table></figure>
<pre><code>&lt;class &apos;pandas.core.frame.DataFrame&apos;&gt;
RangeIndex: 1309 entries, 0 to 1308
Data columns (total 12 columns):
Age            1046 non-null float64
Cabin          295 non-null object
Embarked       1307 non-null object
Fare           1308 non-null float64
Name           1309 non-null object
Parch          1309 non-null int64
PassengerId    1309 non-null int64
Pclass         1309 non-null int64
Sex            1309 non-null object
SibSp          1309 non-null int64
Survived       891 non-null float64
Ticket         1309 non-null object
dtypes: float64(3), int64(4), object(5)
memory usage: 122.8+ KB
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_data.isnull().sum()</span><br></pre></td></tr></table></figure>
<pre><code>Age             263
Cabin          1014
Embarked          2
Fare              1
Name              0
Parch             0
PassengerId       0
Pclass            0
Sex               0
SibSp             0
Survived        418
Ticket            0
dtype: int64
</code></pre><h3 id="查看特征的分布信息"><a href="#查看特征的分布信息" class="headerlink" title="查看特征的分布信息"></a>查看特征的分布信息</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train.describe()</span><br></pre></td></tr></table></figure>
<table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>PassengerId</th><br>      <th>Survived</th><br>      <th>Pclass</th><br>      <th>Age</th><br>      <th>SibSp</th><br>      <th>Parch</th><br>      <th>Fare</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>count</th><br>      <td>891.000000</td><br>      <td>891.000000</td><br>      <td>891.000000</td><br>      <td>714.000000</td><br>      <td>891.000000</td><br>      <td>891.000000</td><br>      <td>891.000000</td><br>    </tr><br>    <tr><br>      <th>mean</th><br>      <td>446.000000</td><br>      <td>0.383838</td><br>      <td>2.308642</td><br>      <td>29.699118</td><br>      <td>0.523008</td><br>      <td>0.381594</td><br>      <td>32.204208</td><br>    </tr><br>    <tr><br>      <th>std</th><br>      <td>257.353842</td><br>      <td>0.486592</td><br>      <td>0.836071</td><br>      <td>14.526497</td><br>      <td>1.102743</td><br>      <td>0.806057</td><br>      <td>49.693429</td><br>    </tr><br>    <tr><br>      <th>min</th><br>      <td>1.000000</td><br>      <td>0.000000</td><br>      <td>1.000000</td><br>      <td>0.420000</td><br>      <td>0.000000</td><br>      <td>0.000000</td><br>      <td>0.000000</td><br>    </tr><br>    <tr><br>      <th>25%</th><br>      <td>223.500000</td><br>      <td>0.000000</td><br>      <td>2.000000</td><br>      <td>20.125000</td><br>      <td>0.000000</td><br>      <td>0.000000</td><br>      <td>7.910400</td><br>    </tr><br>    <tr><br>      <th>50%</th><br>      <td>446.000000</td><br>      <td>0.000000</td><br>      <td>3.000000</td><br>      <td>28.000000</td><br>      <td>0.000000</td><br>      <td>0.000000</td><br>      <td>14.454200</td><br>    </tr><br>    <tr><br>      <th>75%</th><br>      <td>668.500000</td><br>      <td>1.000000</td><br>      <td>3.000000</td><br>      <td>38.000000</td><br>      <td>1.000000</td><br>      <td>0.000000</td><br>      <td>31.000000</td><br>    </tr><br>    <tr><br>      <th>max</th><br>      <td>891.000000</td><br>      <td>1.000000</td><br>      <td>3.000000</td><br>      <td>80.000000</td><br>      <td>8.000000</td><br>      <td>6.000000</td><br>      <td>512.329200</td><br>    </tr><br>  </tbody><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_data.info()</span><br></pre></td></tr></table></figure><br><br>    <class 'pandas.core.frame.dataframe'=""><br>    RangeIndex: 1309 entries, 0 to 1308<br>    Data columns (total 12 columns):<br>    Age            1046 non-null float64<br>    Cabin          295 non-null object<br>    Embarked       1307 non-null object<br>    Fare           1308 non-null float64<br>    Name           1309 non-null object<br>    Parch          1309 non-null int64<br>    PassengerId    1309 non-null int64<br>    Pclass         1309 non-null int64<br>    Sex            1309 non-null object<br>    SibSp          1309 non-null int64<br>    Survived       891 non-null float64<br>    Ticket         1309 non-null object<br>    dtypes: float64(3), int64(4), object(5)<br>    memory usage: 122.8+ KB<br><br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_data.describe()</span><br></pre></td></tr></table></figure><br><br><table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>Age</th><br>      <th>Fare</th><br>      <th>Parch</th><br>      <th>PassengerId</th><br>      <th>Pclass</th><br>      <th>SibSp</th><br>      <th>Survived</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>count</th><br>      <td>1046.000000</td><br>      <td>1308.000000</td><br>      <td>1309.000000</td><br>      <td>1309.000000</td><br>      <td>1309.000000</td><br>      <td>1309.000000</td><br>      <td>891.000000</td><br>    </tr><br>    <tr><br>      <th>mean</th><br>      <td>29.881138</td><br>      <td>33.295479</td><br>      <td>0.385027</td><br>      <td>655.000000</td><br>      <td>2.294882</td><br>      <td>0.498854</td><br>      <td>0.383838</td><br>    </tr><br>    <tr><br>      <th>std</th><br>      <td>14.413493</td><br>      <td>51.758668</td><br>      <td>0.865560</td><br>      <td>378.020061</td><br>      <td>0.837836</td><br>      <td>1.041658</td><br>      <td>0.486592</td><br>    </tr><br>    <tr><br>      <th>min</th><br>      <td>0.170000</td><br>      <td>0.000000</td><br>      <td>0.000000</td><br>      <td>1.000000</td><br>      <td>1.000000</td><br>      <td>0.000000</td><br>      <td>0.000000</td><br>    </tr><br>    <tr><br>      <th>25%</th><br>      <td>21.000000</td><br>      <td>7.895800</td><br>      <td>0.000000</td><br>      <td>328.000000</td><br>      <td>2.000000</td><br>      <td>0.000000</td><br>      <td>0.000000</td><br>    </tr><br>    <tr><br>      <th>50%</th><br>      <td>28.000000</td><br>      <td>14.454200</td><br>      <td>0.000000</td><br>      <td>655.000000</td><br>      <td>3.000000</td><br>      <td>0.000000</td><br>      <td>0.000000</td><br>    </tr><br>    <tr><br>      <th>75%</th><br>      <td>39.000000</td><br>      <td>31.275000</td><br>      <td>0.000000</td><br>      <td>982.000000</td><br>      <td>3.000000</td><br>      <td>1.000000</td><br>      <td>1.000000</td><br>    </tr><br>    <tr><br>      <th>max</th><br>      <td>80.000000</td><br>      <td>512.329200</td><br>      <td>9.000000</td><br>      <td>1309.000000</td><br>      <td>3.000000</td><br>      <td>8.000000</td><br>      <td>1.000000</td><br>    </tr><br>  </tbody><br></table>

<p><strong><font color="red">查看特征与标签关系</font></strong></p>
<h3 id="Fare"><a href="#Fare" class="headerlink" title="Fare"></a>Fare</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ticket_value_counts = dict(all_data.Ticket.value_counts())</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_data[<span class="string">'TicketSize'</span>] = all_data.Ticket.apply(<span class="keyword">lambda</span> x : ticket_value_counts[x])</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_data[<span class="string">'SingleTicketFare'</span>] = all_data.apply(<span class="keyword">lambda</span> row : row.Fare / row.TicketSize, axis = <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_data[<span class="string">'SingleTicketFare'</span>].head()</span><br></pre></td></tr></table></figure>
<pre><code>0     7.25000
1    35.64165
2     7.92500
3    26.55000
4     8.05000
Name: SingleTicketFare, dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">train = all_data.iloc[:train.shape[<span class="number">0</span>]]</span><br><span class="line">test = all_data.iloc[train.shape[<span class="number">0</span>]]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">train[<span class="string">'CategoricalFare'</span>] = pd.qcut(train[<span class="string">'SingleTicketFare'</span>], <span class="number">9</span>)</span><br><span class="line">fare_survived = train.loc[:, [<span class="string">'CategoricalFare'</span>, <span class="string">'Survived'</span>]].groupby([<span class="string">'CategoricalFare'</span>]).mean()</span><br><span class="line">print(fare_survived)</span><br><span class="line">plt.xticks(rotation=<span class="number">270</span>)</span><br><span class="line">plt.rcParams[<span class="string">'figure.figsize'</span>] =(<span class="number">5</span>, <span class="number">5</span>)</span><br><span class="line">sns.barplot(x=<span class="string">'CategoricalFare'</span>, y=<span class="string">'Survived'</span>, data=train)</span><br><span class="line">train.drop([<span class="string">'CategoricalFare'</span>], axis = <span class="number">1</span>, inplace=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure>
<pre><code>C:\Anaconda3\lib\site-packages\ipykernel\__main__.py:2: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy
  from ipykernel import kernelapp as app


                 Survived
CategoricalFare          
(-0.001, 6.238]  0.300000
(6.238, 7.245]   0.244898
(7.245, 7.775]   0.302752
(7.775, 7.925]   0.255556
(7.925, 8.872]   0.214286
(8.872, 13.0]    0.403614
(13.0, 25.576]   0.500000
(25.576, 30.0]   0.673469
(30.0, 128.082]  0.622449


C:\Anaconda3\lib\site-packages\ipykernel\__main__.py:8: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy
</code></pre><p><img src="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_27_3.png" alt="png"></p>
<h3 id="Sex"><a href="#Sex" class="headerlink" title="Sex"></a>Sex</h3><p>电影里面，援救过程中：女士，小孩优先</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(train[[<span class="string">"Sex"</span>, <span class="string">"Survived"</span>]].groupby([<span class="string">'Sex'</span>], as_index=<span class="keyword">False</span>).mean())</span><br></pre></td></tr></table></figure>
<pre><code>      Sex  Survived
0  female  0.742038
1    male  0.188908
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.barplot(x=<span class="string">"Sex"</span>, y=<span class="string">"Survived"</span>, data=train)</span><br></pre></td></tr></table></figure>
<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x2d588d6b240&gt;
</code></pre><p><img src="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_30_1.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train.Sex.value_counts()</span><br></pre></td></tr></table></figure>
<pre><code>male      577
female    314
Name: Sex, dtype: int64
</code></pre><p>也就是说，依据性别全部判断女性幸存，男性遇难，训练集正确率都有 </p>
<p>$$[Math Processing Error]\big[577 \times (1 - 0.188908) + 314 \times 0.742038\big] / 891 = 78.67\%$$</p>
<p>当然这只是训练数据。</p>
<h3 id="Age"><a href="#Age" class="headerlink" title="Age"></a>Age</h3><p>由前面可知，Age缺失严重，但是不妨碍我们根据女士儿童优先探索一下，年龄分段到底影响结果与否？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">children_age_upper_limit = <span class="number">12</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getAgeSegment</span><span class="params">(age)</span>:</span></span><br><span class="line">    age_seg = <span class="number">5</span></span><br><span class="line">    <span class="keyword">if</span> age &lt;= children_age_upper_limit:</span><br><span class="line">        age_seg = <span class="number">1</span> <span class="comment"># aldolescents</span></span><br><span class="line">    <span class="keyword">elif</span> age &lt;= <span class="number">32</span> :</span><br><span class="line">        age_seg = <span class="number">2</span></span><br><span class="line">    <span class="keyword">elif</span> age &lt;= <span class="number">48</span> :</span><br><span class="line">        age_seg = <span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> age &lt;= <span class="number">65</span> : <span class="comment"># almost retirement age</span></span><br><span class="line">        age_seg = <span class="number">4</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> np.int32(age_seg)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AgeNotNull = train.loc[train.Age.notnull(), [<span class="string">'Age'</span>, <span class="string">'Survived'</span>, <span class="string">'Sex'</span>]]</span><br><span class="line">AgeNotNull.head()</span><br></pre></td></tr></table></figure>
<table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>Age</th><br>      <th>Survived</th><br>      <th>Sex</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>22.0</td><br>      <td>0.0</td><br>      <td>male</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>38.0</td><br>      <td>1.0</td><br>      <td>female</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>26.0</td><br>      <td>1.0</td><br>      <td>female</td><br>    </tr><br>    <tr><br>      <th>3</th><br>      <td>35.0</td><br>      <td>1.0</td><br>      <td>female</td><br>    </tr><br>    <tr><br>      <th>4</th><br>      <td>35.0</td><br>      <td>0.0</td><br>      <td>male</td><br>    </tr><br>  </tbody><br></table>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AgeNotNull.Age = AgeNotNull.Age.apply(<span class="keyword">lambda</span> x: getAgeSegment(x))</span><br><span class="line">AgeNotNull.head(<span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>Age</th><br>      <th>Survived</th><br>      <th>Sex</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>2</td><br>      <td>0.0</td><br>      <td>male</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>3</td><br>      <td>1.0</td><br>      <td>female</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>2</td><br>      <td>1.0</td><br>      <td>female</td><br>    </tr><br>    <tr><br>      <th>3</th><br>      <td>3</td><br>      <td>1.0</td><br>      <td>female</td><br>    </tr><br>    <tr><br>      <th>4</th><br>      <td>3</td><br>      <td>0.0</td><br>      <td>male</td><br>    </tr><br>    <tr><br>      <th>6</th><br>      <td>4</td><br>      <td>0.0</td><br>      <td>male</td><br>    </tr><br>    <tr><br>      <th>7</th><br>      <td>1</td><br>      <td>0.0</td><br>      <td>male</td><br>    </tr><br>    <tr><br>      <th>8</th><br>      <td>2</td><br>      <td>1.0</td><br>      <td>female</td><br>    </tr><br>    <tr><br>      <th>9</th><br>      <td>2</td><br>      <td>1.0</td><br>      <td>female</td><br>    </tr><br>    <tr><br>      <th>10</th><br>      <td>1</td><br>      <td>1.0</td><br>      <td>female</td><br>    </tr><br>  </tbody><br></table>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AgeNotNull.groupby(by=<span class="string">'Age'</span>, as_index=<span class="keyword">False</span>).mean()</span><br></pre></td></tr></table></figure>
<table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>Age</th><br>      <th>Survived</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>1</td><br>      <td>0.579710</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>2</td><br>      <td>0.379310</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>3</td><br>      <td>0.404255</td><br>    </tr><br>    <tr><br>      <th>3</th><br>      <td>4</td><br>      <td>0.416667</td><br>    </tr><br>    <tr><br>      <th>4</th><br>      <td>5</td><br>      <td>0.125000</td><br>    </tr><br>  </tbody><br></table>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.barplot(x=<span class="string">'Age'</span>, y=<span class="string">'Survived'</span>, data = AgeNotNull)</span><br></pre></td></tr></table></figure>
<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x2d588dd9048&gt;
</code></pre><p><img src="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_38_1.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AgeNotNull.groupby(by=[<span class="string">'Age'</span>, <span class="string">'Sex'</span>], as_index=<span class="keyword">False</span>).mean()</span><br></pre></td></tr></table></figure>
<table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>Age</th><br>      <th>Sex</th><br>      <th>Survived</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>1</td><br>      <td>female</td><br>      <td>0.593750</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>1</td><br>      <td>male</td><br>      <td>0.567568</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>2</td><br>      <td>female</td><br>      <td>0.744526</td><br>    </tr><br>    <tr><br>      <th>3</th><br>      <td>2</td><br>      <td>male</td><br>      <td>0.170833</td><br>    </tr><br>    <tr><br>      <th>4</th><br>      <td>3</td><br>      <td>female</td><br>      <td>0.794118</td><br>    </tr><br>    <tr><br>      <th>5</th><br>      <td>3</td><br>      <td>male</td><br>      <td>0.183333</td><br>    </tr><br>    <tr><br>      <th>6</th><br>      <td>4</td><br>      <td>female</td><br>      <td>0.916667</td><br>    </tr><br>    <tr><br>      <th>7</th><br>      <td>4</td><br>      <td>male</td><br>      <td>0.166667</td><br>    </tr><br>    <tr><br>      <th>8</th><br>      <td>5</td><br>      <td>male</td><br>      <td>0.125000</td><br>    </tr><br>  </tbody><br></table>

<p>由上表我们观察到：</p>
<ol>
<li>只要是女的，幸存率都很高</li>
<li>男的里面属于最小年龄段的幸存率是其他段的3倍多，其他年龄段男生直接预测死亡，准确率都有 $[Math Processing Error]80\%$ 出头</li>
</ol>
<label align="center"><h3> 目标 </h3></label>

<p>那么我们得出这样的<font color="red"><strong>目标</strong></font>：<font color="blue"><strong>默认预测女性都存活，男性都遇难，再加上以下：</strong></font></p>
<ol>
<li><font color="blue">预测什么样的女性会遇难，毕竟少数，如果能够预测对，正确率就会极大提高。</font>
</li>
<li><font color="blue">预测什么样的男孩（最小年龄段的男性）会幸存，也是少数，如果能够预测对，正确率就会极大提高。</font>
</li>
<li><font color="blue">不是第一个年龄段的男性什么条件下会存活？</font>


</li>
</ol>
<h3 id="Name"><a href="#Name" class="headerlink" title="Name"></a>Name</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train[<span class="string">'Name'</span>].head()</span><br></pre></td></tr></table></figure>
<pre><code>0                              Braund, Mr. Owen Harris
1    Cumings, Mrs. John Bradley (Florence Briggs Th...
2                               Heikkinen, Miss. Laina
3         Futrelle, Mrs. Jacques Heath (Lily May Peel)
4                             Allen, Mr. William Henry
Name: Name, dtype: object
</code></pre><p>Name特征含3个字段：</p>
<ol>
<li>姓氏</li>
<li>称谓Title</li>
<li>名字</li>
</ol>
<h4 id="提取称谓字段Title"><a href="#提取称谓字段Title" class="headerlink" title="提取称谓字段Title"></a>提取称谓字段Title</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re <span class="keyword">as</span> re <span class="comment"># 正则包提取</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getTitle</span><span class="params">(name)</span>:</span></span><br><span class="line">    title_search = re.search(<span class="string">' ([A-Za-z]+)\.'</span>, name)</span><br><span class="line">    <span class="comment"># If the title exists, extract and return it.</span></span><br><span class="line">    <span class="keyword">if</span> title_search:</span><br><span class="line">        <span class="keyword">return</span> title_search.group(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span></span><br><span class="line"></span><br><span class="line">all_data[<span class="string">'Title'</span>] = all_data[<span class="string">'Name'</span>].apply(getTitle)</span><br></pre></td></tr></table></figure>
<h5 id="Master"><a href="#Master" class="headerlink" title="Master"></a>Master</h5><p>启发于 <a href="https://www.kaggle.com/cdeotte" target="_blank" rel="noopener">Chris Deotte</a> 的kernel: <a href="https://www.kaggle.com/cdeotte/titanic-using-name-only-0-81818" target="_blank" rel="noopener">Titanic using Name only [0.81818]
</a>，于是探索了一下，<code>Master</code> 有何特点？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Title_Master_DataFrame = all_data.loc[all_data[<span class="string">'Title'</span>]==<span class="string">'Master'</span>]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Title_Master_DataFrame.Sex.value_counts()</span><br></pre></td></tr></table></figure>
<pre><code>male    61
Name: Sex, dtype: int64
</code></pre><p><code>Master</code>全是男的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Title_Master_DataFrame.Age.value_counts()</span><br></pre></td></tr></table></figure>
<pre><code>2.00     5
4.00     5
1.00     5
9.00     5
6.00     4
3.00     4
7.00     3
8.00     3
13.00    3
0.83     3
11.00    2
10.00    2
11.50    1
0.75     1
14.50    1
5.00     1
12.00    1
0.33     1
0.42     1
0.92     1
0.67     1
Name: Age, dtype: int64
</code></pre><p><code>Master</code>全是小于15岁的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Title_Master_DataFrame.Survived.value_counts()</span><br></pre></td></tr></table></figure>
<pre><code>1.0    23
0.0    17
Name: Survived, dtype: int64
</code></pre><p>我们看看是不是所有的男孩都叫 <code>Master</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np.sum(all_data.Title == <span class="string">'Master'</span>)</span><br></pre></td></tr></table></figure>
<pre><code>61
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">boy = all_data.loc[(all_data.Age &lt;= children_age_upper_limit) &amp; (all_data.Sex == <span class="string">'male'</span>)]</span><br><span class="line">boy.shape[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<pre><code>50
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np.sum(boy.Title == <span class="string">'Master'</span>)</span><br></pre></td></tr></table></figure>
<pre><code>49
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">boy.loc[boy.Title != <span class="string">'Master'</span>]</span><br></pre></td></tr></table></figure>
<table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>Age</th><br>      <th>Cabin</th><br>      <th>Embarked</th><br>      <th>Fare</th><br>      <th>Name</th><br>      <th>Parch</th><br>      <th>PassengerId</th><br>      <th>Pclass</th><br>      <th>Sex</th><br>      <th>SibSp</th><br>      <th>Survived</th><br>      <th>Ticket</th><br>      <th>TicketSize</th><br>      <th>SingleTicketFare</th><br>      <th>Title</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>731</th><br>      <td>11.0</td><br>      <td>NaN</td><br>      <td>C</td><br>      <td>18.7875</td><br>      <td>Hassan, Mr. Houssein G N</td><br>      <td>0</td><br>      <td>732</td><br>      <td>3</td><br>      <td>male</td><br>      <td>0</td><br>      <td>0.0</td><br>      <td>2699</td><br>      <td>2</td><br>      <td>9.39375</td><br>      <td>Mr</td><br>    </tr><br>  </tbody><br></table>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_data.loc[all_data.Name.str.contains(<span class="string">'Hassan'</span>)]</span><br></pre></td></tr></table></figure>
<table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>Age</th><br>      <th>Cabin</th><br>      <th>Embarked</th><br>      <th>Fare</th><br>      <th>Name</th><br>      <th>Parch</th><br>      <th>PassengerId</th><br>      <th>Pclass</th><br>      <th>Sex</th><br>      <th>SibSp</th><br>      <th>Survived</th><br>      <th>Ticket</th><br>      <th>TicketSize</th><br>      <th>SingleTicketFare</th><br>      <th>Title</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>731</th><br>      <td>11.0</td><br>      <td>NaN</td><br>      <td>C</td><br>      <td>18.7875</td><br>      <td>Hassan, Mr. Houssein G N</td><br>      <td>0</td><br>      <td>732</td><br>      <td>3</td><br>      <td>male</td><br>      <td>0</td><br>      <td>0.0</td><br>      <td>2699</td><br>      <td>2</td><br>      <td>9.39375</td><br>      <td>Mr</td><br>    </tr><br>  </tbody><br></table><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_data.loc[all_data.Ticket.str.match(<span class="string">'^2699$'</span>)]</span><br></pre></td></tr></table></figure><br><br><table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>Age</th><br>      <th>Cabin</th><br>      <th>Embarked</th><br>      <th>Fare</th><br>      <th>Name</th><br>      <th>Parch</th><br>      <th>PassengerId</th><br>      <th>Pclass</th><br>      <th>Sex</th><br>      <th>SibSp</th><br>      <th>Survived</th><br>      <th>Ticket</th><br>      <th>TicketSize</th><br>      <th>SingleTicketFare</th><br>      <th>Title</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>207</th><br>      <td>26.0</td><br>      <td>NaN</td><br>      <td>C</td><br>      <td>18.7875</td><br>      <td>Albimona, Mr. Nassef Cassem</td><br>      <td>0</td><br>      <td>208</td><br>      <td>3</td><br>      <td>male</td><br>      <td>0</td><br>      <td>1.0</td><br>      <td>2699</td><br>      <td>2</td><br>      <td>9.39375</td><br>      <td>Mr</td><br>    </tr><br>    <tr><br>      <th>731</th><br>      <td>11.0</td><br>      <td>NaN</td><br>      <td>C</td><br>      <td>18.7875</td><br>      <td>Hassan, Mr. Houssein G N</td><br>      <td>0</td><br>      <td>732</td><br>      <td>3</td><br>      <td>male</td><br>      <td>0</td><br>      <td>0.0</td><br>      <td>2699</td><br>      <td>2</td><br>      <td>9.39375</td><br>      <td>Mr</td><br>    </tr><br>  </tbody><br></table>

<p>无法确定他们是不是亲戚关系？如果不是就是这个11岁小男孩单独出行。</p>
<h5 id="Title的性别分布"><a href="#Title的性别分布" class="headerlink" title="Title的性别分布"></a>Title的性别分布</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_data.Title.unique()</span><br></pre></td></tr></table></figure>
<pre><code>array([&apos;Mr&apos;, &apos;Mrs&apos;, &apos;Miss&apos;, &apos;Master&apos;, &apos;Don&apos;, &apos;Rev&apos;, &apos;Dr&apos;, &apos;Mme&apos;, &apos;Ms&apos;,
       &apos;Major&apos;, &apos;Lady&apos;, &apos;Sir&apos;, &apos;Mlle&apos;, &apos;Col&apos;, &apos;Capt&apos;, &apos;Countess&apos;,
       &apos;Jonkheer&apos;, &apos;Dona&apos;], dtype=object)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a_set = set([<span class="string">"Dona"</span>,<span class="string">'the Countess'</span>,<span class="string">'Mme'</span>,<span class="string">"Mlle"</span>,<span class="string">"Ms"</span>,<span class="string">"Miss"</span>,<span class="string">"Lady"</span>,<span class="string">"Mrs"</span>, <span class="string">'Countess'</span>])</span><br><span class="line">tmp_dict = &#123;<span class="string">'female'</span>: <span class="number">0</span>&#125;</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> a_set:</span><br><span class="line">    new_dict = dict(all_data.loc[all_data.Title == item, :].Sex.value_counts())</span><br><span class="line">    print(item, new_dict)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'female'</span> <span class="keyword">in</span> set(new_dict.keys()):</span><br><span class="line">        tmp_dict[<span class="string">'female'</span>] +=new_dict[<span class="string">'female'</span>] </span><br><span class="line">    </span><br><span class="line">all_data.loc[all_data.Sex == <span class="string">'female'</span>].shape[<span class="number">0</span>], tmp_dict[<span class="string">'female'</span>]</span><br></pre></td></tr></table></figure>
<pre><code>the Countess {}
Miss {&apos;female&apos;: 260}
Mme {&apos;female&apos;: 1}
Countess {&apos;female&apos;: 1}
Mrs {&apos;female&apos;: 197}
Lady {&apos;female&apos;: 1}
Mlle {&apos;female&apos;: 2}
Dona {&apos;female&apos;: 1}
Ms {&apos;female&apos;: 2}





(466, 465)
</code></pre><p>少了一位女性？看看以下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">a_set = set([<span class="string">"Capt"</span>,<span class="string">"Don"</span>,<span class="string">"Major"</span>,<span class="string">"Col"</span>,<span class="string">"Rev"</span>,<span class="string">"Dr"</span>,<span class="string">"Sir"</span>,<span class="string">"Mr"</span>,<span class="string">"Jonkheer"</span>,<span class="string">'Master'</span>])</span><br><span class="line"></span><br><span class="line">tmp_dict = &#123;<span class="string">'male'</span>: <span class="number">0</span>&#125;</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> a_set:</span><br><span class="line">    new_dict = dict(all_data.loc[all_data.Title == item, :].Sex.value_counts())</span><br><span class="line">    print(item, new_dict)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'male'</span> <span class="keyword">in</span> set(new_dict.keys()):</span><br><span class="line">        tmp_dict[<span class="string">'male'</span>] +=new_dict[<span class="string">'male'</span>] </span><br><span class="line">    </span><br><span class="line">all_data.loc[all_data.Sex == <span class="string">'male'</span>].shape[<span class="number">0</span>], tmp_dict[<span class="string">'male'</span>]</span><br></pre></td></tr></table></figure>
<pre><code>Major {&apos;male&apos;: 2}
Col {&apos;male&apos;: 4}
Capt {&apos;male&apos;: 1}
Master {&apos;male&apos;: 61}
Sir {&apos;male&apos;: 1}
Rev {&apos;male&apos;: 8}
Dr {&apos;male&apos;: 7, &apos;female&apos;: 1}
Mr {&apos;male&apos;: 757}
Jonkheer {&apos;male&apos;: 1}
Don {&apos;male&apos;: 1}





(843, 843)
</code></pre><p>这里有一位女Dr。</p>
<p><strong>前文我们已经看到女性幸存率和男孩较高，这里我们提取他们的位置：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index_female = (all_data.Sex == <span class="string">'female'</span>)</span><br><span class="line"></span><br><span class="line">index_boy = ((all_data.Title == <span class="string">'Master'</span>) | ((all_data.Age &lt;= children_age_upper_limit) &amp; (all_data.Sex == <span class="string">'male'</span>)))</span><br></pre></td></tr></table></figure>
<h4 id="提取姓氏字段-Surname"><a href="#提取姓氏字段-Surname" class="headerlink" title="提取姓氏字段 Surname"></a>提取姓氏字段 Surname</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_data[<span class="string">'Surname'</span>]=all_data[<span class="string">'Name'</span>].apply(<span class="keyword">lambda</span> x:x.split(<span class="string">','</span>)[<span class="number">0</span>].strip())</span><br></pre></td></tr></table></figure>
<h4 id="提取FamilySize"><a href="#提取FamilySize" class="headerlink" title="提取FamilySize"></a>提取FamilySize</h4><p>按姓氏统计的家族成员数，这里属于<strong>粗粒度划分</strong>，因为不同家庭同姓氏也是有可能的！</p>
<font color="red"><strong>为什么要统计家庭成员？</strong></font><br>有句老话：在家靠父母，出门靠朋友。在援救过程中，势必一起出行的人或多或少会互相帮助，那么对生存预测就有影响。<br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Surname_Count = dict(all_data[<span class="string">'Surname'</span>].value_counts()) </span><br><span class="line">all_data[<span class="string">'FamilySize'</span>] = all_data[<span class="string">'Surname'</span>].apply(<span class="keyword">lambda</span> x:Surname_Count[x])</span><br></pre></td></tr></table></figure><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">test = all_data.iloc[train.shape[<span class="number">0</span>]:, :]</span><br><span class="line">train = all_data.iloc[:train.shape[<span class="number">0</span>], :]</span><br><span class="line">train.head()</span><br></pre></td></tr></table></figure><br><br><table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>Age</th><br>      <th>Cabin</th><br>      <th>Embarked</th><br>      <th>Fare</th><br>      <th>Name</th><br>      <th>Parch</th><br>      <th>PassengerId</th><br>      <th>Pclass</th><br>      <th>Sex</th><br>      <th>SibSp</th><br>      <th>Survived</th><br>      <th>Ticket</th><br>      <th>TicketSize</th><br>      <th>SingleTicketFare</th><br>      <th>Title</th><br>      <th>Surname</th><br>      <th>FamilySize</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>22.0</td><br>      <td>NaN</td><br>      <td>S</td><br>      <td>7.2500</td><br>      <td>Braund, Mr. Owen Harris</td><br>      <td>0</td><br>      <td>1</td><br>      <td>3</td><br>      <td>male</td><br>      <td>1</td><br>      <td>0.0</td><br>      <td>A/5 21171</td><br>      <td>1</td><br>      <td>7.25000</td><br>      <td>Mr</td><br>      <td>Braund</td><br>      <td>2</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>38.0</td><br>      <td>C85</td><br>      <td>C</td><br>      <td>71.2833</td><br>      <td>Cumings, Mrs. John Bradley (Florence Briggs Th…</td><br>      <td>0</td><br>      <td>2</td><br>      <td>1</td><br>      <td>female</td><br>      <td>1</td><br>      <td>1.0</td><br>      <td>PC 17599</td><br>      <td>2</td><br>      <td>35.64165</td><br>      <td>Mrs</td><br>      <td>Cumings</td><br>      <td>2</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>26.0</td><br>      <td>NaN</td><br>      <td>S</td><br>      <td>7.9250</td><br>      <td>Heikkinen, Miss. Laina</td><br>      <td>0</td><br>      <td>3</td><br>      <td>3</td><br>      <td>female</td><br>      <td>0</td><br>      <td>1.0</td><br>      <td>STON/O2. 3101282</td><br>      <td>1</td><br>      <td>7.92500</td><br>      <td>Miss</td><br>      <td>Heikkinen</td><br>      <td>1</td><br>    </tr><br>    <tr><br>      <th>3</th><br>      <td>35.0</td><br>      <td>C123</td><br>      <td>S</td><br>      <td>53.1000</td><br>      <td>Futrelle, Mrs. Jacques Heath (Lily May Peel)</td><br>      <td>0</td><br>      <td>4</td><br>      <td>1</td><br>      <td>female</td><br>      <td>1</td><br>      <td>1.0</td><br>      <td>113803</td><br>      <td>2</td><br>      <td>26.55000</td><br>      <td>Mrs</td><br>      <td>Futrelle</td><br>      <td>2</td><br>    </tr><br>    <tr><br>      <th>4</th><br>      <td>35.0</td><br>      <td>NaN</td><br>      <td>S</td><br>      <td>8.0500</td><br>      <td>Allen, Mr. William Henry</td><br>      <td>0</td><br>      <td>5</td><br>      <td>3</td><br>      <td>male</td><br>      <td>0</td><br>      <td>0.0</td><br>      <td>373450</td><br>      <td>1</td><br>      <td>8.05000</td><br>      <td>Mr</td><br>      <td>Allen</td><br>      <td>2</td><br>    </tr><br>  </tbody><br></table><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_data.loc[all_data.FamilySize &gt; <span class="number">2</span>, :].sort_values([<span class="string">'Surname'</span>, <span class="string">'Fare'</span>, <span class="string">'Ticket'</span>]).shape[<span class="number">0</span>]</span><br></pre></td></tr></table></figure><br><br>    406<br><br><br><br><strong>姓氏一共多少种？</strong><br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">len(all_data.Surname.unique()), len(train.Surname.unique()), len(test.Surname.unique())</span><br></pre></td></tr></table></figure><br><br>    (875, 667, 352)<br><br><br><br>#### 同姓却是不同家庭<br><br>启发于：<a href="https://www.kaggle.com/erikbruin" target="_blank" rel="noopener">Erik Bruin</a> 的kernel: <a href="https://www.kaggle.com/erikbruin/titanic-2nd-degree-families-and-majority-voting" target="_blank" rel="noopener">Titanic: 2nd degree families and majority voting</a><br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data_frame = all_data.groupby([<span class="string">'Surname'</span>, <span class="string">'Ticket'</span>, <span class="string">'Fare'</span>, <span class="string">'Pclass'</span>, <span class="string">'Embarked'</span>, <span class="string">'Name'</span>, <span class="string">'Age'</span>, <span class="string">'SibSp'</span>, <span class="string">'Parch'</span>])[ <span class="string">'Survived'</span>].count().to_frame()</span><br><span class="line">data_frame.head(<span class="number">10</span>)</span><br></pre></td></tr></table></figure><br><br><table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th></th><br>      <th></th><br>      <th></th><br>      <th></th><br>      <th></th><br>      <th></th><br>      <th></th><br>      <th></th><br>      <th>Survived</th><br>    </tr><br>    <tr><br>      <th>Surname</th><br>      <th>Ticket</th><br>      <th>Fare</th><br>      <th>Pclass</th><br>      <th>Embarked</th><br>      <th>Name</th><br>      <th>Age</th><br>      <th>SibSp</th><br>      <th>Parch</th><br>      <th></th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>Abbing</th><br>      <th>C.A. 5547</th><br>      <th>7.5500</th><br>      <th>3</th><br>      <th>S</th><br>      <th>Abbing, Mr. Anthony</th><br>      <th>42.0</th><br>      <th>0</th><br>      <th>0</th><br>      <td>1</td><br>    </tr><br>    <tr><br>      <th rowspan="3" valign="top">Abbott</th><br>      <th rowspan="3" valign="top">C.A. 2673</th><br>      <th rowspan="3" valign="top">20.2500</th><br>      <th rowspan="3" valign="top">3</th><br>      <th rowspan="3" valign="top">S</th><br>      <th>Abbott, Master. Eugene Joseph</th><br>      <th>13.0</th><br>      <th>0</th><br>      <th>2</th><br>      <td>0</td><br>    </tr><br>    <tr><br>      <th>Abbott, Mr. Rossmore Edward</th><br>      <th>16.0</th><br>      <th>1</th><br>      <th>1</th><br>      <td>1</td><br>    </tr><br>    <tr><br>      <th>Abbott, Mrs. Stanton (Rosa Hunt)</th><br>      <th>35.0</th><br>      <th>1</th><br>      <th>1</th><br>      <td>1</td><br>    </tr><br>    <tr><br>      <th rowspan="2" valign="top">Abelseth</th><br>      <th>348122</th><br>      <th>7.6500</th><br>      <th>3</th><br>      <th>S</th><br>      <th>Abelseth, Mr. Olaus Jorgensen</th><br>      <th>25.0</th><br>      <th>0</th><br>      <th>0</th><br>      <td>0</td><br>    </tr><br>    <tr><br>      <th>348125</th><br>      <th>7.6500</th><br>      <th>3</th><br>      <th>S</th><br>      <th>Abelseth, Miss. Karen Marie</th><br>      <th>16.0</th><br>      <th>0</th><br>      <th>0</th><br>      <td>0</td><br>    </tr><br>    <tr><br>      <th rowspan="2" valign="top">Abelson</th><br>      <th rowspan="2" valign="top">P/PP 3381</th><br>      <th rowspan="2" valign="top">24.0000</th><br>      <th rowspan="2" valign="top">2</th><br>      <th rowspan="2" valign="top">C</th><br>      <th>Abelson, Mr. Samuel</th><br>      <th>30.0</th><br>      <th>1</th><br>      <th>0</th><br>      <td>1</td><br>    </tr><br>    <tr><br>      <th>Abelson, Mrs. Samuel (Hannah Wizosky)</th><br>      <th>28.0</th><br>      <th>1</th><br>      <th>0</th><br>      <td>1</td><br>    </tr><br>    <tr><br>      <th>Abrahamsson</th><br>      <th>SOTON/O2 3101284</th><br>      <th>7.9250</th><br>      <th>3</th><br>      <th>S</th><br>      <th>Abrahamsson, Mr. Abraham August Johannes</th><br>      <th>20.0</th><br>      <th>0</th><br>      <th>0</th><br>      <td>0</td><br>    </tr><br>    <tr><br>      <th>Abrahim</th><br>      <th>2657</th><br>      <th>7.2292</th><br>      <th>3</th><br>      <th>C</th><br>      <th>Abrahim, Mrs. Joseph (Sophie Halaut Easu)</th><br>      <th>18.0</th><br>      <th>0</th><br>      <th>0</th><br>      <td>0</td><br>    </tr><br>  </tbody><br></table><br><br><strong>例1：姓氏为Andersson的乘客</strong><br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tmp = data_frame.loc[[<span class="string">'Andersson'</span>]]</span><br><span class="line">tmp.sort_index(level=[<span class="number">0</span>, <span class="number">2</span>])</span><br></pre></td></tr></table></figure><br><br><table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th></th><br>      <th></th><br>      <th></th><br>      <th></th><br>      <th></th><br>      <th></th><br>      <th></th><br>      <th></th><br>      <th>Survived</th><br>    </tr><br>    <tr><br>      <th>Surname</th><br>      <th>Ticket</th><br>      <th>Fare</th><br>      <th>Pclass</th><br>      <th>Embarked</th><br>      <th>Name</th><br>      <th>Age</th><br>      <th>SibSp</th><br>      <th>Parch</th><br>      <th></th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th rowspan="11" valign="top">Andersson</th><br>      <th>347075</th><br>      <th>7.7750</th><br>      <th>3</th><br>      <th>S</th><br>      <th>Andersson, Mr. Johan Samuel</th><br>      <th>26.0</th><br>      <th>0</th><br>      <th>0</th><br>      <td>0</td><br>    </tr><br>    <tr><br>      <th>347091</th><br>      <th>7.7750</th><br>      <th>3</th><br>      <th>S</th><br>      <th>Andersson, Miss. Ida Augusta Margareta</th><br>      <th>38.0</th><br>      <th>4</th><br>      <th>2</th><br>      <td>0</td><br>    </tr><br>    <tr><br>      <th>350043</th><br>      <th>7.7958</th><br>      <th>3</th><br>      <th>S</th><br>      <th>Andersson, Mr. August Edvard (“Wennerstrom”)</th><br>      <th>27.0</th><br>      <th>0</th><br>      <th>0</th><br>      <td>1</td><br>    </tr><br>    <tr><br>      <th>3101281</th><br>      <th>7.9250</th><br>      <th>3</th><br>      <th>S</th><br>      <th>Andersson, Miss. Erna Alexandra</th><br>      <th>17.0</th><br>      <th>4</th><br>      <th>2</th><br>      <td>1</td><br>    </tr><br>    <tr><br>      <th rowspan="7" valign="top">347082</th><br>      <th rowspan="7" valign="top">31.2750</th><br>      <th rowspan="7" valign="top">3</th><br>      <th rowspan="7" valign="top">S</th><br>      <th>Andersson, Master. Sigvard Harald Elias</th><br>      <th>4.0</th><br>      <th>4</th><br>      <th>2</th><br>      <td>1</td><br>    </tr><br>    <tr><br>      <th>Andersson, Miss. Ebba Iris Alfrida</th><br>      <th>6.0</th><br>      <th>4</th><br>      <th>2</th><br>      <td>1</td><br>    </tr><br>    <tr><br>      <th>Andersson, Miss. Ellis Anna Maria</th><br>      <th>2.0</th><br>      <th>4</th><br>      <th>2</th><br>      <td>1</td><br>    </tr><br>    <tr><br>      <th>Andersson, Miss. Ingeborg Constanzia</th><br>      <th>9.0</th><br>      <th>4</th><br>      <th>2</th><br>      <td>1</td><br>    </tr><br>    <tr><br>      <th>Andersson, Miss. Sigrid Elisabeth</th><br>      <th>11.0</th><br>      <th>4</th><br>      <th>2</th><br>      <td>1</td><br>    </tr><br>    <tr><br>      <th>Andersson, Mr. Anders Johan</th><br>      <th>39.0</th><br>      <th>1</th><br>      <th>5</th><br>      <td>1</td><br>    </tr><br>    <tr><br>      <th>Andersson, Mrs. Anders Johan (Alfrida Konstantia Brogren)</th><br>      <th>39.0</th><br>      <th>1</th><br>      <th>5</th><br>      <td>1</td><br>    </tr><br>  </tbody><br></table><br><br>虽然这些人姓氏都是 <code>Andersson</code>， 但是他们却来自不同的家庭，证据：<code>Ticket, Fare</code> 差别很大，因此不能将他们简单地按姓氏分成一组。<br>根据 <code>FamilySize = Parch + SipSp + 1</code>， 我们得到如下：<br>1. 最后7个人数据能对上，铁定为至亲的一家人。<br>2. 至于第2行与第4行的极有可能是他们的 <code>SibSp, Parch</code> 数据有误，有可能最后家庭成员取消出行，却这两列数据没有修改。<br>    - 那么如果第2行的数据 <code>SibSp, Parch</code> 均为0，那么可能1,2行两个人有关系，可能是表亲或堂亲（毕竟只是票号最后两位不同），只是猜测，证据不足，。<br>    - 然而 <code>3,4</code> 行的乘客数据与其他行差别较大。<br><br><br><font color="red">注意：</font> <code>SibSp, Parch</code> 两个特征数据经常有误，因此至亲的一家人的大小：<code>FamiliySize = SibSp + Parch + 1</code> 并不靠谱，后面例子也可以看到。<br><br><strong>例2：姓氏为Brown的乘客</strong><br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tmp = all_data.loc[(all_data.Surname == <span class="string">'Brown'</span>)].sort_values(by=[<span class="string">'Surname'</span>, <span class="string">'Fare'</span>, <span class="string">'Ticket'</span>])</span><br><span class="line"></span><br><span class="line">tmp.loc[:, [<span class="string">'Surname'</span>, <span class="string">'Fare'</span>, <span class="string">'Ticket'</span>, <span class="string">'Pclass'</span>, <span class="string">'Embarked'</span>, <span class="string">'Cabin'</span>, <span class="string">'Name'</span>, <span class="string">'SibSp'</span>, <span class="string">'Parch'</span>, <span class="string">'Age'</span>, <span class="string">'PassengerId'</span>]]</span><br></pre></td></tr></table></figure><br><br><table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>Surname</th><br>      <th>Fare</th><br>      <th>Ticket</th><br>      <th>Pclass</th><br>      <th>Embarked</th><br>      <th>Cabin</th><br>      <th>Name</th><br>      <th>SibSp</th><br>      <th>Parch</th><br>      <th>Age</th><br>      <th>PassengerId</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>345</th><br>      <td>Brown</td><br>      <td>13.0000</td><br>      <td>248733</td><br>      <td>2</td><br>      <td>S</td><br>      <td>F33</td><br>      <td>Brown, Miss. Amelia “Mildred”</td><br>      <td>0</td><br>      <td>0</td><br>      <td>24.0</td><br>      <td>346</td><br>    </tr><br>    <tr><br>      <th>194</th><br>      <td>Brown</td><br>      <td>27.7208</td><br>      <td>PC 17610</td><br>      <td>1</td><br>      <td>C</td><br>      <td>B4</td><br>      <td>Brown, Mrs. James Joseph (Margaret Tobin)</td><br>      <td>0</td><br>      <td>0</td><br>      <td>44.0</td><br>      <td>195</td><br>    </tr><br>    <tr><br>      <th>670</th><br>      <td>Brown</td><br>      <td>39.0000</td><br>      <td>29750</td><br>      <td>2</td><br>      <td>S</td><br>      <td>NaN</td><br>      <td>Brown, Mrs. Thomas William Solomon (Elizabeth …</td><br>      <td>1</td><br>      <td>1</td><br>      <td>40.0</td><br>      <td>671</td><br>    </tr><br>    <tr><br>      <th>684</th><br>      <td>Brown</td><br>      <td>39.0000</td><br>      <td>29750</td><br>      <td>2</td><br>      <td>S</td><br>      <td>NaN</td><br>      <td>Brown, Mr. Thomas William Solomon</td><br>      <td>1</td><br>      <td>1</td><br>      <td>60.0</td><br>      <td>685</td><br>    </tr><br>    <tr><br>      <th>1066</th><br>      <td>Brown</td><br>      <td>39.0000</td><br>      <td>29750</td><br>      <td>2</td><br>      <td>S</td><br>      <td>NaN</td><br>      <td>Brown, Miss. Edith Eileen</td><br>      <td>0</td><br>      <td>2</td><br>      <td>15.0</td><br>      <td>1067</td><br>    </tr><br>    <tr><br>      <th>1247</th><br>      <td>Brown</td><br>      <td>51.4792</td><br>      <td>11769</td><br>      <td>1</td><br>      <td>S</td><br>      <td>C101</td><br>      <td>Brown, Mrs. John Murray (Caroline Lane Lamson)</td><br>      <td>2</td><br>      <td>0</td><br>      <td>59.0</td><br>      <td>1248</td><br>    </tr><br>  </tbody><br></table><br><br>虽然这些人姓氏都是 <code>Brown</code>，但是根据 <code>Fare, Ticket, Pclass, Embarked, SibSp, Parch</code> 差别明显，只有第3~5行为一个至亲家庭，即这里面有来自4个家庭的人。<br><br><strong>例3：姓氏为 Betros Attalah 的乘客</strong><br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tmp = all_data.loc[(all_data.Surname == <span class="string">'Betros'</span>) | (all_data.Surname == <span class="string">'Attalah'</span>)].sort_values(by=[<span class="string">'Surname'</span>, <span class="string">'Fare'</span>, <span class="string">'Ticket'</span>])</span><br><span class="line"></span><br><span class="line">tmp.loc[:, [<span class="string">'Surname'</span>, <span class="string">'Fare'</span>, <span class="string">'Ticket'</span>, <span class="string">'Pclass'</span>, <span class="string">'Embarked'</span>, <span class="string">'Cabin'</span>, <span class="string">'Name'</span>, <span class="string">'SibSp'</span>, <span class="string">'Parch'</span>, <span class="string">'Age'</span>, <span class="string">'PassengerId'</span>]]</span><br></pre></td></tr></table></figure><br><br><table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>Surname</th><br>      <th>Fare</th><br>      <th>Ticket</th><br>      <th>Pclass</th><br>      <th>Embarked</th><br>      <th>Cabin</th><br>      <th>Name</th><br>      <th>SibSp</th><br>      <th>Parch</th><br>      <th>Age</th><br>      <th>PassengerId</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>244</th><br>      <td>Attalah</td><br>      <td>7.2250</td><br>      <td>2694</td><br>      <td>3</td><br>      <td>C</td><br>      <td>NaN</td><br>      <td>Attalah, Mr. Sleiman</td><br>      <td>0</td><br>      <td>0</td><br>      <td>30.0</td><br>      <td>245</td><br>    </tr><br>    <tr><br>      <th>114</th><br>      <td>Attalah</td><br>      <td>14.4583</td><br>      <td>2627</td><br>      <td>3</td><br>      <td>C</td><br>      <td>NaN</td><br>      <td>Attalah, Miss. Malake</td><br>      <td>0</td><br>      <td>0</td><br>      <td>17.0</td><br>      <td>115</td><br>    </tr><br>    <tr><br>      <th>378</th><br>      <td>Betros</td><br>      <td>4.0125</td><br>      <td>2648</td><br>      <td>3</td><br>      <td>C</td><br>      <td>NaN</td><br>      <td>Betros, Mr. Tannous</td><br>      <td>0</td><br>      <td>0</td><br>      <td>20.0</td><br>      <td>379</td><br>    </tr><br>    <tr><br>      <th>1230</th><br>      <td>Betros</td><br>      <td>7.2292</td><br>      <td>2622</td><br>      <td>3</td><br>      <td>C</td><br>      <td>NaN</td><br>      <td>Betros, Master. Seman</td><br>      <td>0</td><br>      <td>0</td><br>      <td>NaN</td><br>      <td>1231</td><br>    </tr><br>  </tbody><br></table><br><br>同理，由于 <code>Fare, Ticket</code> 均差别较大，且<code>SibSp, Parch</code> 均为0，因此判断他们都是单独出行，不是一家人。<br><br>#### 堂兄弟堂姐妹（孙子辈）或者叔侄辈<br><br><strong>姓氏相同，票价相同， 票号仅仅最后2位不同</strong>，由于：<code>SibSp=0, Parch=0</code> 那么很有可能是<strong>堂兄弟堂姐妹或者叔侄</strong>？<br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tmp = all_data.loc[all_data.Surname.isin([<span class="string">'Ali'</span>, <span class="string">'Cacic'</span>, <span class="string">'Abelseth'</span>, <span class="string">'Hocking'</span>, <span class="string">'Richards'</span>]), :].sort_values(by=[<span class="string">'Surname'</span>, <span class="string">'Ticket'</span>, <span class="string">'Fare'</span>])</span><br><span class="line"></span><br><span class="line">tmp.drop([<span class="string">'Surname'</span>, <span class="string">'FamilySize'</span>, <span class="string">'PassengerId'</span>], axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><br><br><table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>Age</th><br>      <th>Cabin</th><br>      <th>Embarked</th><br>      <th>Fare</th><br>      <th>Name</th><br>      <th>Parch</th><br>      <th>Pclass</th><br>      <th>Sex</th><br>      <th>SibSp</th><br>      <th>Survived</th><br>      <th>Ticket</th><br>      <th>TicketSize</th><br>      <th>SingleTicketFare</th><br>      <th>Title</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>948</th><br>      <td>25.00</td><br>      <td>F G63</td><br>      <td>S</td><br>      <td>7.6500</td><br>      <td>Abelseth, Mr. Olaus Jorgensen</td><br>      <td>0</td><br>      <td>3</td><br>      <td>male</td><br>      <td>0</td><br>      <td>NaN</td><br>      <td>348122</td><br>      <td>1</td><br>      <td>7.6500</td><br>      <td>Mr</td><br>    </tr><br>    <tr><br>      <th>1236</th><br>      <td>16.00</td><br>      <td>NaN</td><br>      <td>S</td><br>      <td>7.6500</td><br>      <td>Abelseth, Miss. Karen Marie</td><br>      <td>0</td><br>      <td>3</td><br>      <td>female</td><br>      <td>0</td><br>      <td>NaN</td><br>      <td>348125</td><br>      <td>1</td><br>      <td>7.6500</td><br>      <td>Miss</td><br>    </tr><br>    <tr><br>      <th>210</th><br>      <td>24.00</td><br>      <td>NaN</td><br>      <td>S</td><br>      <td>7.0500</td><br>      <td>Ali, Mr. Ahmed</td><br>      <td>0</td><br>      <td>3</td><br>      <td>male</td><br>      <td>0</td><br>      <td>0.0</td><br>      <td>SOTON/O.Q. 3101311</td><br>      <td>1</td><br>      <td>7.0500</td><br>      <td>Mr</td><br>    </tr><br>    <tr><br>      <th>784</th><br>      <td>25.00</td><br>      <td>NaN</td><br>      <td>S</td><br>      <td>7.0500</td><br>      <td>Ali, Mr. William</td><br>      <td>0</td><br>      <td>3</td><br>      <td>male</td><br>      <td>0</td><br>      <td>0.0</td><br>      <td>SOTON/O.Q. 3101312</td><br>      <td>1</td><br>      <td>7.0500</td><br>      <td>Mr</td><br>    </tr><br>    <tr><br>      <th>534</th><br>      <td>30.00</td><br>      <td>NaN</td><br>      <td>S</td><br>      <td>8.6625</td><br>      <td>Cacic, Miss. Marija</td><br>      <td>0</td><br>      <td>3</td><br>      <td>female</td><br>      <td>0</td><br>      <td>0.0</td><br>      <td>315084</td><br>      <td>1</td><br>      <td>8.6625</td><br>      <td>Miss</td><br>    </tr><br>    <tr><br>      <th>928</th><br>      <td>21.00</td><br>      <td>NaN</td><br>      <td>S</td><br>      <td>8.6625</td><br>      <td>Cacic, Miss. Manda</td><br>      <td>0</td><br>      <td>3</td><br>      <td>female</td><br>      <td>0</td><br>      <td>NaN</td><br>      <td>315087</td><br>      <td>1</td><br>      <td>8.6625</td><br>      <td>Miss</td><br>    </tr><br>    <tr><br>      <th>471</th><br>      <td>38.00</td><br>      <td>NaN</td><br>      <td>S</td><br>      <td>8.6625</td><br>      <td>Cacic, Mr. Luka</td><br>      <td>0</td><br>      <td>3</td><br>      <td>male</td><br>      <td>0</td><br>      <td>0.0</td><br>      <td>315089</td><br>      <td>1</td><br>      <td>8.6625</td><br>      <td>Mr</td><br>    </tr><br>    <tr><br>      <th>1201</th><br>      <td>18.00</td><br>      <td>NaN</td><br>      <td>S</td><br>      <td>8.6625</td><br>      <td>Cacic, Mr. Jego Grga</td><br>      <td>0</td><br>      <td>3</td><br>      <td>male</td><br>      <td>0</td><br>      <td>NaN</td><br>      <td>315091</td><br>      <td>1</td><br>      <td>8.6625</td><br>      <td>Mr</td><br>    </tr><br>    <tr><br>      <th>1120</th><br>      <td>36.00</td><br>      <td>NaN</td><br>      <td>S</td><br>      <td>13.0000</td><br>      <td>Hocking, Mr. Samuel James Metcalfe</td><br>      <td>0</td><br>      <td>2</td><br>      <td>male</td><br>      <td>0</td><br>      <td>NaN</td><br>      <td>242963</td><br>      <td>1</td><br>      <td>13.0000</td><br>      <td>Mr</td><br>    </tr><br>    <tr><br>      <th>529</th><br>      <td>23.00</td><br>      <td>NaN</td><br>      <td>S</td><br>      <td>11.5000</td><br>      <td>Hocking, Mr. Richard George</td><br>      <td>1</td><br>      <td>2</td><br>      <td>male</td><br>      <td>2</td><br>      <td>0.0</td><br>      <td>29104</td><br>      <td>1</td><br>      <td>11.5000</td><br>      <td>Mr</td><br>    </tr><br>    <tr><br>      <th>774</th><br>      <td>54.00</td><br>      <td>NaN</td><br>      <td>S</td><br>      <td>23.0000</td><br>      <td>Hocking, Mrs. Elizabeth (Eliza Needs)</td><br>      <td>3</td><br>      <td>2</td><br>      <td>female</td><br>      <td>1</td><br>      <td>1.0</td><br>      <td>29105</td><br>      <td>2</td><br>      <td>11.5000</td><br>      <td>Mrs</td><br>    </tr><br>    <tr><br>      <th>943</th><br>      <td>20.00</td><br>      <td>NaN</td><br>      <td>S</td><br>      <td>23.0000</td><br>      <td>Hocking, Miss. Ellen Nellie””</td><br>      <td>1</td><br>      <td>2</td><br>      <td>female</td><br>      <td>2</td><br>      <td>NaN</td><br>      <td>29105</td><br>      <td>2</td><br>      <td>11.5000</td><br>      <td>Miss</td><br>    </tr><br>    <tr><br>      <th>407</th><br>      <td>3.00</td><br>      <td>NaN</td><br>      <td>S</td><br>      <td>18.7500</td><br>      <td>Richards, Master. William Rowe</td><br>      <td>1</td><br>      <td>2</td><br>      <td>male</td><br>      <td>1</td><br>      <td>1.0</td><br>      <td>29106</td><br>      <td>3</td><br>      <td>6.2500</td><br>      <td>Master</td><br>    </tr><br>    <tr><br>      <th>437</th><br>      <td>24.00</td><br>      <td>NaN</td><br>      <td>S</td><br>      <td>18.7500</td><br>      <td>Richards, Mrs. Sidney (Emily Hocking)</td><br>      <td>3</td><br>      <td>2</td><br>      <td>female</td><br>      <td>2</td><br>      <td>1.0</td><br>      <td>29106</td><br>      <td>3</td><br>      <td>6.2500</td><br>      <td>Mrs</td><br>    </tr><br>    <tr><br>      <th>831</th><br>      <td>0.83</td><br>      <td>NaN</td><br>      <td>S</td><br>      <td>18.7500</td><br>      <td>Richards, Master. George Sibley</td><br>      <td>1</td><br>      <td>2</td><br>      <td>male</td><br>      <td>1</td><br>      <td>1.0</td><br>      <td>29106</td><br>      <td>3</td><br>      <td>6.2500</td><br>      <td>Master</td><br>    </tr><br>  </tbody><br></table><br><br><font color="red">注意</font>： SibSp, Parch 两个特征数据经常有误，因此至亲的一家人的大小：FamiliySize = SibSp + Parch + 1 并不靠谱，后面例子也可以看到。<br><br>#### 至亲的一家人<br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tmp = all_data.loc[all_data.Surname.isin([<span class="string">'West'</span>, <span class="string">'Abbott'</span>]), :].sort_values(by=[<span class="string">'Surname'</span>, <span class="string">'Fare'</span>, <span class="string">'Ticket'</span>])</span><br><span class="line"></span><br><span class="line">tmp.loc[:, [<span class="string">'Surname'</span>, <span class="string">'Fare'</span>, <span class="string">'Ticket'</span>, <span class="string">'Pclass'</span>, <span class="string">'Embarked'</span>, <span class="string">'Name'</span>, <span class="string">'SibSp'</span>, <span class="string">'Parch'</span>, <span class="string">'Age'</span>, <span class="string">'PassengerId'</span>]]</span><br></pre></td></tr></table></figure><br><br><table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>Surname</th><br>      <th>Fare</th><br>      <th>Ticket</th><br>      <th>Pclass</th><br>      <th>Embarked</th><br>      <th>Name</th><br>      <th>SibSp</th><br>      <th>Parch</th><br>      <th>Age</th><br>      <th>PassengerId</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>279</th><br>      <td>Abbott</td><br>      <td>20.25</td><br>      <td>C.A. 2673</td><br>      <td>3</td><br>      <td>S</td><br>      <td>Abbott, Mrs. Stanton (Rosa Hunt)</td><br>      <td>1</td><br>      <td>1</td><br>      <td>35.00</td><br>      <td>280</td><br>    </tr><br>    <tr><br>      <th>746</th><br>      <td>Abbott</td><br>      <td>20.25</td><br>      <td>C.A. 2673</td><br>      <td>3</td><br>      <td>S</td><br>      <td>Abbott, Mr. Rossmore Edward</td><br>      <td>1</td><br>      <td>1</td><br>      <td>16.00</td><br>      <td>747</td><br>    </tr><br>    <tr><br>      <th>1283</th><br>      <td>Abbott</td><br>      <td>20.25</td><br>      <td>C.A. 2673</td><br>      <td>3</td><br>      <td>S</td><br>      <td>Abbott, Master. Eugene Joseph</td><br>      <td>0</td><br>      <td>2</td><br>      <td>13.00</td><br>      <td>1284</td><br>    </tr><br>    <tr><br>      <th>58</th><br>      <td>West</td><br>      <td>27.75</td><br>      <td>C.A. 34651</td><br>      <td>2</td><br>      <td>S</td><br>      <td>West, Miss. Constance Mirium</td><br>      <td>1</td><br>      <td>2</td><br>      <td>5.00</td><br>      <td>59</td><br>    </tr><br>    <tr><br>      <th>450</th><br>      <td>West</td><br>      <td>27.75</td><br>      <td>C.A. 34651</td><br>      <td>2</td><br>      <td>S</td><br>      <td>West, Mr. Edwy Arthur</td><br>      <td>1</td><br>      <td>2</td><br>      <td>36.00</td><br>      <td>451</td><br>    </tr><br>    <tr><br>      <th>472</th><br>      <td>West</td><br>      <td>27.75</td><br>      <td>C.A. 34651</td><br>      <td>2</td><br>      <td>S</td><br>      <td>West, Mrs. Edwy Arthur (Ada Mary Worth)</td><br>      <td>1</td><br>      <td>2</td><br>      <td>33.00</td><br>      <td>473</td><br>    </tr><br>    <tr><br>      <th>1141</th><br>      <td>West</td><br>      <td>27.75</td><br>      <td>C.A. 34651</td><br>      <td>2</td><br>      <td>S</td><br>      <td>West, Miss. Barbara J</td><br>      <td>1</td><br>      <td>2</td><br>      <td>0.92</td><br>      <td>1142</td><br>    </tr><br>  </tbody><br></table><br><br>1. <code>West</code> 一家人，因为<code>Surname, Fare, Ticket, Pclass, Embarked, SibSp, Parch</code> 数据完全能对上。<br>2. <code>Abbott</code> 也非常像一家人，但是 <code>SibSp, Parch</code> 数据却出现出入，第1行与第3行的 <code>SibSp, Parch</code> 数据似乎互换了（根据前面Master分析，那么Age无误，推测出来）。<br><br><font color="red">注意</font>：1,3行的<code>SibSp, Parch</code> 2个特征数据似乎很有可能又错了。<br><br>#### SurnameGroupId<br><br>根据前面所说，如果至亲一家人和孙子辈、叔侄辈共同出行，我们得到如下一起出行的识别方案：<br><br>1. <code>SurnameGroupId = Surname + Pclass + Embarked + Fare + Ticket[:-2]</code><br>2. 在叔侄辈和孙子辈中，Ticket最后2位不同，所以Ticket最后2位不加考虑，才能识别他们共同出行。<br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">getSurnameGroupId(all_data)</span><br><span class="line"></span><br><span class="line">train = all_data.iloc[:train.shape[<span class="number">0</span>], :]</span><br><span class="line">test = all_data.iloc[train.shape[<span class="number">0</span>]:, :]</span><br></pre></td></tr></table></figure><br><br>我们来看看例子，叔侄关系（Cacic）与至亲一家（Brown）：<br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tmp = all_data.loc[(all_data.Surname == <span class="string">'Brown'</span>) | (all_data.Surname == <span class="string">'Cacic'</span>)].sort_values(by=[<span class="string">'Surname'</span>, <span class="string">'Fare'</span>, <span class="string">'Ticket'</span>])</span><br><span class="line">tmp.loc[:, [<span class="string">'SurnameGroupId'</span>, <span class="string">'Surname'</span>, <span class="string">'Fare'</span>, <span class="string">'Ticket'</span>, <span class="string">'Pclass'</span>, <span class="string">'Embarked'</span>, <span class="string">'Cabin'</span>, <span class="string">'Name'</span>, <span class="string">'SibSp'</span>, <span class="string">'Parch'</span>, <span class="string">'Age'</span>]]</span><br></pre></td></tr></table></figure><br><br><table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>SurnameGroupId</th><br>      <th>Surname</th><br>      <th>Fare</th><br>      <th>Ticket</th><br>      <th>Pclass</th><br>      <th>Embarked</th><br>      <th>Cabin</th><br>      <th>Name</th><br>      <th>SibSp</th><br>      <th>Parch</th><br>      <th>Age</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>345</th><br>      <td>Brown-2-S-13.0-2487__</td><br>      <td>Brown</td><br>      <td>13.0000</td><br>      <td>248733</td><br>      <td>2</td><br>      <td>S</td><br>      <td>F33</td><br>      <td>Brown, Miss. Amelia “Mildred”</td><br>      <td>0</td><br>      <td>0</td><br>      <td>24.0</td><br>    </tr><br>    <tr><br>      <th>194</th><br>      <td>Brown-1-C-27.7208-PC 176__</td><br>      <td>Brown</td><br>      <td>27.7208</td><br>      <td>PC 17610</td><br>      <td>1</td><br>      <td>C</td><br>      <td>B4</td><br>      <td>Brown, Mrs. James Joseph (Margaret Tobin)</td><br>      <td>0</td><br>      <td>0</td><br>      <td>44.0</td><br>    </tr><br>    <tr><br>      <th>670</th><br>      <td>Brown-2-S-39.0-297__</td><br>      <td>Brown</td><br>      <td>39.0000</td><br>      <td>29750</td><br>      <td>2</td><br>      <td>S</td><br>      <td>NaN</td><br>      <td>Brown, Mrs. Thomas William Solomon (Elizabeth …</td><br>      <td>1</td><br>      <td>1</td><br>      <td>40.0</td><br>    </tr><br>    <tr><br>      <th>684</th><br>      <td>Brown-2-S-39.0-297__</td><br>      <td>Brown</td><br>      <td>39.0000</td><br>      <td>29750</td><br>      <td>2</td><br>      <td>S</td><br>      <td>NaN</td><br>      <td>Brown, Mr. Thomas William Solomon</td><br>      <td>1</td><br>      <td>1</td><br>      <td>60.0</td><br>    </tr><br>    <tr><br>      <th>1066</th><br>      <td>Brown-2-S-39.0-297__</td><br>      <td>Brown</td><br>      <td>39.0000</td><br>      <td>29750</td><br>      <td>2</td><br>      <td>S</td><br>      <td>NaN</td><br>      <td>Brown, Miss. Edith Eileen</td><br>      <td>0</td><br>      <td>2</td><br>      <td>15.0</td><br>    </tr><br>    <tr><br>      <th>1247</th><br>      <td>Brown-1-S-51.4792-117__</td><br>      <td>Brown</td><br>      <td>51.4792</td><br>      <td>11769</td><br>      <td>1</td><br>      <td>S</td><br>      <td>C101</td><br>      <td>Brown, Mrs. John Murray (Caroline Lane Lamson)</td><br>      <td>2</td><br>      <td>0</td><br>      <td>59.0</td><br>    </tr><br>    <tr><br>      <th>534</th><br>      <td>Cacic-3-S-8.6625-3150__</td><br>      <td>Cacic</td><br>      <td>8.6625</td><br>      <td>315084</td><br>      <td>3</td><br>      <td>S</td><br>      <td>NaN</td><br>      <td>Cacic, Miss. Marija</td><br>      <td>0</td><br>      <td>0</td><br>      <td>30.0</td><br>    </tr><br>    <tr><br>      <th>928</th><br>      <td>Cacic-3-S-8.6625-3150__</td><br>      <td>Cacic</td><br>      <td>8.6625</td><br>      <td>315087</td><br>      <td>3</td><br>      <td>S</td><br>      <td>NaN</td><br>      <td>Cacic, Miss. Manda</td><br>      <td>0</td><br>      <td>0</td><br>      <td>21.0</td><br>    </tr><br>    <tr><br>      <th>471</th><br>      <td>Cacic-3-S-8.6625-3150__</td><br>      <td>Cacic</td><br>      <td>8.6625</td><br>      <td>315089</td><br>      <td>3</td><br>      <td>S</td><br>      <td>NaN</td><br>      <td>Cacic, Mr. Luka</td><br>      <td>0</td><br>      <td>0</td><br>      <td>38.0</td><br>    </tr><br>    <tr><br>      <th>1201</th><br>      <td>Cacic-3-S-8.6625-3150__</td><br>      <td>Cacic</td><br>      <td>8.6625</td><br>      <td>315091</td><br>      <td>3</td><br>      <td>S</td><br>      <td>NaN</td><br>      <td>Cacic, Mr. Jego Grga</td><br>      <td>0</td><br>      <td>0</td><br>      <td>18.0</td><br>    </tr><br>  </tbody><br></table><br><br>上表就很明显的看出 <code>GroupId</code> 比 <code>Surname</code> 在识别哪些人是一起出行这方面更有区分度。<br><br><strong><code>GroupId</code> 到底区分了多少一起出行的人？</strong> 如下：<br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">len(all_data.SurnameGroupId.unique()), len(train.SurnameGroupId.unique()), len(test.SurnameGroupId.unique())</span><br></pre></td></tr></table></figure><br><br>    (991, 726, 373)<br><br><br><br>#### 保姆和亲戚组<br><br>来看看 <code>Ticket == &#39;PC 17608&#39;</code>, <code>Fare Ticket Pclass Embarked</code>一模一样， <code>Cabin</code>也相近，根据 <code>SibSp Parch</code> 数据推测是保姆或者非同姓亲戚（比如：表亲），当然到底有木有说服力最终还是看预测的结果，我们先保持怀疑的态度。<br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_data.loc[(all_data.Ticket == <span class="string">'PC 17608'</span>), [<span class="string">'SurnameGroupId'</span>, <span class="string">'Fare'</span>, <span class="string">'Ticket'</span>, <span class="string">'Pclass'</span>, <span class="string">'Embarked'</span>, <span class="string">'Cabin'</span>, <span class="string">'Name'</span>, <span class="string">'SibSp'</span>, <span class="string">'Parch'</span>, <span class="string">'Age'</span>]].sort_values(by=[<span class="string">'SurnameGroupId'</span>])</span><br></pre></td></tr></table></figure><br><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>SurnameGroupId</th><br>      <th>Fare</th><br>      <th>Ticket</th><br>      <th>Pclass</th><br>      <th>Embarked</th><br>      <th>Cabin</th><br>      <th>Name</th><br>      <th>SibSp</th><br>      <th>Parch</th><br>      <th>Age</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>1266</th><br>      <td>Bowen-1-C-262.375-PC 176__</td><br>      <td>262.375</td><br>      <td>PC 17608</td><br>      <td>1</td><br>      <td>C</td><br>      <td>NaN</td><br>      <td>Bowen, Miss. Grace Scott</td><br>      <td>0</td><br>      <td>0</td><br>      <td>45.0</td><br>    </tr><br>    <tr><br>      <th>950</th><br>      <td>Chaudanson-1-C-262.375-PC 176__</td><br>      <td>262.375</td><br>      <td>PC 17608</td><br>      <td>1</td><br>      <td>C</td><br>      <td>B61</td><br>      <td>Chaudanson, Miss. Victorine</td><br>      <td>0</td><br>      <td>0</td><br>      <td>36.0</td><br>    </tr><br>    <tr><br>      <th>311</th><br>      <td>Ryerson-1-C-262.375-PC 176__</td><br>      <td>262.375</td><br>      <td>PC 17608</td><br>      <td>1</td><br>      <td>C</td><br>      <td>B57 B59 B63 B66</td><br>      <td>Ryerson, Miss. Emily Borie</td><br>      <td>2</td><br>      <td>2</td><br>      <td>18.0</td><br>    </tr><br>    <tr><br>      <th>742</th><br>      <td>Ryerson-1-C-262.375-PC 176__</td><br>      <td>262.375</td><br>      <td>PC 17608</td><br>      <td>1</td><br>      <td>C</td><br>      <td>B57 B59 B63 B66</td><br>      <td>Ryerson, Miss. Susan Parker “Suzette”</td><br>      <td>2</td><br>      <td>2</td><br>      <td>21.0</td><br>    </tr><br>    <tr><br>      <th>915</th><br>      <td>Ryerson-1-C-262.375-PC 176__</td><br>      <td>262.375</td><br>      <td>PC 17608</td><br>      <td>1</td><br>      <td>C</td><br>      <td>B57 B59 B63 B66</td><br>      <td>Ryerson, Mrs. Arthur Larned (Emily Maria Borie)</td><br>      <td>1</td><br>      <td>3</td><br>      <td>48.0</td><br>    </tr><br>    <tr><br>      <th>955</th><br>      <td>Ryerson-1-C-262.375-PC 176__</td><br>      <td>262.375</td><br>      <td>PC 17608</td><br>      <td>1</td><br>      <td>C</td><br>      <td>B57 B59 B63 B66</td><br>      <td>Ryerson, Master. John Borie</td><br>      <td>2</td><br>      <td>2</td><br>      <td>13.0</td><br>    </tr><br>    <tr><br>      <th>1033</th><br>      <td>Ryerson-1-C-262.375-PC 176__</td><br>      <td>262.375</td><br>      <td>PC 17608</td><br>      <td>1</td><br>      <td>C</td><br>      <td>B57 B59 B63 B66</td><br>      <td>Ryerson, Mr. Arthur Larned</td><br>      <td>1</td><br>      <td>3</td><br>      <td>61.0</td><br>    </tr><br>  </tbody><br></table><br><br>#### 朋友团队组<br><br>例子：<br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_data[all_data.Ticket == <span class="string">'113572'</span>]</span><br></pre></td></tr></table></figure><br><br><table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>Age</th><br>      <th>Cabin</th><br>      <th>Embarked</th><br>      <th>Fare</th><br>      <th>Name</th><br>      <th>Parch</th><br>      <th>PassengerId</th><br>      <th>Pclass</th><br>      <th>Sex</th><br>      <th>SibSp</th><br>      <th>Survived</th><br>      <th>Ticket</th><br>      <th>TicketSize</th><br>      <th>SingleTicketFare</th><br>      <th>Title</th><br>      <th>Surname</th><br>      <th>FamilySize</th><br>      <th>SurnameGroupId</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>61</th><br>      <td>38.0</td><br>      <td>B28</td><br>      <td>NaN</td><br>      <td>80.0</td><br>      <td>Icard, Miss. Amelie</td><br>      <td>0</td><br>      <td>62</td><br>      <td>1</td><br>      <td>female</td><br>      <td>0</td><br>      <td>1.0</td><br>      <td>113572</td><br>      <td>2</td><br>      <td>40.0</td><br>      <td>Miss</td><br>      <td>Icard</td><br>      <td>1</td><br>      <td>Icard-1-nan-80.0-1135__</td><br>    </tr><br>    <tr><br>      <th>829</th><br>      <td>62.0</td><br>      <td>B28</td><br>      <td>NaN</td><br>      <td>80.0</td><br>      <td>Stone, Mrs. George Nelson (Martha Evelyn)</td><br>      <td>0</td><br>      <td>830</td><br>      <td>1</td><br>      <td>female</td><br>      <td>0</td><br>      <td>1.0</td><br>      <td>113572</td><br>      <td>2</td><br>      <td>40.0</td><br>      <td>Mrs</td><br>      <td>Stone</td><br>      <td>1</td><br>      <td>Stone-1-nan-80.0-1135__</td><br>    </tr><br>  </tbody><br></table><br><br>尽管这2位乘客：<code>Surname, Name</code> 都不一致，<code>SibSp, Parch</code> 均为0，但是 <code>Pclass, Embarked, Fare, Ticket, Cabin</code> 完全一致，因此我们怀疑他们是朋友或同事？唯一疑问点：年龄差距比较大。<br><br>下面一组情况也类似：<br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_data.loc[(all_data.Ticket == <span class="string">'1601'</span>), [<span class="string">'SurnameGroupId'</span>, <span class="string">'Surname'</span>, <span class="string">'Fare'</span>, <span class="string">'Ticket'</span>, <span class="string">'Pclass'</span>, <span class="string">'Embarked'</span>, <span class="string">'Cabin'</span>, <span class="string">'Name'</span>, <span class="string">'SibSp'</span>, <span class="string">'Parch'</span>, <span class="string">'Age'</span>]].sort_values([<span class="string">'Surname'</span>])</span><br></pre></td></tr></table></figure><br><br><table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>SurnameGroupId</th><br>      <th>Surname</th><br>      <th>Fare</th><br>      <th>Ticket</th><br>      <th>Pclass</th><br>      <th>Embarked</th><br>      <th>Cabin</th><br>      <th>Name</th><br>      <th>SibSp</th><br>      <th>Parch</th><br>      <th>Age</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>74</th><br>      <td>Bing-3-S-56.4958-16__</td><br>      <td>Bing</td><br>      <td>56.4958</td><br>      <td>1601</td><br>      <td>3</td><br>      <td>S</td><br>      <td>NaN</td><br>      <td>Bing, Mr. Lee</td><br>      <td>0</td><br>      <td>0</td><br>      <td>32.0</td><br>    </tr><br>    <tr><br>      <th>838</th><br>      <td>Chip-3-S-56.4958-16__</td><br>      <td>Chip</td><br>      <td>56.4958</td><br>      <td>1601</td><br>      <td>3</td><br>      <td>S</td><br>      <td>NaN</td><br>      <td>Chip, Mr. Chang</td><br>      <td>0</td><br>      <td>0</td><br>      <td>32.0</td><br>    </tr><br>    <tr><br>      <th>643</th><br>      <td>Foo-3-S-56.4958-16__</td><br>      <td>Foo</td><br>      <td>56.4958</td><br>      <td>1601</td><br>      <td>3</td><br>      <td>S</td><br>      <td>NaN</td><br>      <td>Foo, Mr. Choong</td><br>      <td>0</td><br>      <td>0</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>930</th><br>      <td>Hee-3-S-56.4958-16__</td><br>      <td>Hee</td><br>      <td>56.4958</td><br>      <td>1601</td><br>      <td>3</td><br>      <td>S</td><br>      <td>NaN</td><br>      <td>Hee, Mr. Ling</td><br>      <td>0</td><br>      <td>0</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>692</th><br>      <td>Lam-3-S-56.4958-16__</td><br>      <td>Lam</td><br>      <td>56.4958</td><br>      <td>1601</td><br>      <td>3</td><br>      <td>S</td><br>      <td>NaN</td><br>      <td>Lam, Mr. Ali</td><br>      <td>0</td><br>      <td>0</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>826</th><br>      <td>Lam-3-S-56.4958-16__</td><br>      <td>Lam</td><br>      <td>56.4958</td><br>      <td>1601</td><br>      <td>3</td><br>      <td>S</td><br>      <td>NaN</td><br>      <td>Lam, Mr. Len</td><br>      <td>0</td><br>      <td>0</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>509</th><br>      <td>Lang-3-S-56.4958-16__</td><br>      <td>Lang</td><br>      <td>56.4958</td><br>      <td>1601</td><br>      <td>3</td><br>      <td>S</td><br>      <td>NaN</td><br>      <td>Lang, Mr. Fang</td><br>      <td>0</td><br>      <td>0</td><br>      <td>26.0</td><br>    </tr><br>    <tr><br>      <th>169</th><br>      <td>Ling-3-S-56.4958-16__</td><br>      <td>Ling</td><br>      <td>56.4958</td><br>      <td>1601</td><br>      <td>3</td><br>      <td>S</td><br>      <td>NaN</td><br>      <td>Ling, Mr. Lee</td><br>      <td>0</td><br>      <td>0</td><br>      <td>28.0</td><br>    </tr><br>  </tbody><br></table><br><br><br>#### TicketGroupId<br><br><strong>为了识别出保姆、表亲（甚至远亲）、朋友一起出行的情况，构建新的特征</strong>：<code>TicketGroupId = Pclass-Embarked-Fare-Ticket</code> 如下所示：<br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">getTicketGroupId(all_data)</span><br><span class="line"></span><br><span class="line">train = all_data.iloc[:train.shape[<span class="number">0</span>], :]</span><br><span class="line">test = all_data.iloc[train.shape[<span class="number">0</span>]:, :]</span><br></pre></td></tr></table></figure><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">len(all_data.TicketGroupId.unique()), len(train.TicketGroupId.unique()), len(test.TicketGroupId.unique())</span><br></pre></td></tr></table></figure><br><br>    (932, 684, 363)<br><br><br><br>再来看看经过 <code>TicketGroupId</code> 处理后前面2种情况：<br><br>1.可能是保姆的情况：<br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_data.loc[(all_data.Ticket == <span class="string">'PC 17608'</span>), [<span class="string">'TicketGroupId'</span>, <span class="string">'Ticket'</span>, <span class="string">'SurnameGroupId'</span>, <span class="string">'Surname'</span>, <span class="string">'Fare'</span>, <span class="string">'Pclass'</span>, <span class="string">'Embarked'</span>, <span class="string">'Cabin'</span>, <span class="string">'Name'</span>, <span class="string">'SibSp'</span>, <span class="string">'Parch'</span>, <span class="string">'Age'</span>, <span class="string">'Sex'</span>]].sort_values(by=[<span class="string">'TicketGroupId'</span>, <span class="string">'SurnameGroupId'</span>])</span><br></pre></td></tr></table></figure><br><br><table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>TicketGroupId</th><br>      <th>Ticket</th><br>      <th>SurnameGroupId</th><br>      <th>Surname</th><br>      <th>Fare</th><br>      <th>Pclass</th><br>      <th>Embarked</th><br>      <th>Cabin</th><br>      <th>Name</th><br>      <th>SibSp</th><br>      <th>Parch</th><br>      <th>Age</th><br>      <th>Sex</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>1266</th><br>      <td>1-C-262.375-PC 17608</td><br>      <td>PC 17608</td><br>      <td>Bowen-1-C-262.375-PC 176__</td><br>      <td>Bowen</td><br>      <td>262.375</td><br>      <td>1</td><br>      <td>C</td><br>      <td>NaN</td><br>      <td>Bowen, Miss. Grace Scott</td><br>      <td>0</td><br>      <td>0</td><br>      <td>45.0</td><br>      <td>female</td><br>    </tr><br>    <tr><br>      <th>950</th><br>      <td>1-C-262.375-PC 17608</td><br>      <td>PC 17608</td><br>      <td>Chaudanson-1-C-262.375-PC 176__</td><br>      <td>Chaudanson</td><br>      <td>262.375</td><br>      <td>1</td><br>      <td>C</td><br>      <td>B61</td><br>      <td>Chaudanson, Miss. Victorine</td><br>      <td>0</td><br>      <td>0</td><br>      <td>36.0</td><br>      <td>female</td><br>    </tr><br>    <tr><br>      <th>311</th><br>      <td>1-C-262.375-PC 17608</td><br>      <td>PC 17608</td><br>      <td>Ryerson-1-C-262.375-PC 176__</td><br>      <td>Ryerson</td><br>      <td>262.375</td><br>      <td>1</td><br>      <td>C</td><br>      <td>B57 B59 B63 B66</td><br>      <td>Ryerson, Miss. Emily Borie</td><br>      <td>2</td><br>      <td>2</td><br>      <td>18.0</td><br>      <td>female</td><br>    </tr><br>    <tr><br>      <th>742</th><br>      <td>1-C-262.375-PC 17608</td><br>      <td>PC 17608</td><br>      <td>Ryerson-1-C-262.375-PC 176__</td><br>      <td>Ryerson</td><br>      <td>262.375</td><br>      <td>1</td><br>      <td>C</td><br>      <td>B57 B59 B63 B66</td><br>      <td>Ryerson, Miss. Susan Parker “Suzette”</td><br>      <td>2</td><br>      <td>2</td><br>      <td>21.0</td><br>      <td>female</td><br>    </tr><br>    <tr><br>      <th>915</th><br>      <td>1-C-262.375-PC 17608</td><br>      <td>PC 17608</td><br>      <td>Ryerson-1-C-262.375-PC 176__</td><br>      <td>Ryerson</td><br>      <td>262.375</td><br>      <td>1</td><br>      <td>C</td><br>      <td>B57 B59 B63 B66</td><br>      <td>Ryerson, Mrs. Arthur Larned (Emily Maria Borie)</td><br>      <td>1</td><br>      <td>3</td><br>      <td>48.0</td><br>      <td>female</td><br>    </tr><br>    <tr><br>      <th>955</th><br>      <td>1-C-262.375-PC 17608</td><br>      <td>PC 17608</td><br>      <td>Ryerson-1-C-262.375-PC 176__</td><br>      <td>Ryerson</td><br>      <td>262.375</td><br>      <td>1</td><br>      <td>C</td><br>      <td>B57 B59 B63 B66</td><br>      <td>Ryerson, Master. John Borie</td><br>      <td>2</td><br>      <td>2</td><br>      <td>13.0</td><br>      <td>male</td><br>    </tr><br>    <tr><br>      <th>1033</th><br>      <td>1-C-262.375-PC 17608</td><br>      <td>PC 17608</td><br>      <td>Ryerson-1-C-262.375-PC 176__</td><br>      <td>Ryerson</td><br>      <td>262.375</td><br>      <td>1</td><br>      <td>C</td><br>      <td>B57 B59 B63 B66</td><br>      <td>Ryerson, Mr. Arthur Larned</td><br>      <td>1</td><br>      <td>3</td><br>      <td>61.0</td><br>      <td>male</td><br>    </tr><br>  </tbody><br></table><br><br>2.可能是朋友伴随出行的情况：<br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_data.loc[ (all_data.Ticket == <span class="string">'113572'</span>) | (all_data.Ticket == <span class="string">'1601'</span>),[<span class="string">'TicketGroupId'</span>, <span class="string">'Ticket'</span>, <span class="string">'SurnameGroupId'</span>, <span class="string">'Surname'</span>, <span class="string">'Fare'</span>, <span class="string">'Pclass'</span>, <span class="string">'Embarked'</span>, <span class="string">'Cabin'</span>, <span class="string">'Name'</span>, <span class="string">'SibSp'</span>, <span class="string">'Parch'</span>, <span class="string">'Age'</span>, <span class="string">'Sex'</span>]].sort_values(by=[<span class="string">'TicketGroupId'</span>])</span><br></pre></td></tr></table></figure><br><br><table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>TicketGroupId</th><br>      <th>Ticket</th><br>      <th>SurnameGroupId</th><br>      <th>Surname</th><br>      <th>Fare</th><br>      <th>Pclass</th><br>      <th>Embarked</th><br>      <th>Cabin</th><br>      <th>Name</th><br>      <th>SibSp</th><br>      <th>Parch</th><br>      <th>Age</th><br>      <th>Sex</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>61</th><br>      <td>1-nan-80.0-113572</td><br>      <td>113572</td><br>      <td>Icard-1-nan-80.0-1135__</td><br>      <td>Icard</td><br>      <td>80.0000</td><br>      <td>1</td><br>      <td>NaN</td><br>      <td>B28</td><br>      <td>Icard, Miss. Amelie</td><br>      <td>0</td><br>      <td>0</td><br>      <td>38.0</td><br>      <td>female</td><br>    </tr><br>    <tr><br>      <th>829</th><br>      <td>1-nan-80.0-113572</td><br>      <td>113572</td><br>      <td>Stone-1-nan-80.0-1135__</td><br>      <td>Stone</td><br>      <td>80.0000</td><br>      <td>1</td><br>      <td>NaN</td><br>      <td>B28</td><br>      <td>Stone, Mrs. George Nelson (Martha Evelyn)</td><br>      <td>0</td><br>      <td>0</td><br>      <td>62.0</td><br>      <td>female</td><br>    </tr><br>    <tr><br>      <th>74</th><br>      <td>3-S-56.4958-1601</td><br>      <td>1601</td><br>      <td>Bing-3-S-56.4958-16__</td><br>      <td>Bing</td><br>      <td>56.4958</td><br>      <td>3</td><br>      <td>S</td><br>      <td>NaN</td><br>      <td>Bing, Mr. Lee</td><br>      <td>0</td><br>      <td>0</td><br>      <td>32.0</td><br>      <td>male</td><br>    </tr><br>    <tr><br>      <th>169</th><br>      <td>3-S-56.4958-1601</td><br>      <td>1601</td><br>      <td>Ling-3-S-56.4958-16__</td><br>      <td>Ling</td><br>      <td>56.4958</td><br>      <td>3</td><br>      <td>S</td><br>      <td>NaN</td><br>      <td>Ling, Mr. Lee</td><br>      <td>0</td><br>      <td>0</td><br>      <td>28.0</td><br>      <td>male</td><br>    </tr><br>    <tr><br>      <th>509</th><br>      <td>3-S-56.4958-1601</td><br>      <td>1601</td><br>      <td>Lang-3-S-56.4958-16__</td><br>      <td>Lang</td><br>      <td>56.4958</td><br>      <td>3</td><br>      <td>S</td><br>      <td>NaN</td><br>      <td>Lang, Mr. Fang</td><br>      <td>0</td><br>      <td>0</td><br>      <td>26.0</td><br>      <td>male</td><br>    </tr><br>    <tr><br>      <th>643</th><br>      <td>3-S-56.4958-1601</td><br>      <td>1601</td><br>      <td>Foo-3-S-56.4958-16__</td><br>      <td>Foo</td><br>      <td>56.4958</td><br>      <td>3</td><br>      <td>S</td><br>      <td>NaN</td><br>      <td>Foo, Mr. Choong</td><br>      <td>0</td><br>      <td>0</td><br>      <td>NaN</td><br>      <td>male</td><br>    </tr><br>    <tr><br>      <th>692</th><br>      <td>3-S-56.4958-1601</td><br>      <td>1601</td><br>      <td>Lam-3-S-56.4958-16__</td><br>      <td>Lam</td><br>      <td>56.4958</td><br>      <td>3</td><br>      <td>S</td><br>      <td>NaN</td><br>      <td>Lam, Mr. Ali</td><br>      <td>0</td><br>      <td>0</td><br>      <td>NaN</td><br>      <td>male</td><br>    </tr><br>    <tr><br>      <th>826</th><br>      <td>3-S-56.4958-1601</td><br>      <td>1601</td><br>      <td>Lam-3-S-56.4958-16__</td><br>      <td>Lam</td><br>      <td>56.4958</td><br>      <td>3</td><br>      <td>S</td><br>      <td>NaN</td><br>      <td>Lam, Mr. Len</td><br>      <td>0</td><br>      <td>0</td><br>      <td>NaN</td><br>      <td>male</td><br>    </tr><br>    <tr><br>      <th>838</th><br>      <td>3-S-56.4958-1601</td><br>      <td>1601</td><br>      <td>Chip-3-S-56.4958-16__</td><br>      <td>Chip</td><br>      <td>56.4958</td><br>      <td>3</td><br>      <td>S</td><br>      <td>NaN</td><br>      <td>Chip, Mr. Chang</td><br>      <td>0</td><br>      <td>0</td><br>      <td>32.0</td><br>      <td>male</td><br>    </tr><br>    <tr><br>      <th>930</th><br>      <td>3-S-56.4958-1601</td><br>      <td>1601</td><br>      <td>Hee-3-S-56.4958-16__</td><br>      <td>Hee</td><br>      <td>56.4958</td><br>      <td>3</td><br>      <td>S</td><br>      <td>NaN</td><br>      <td>Hee, Mr. Ling</td><br>      <td>0</td><br>      <td>0</td><br>      <td>NaN</td><br>      <td>male</td><br>    </tr><br>  </tbody><br></table><br><br>显然经过前面的分析，我们清楚 <code>SurnameGroupId</code> 比 <code>TicketGroupId</code> 更靠谱地识别出一起出行的人，毕竟 <code>TicketGroupId</code> 是由更少的特征组合起来的，那么来试试找出，哪些乘客可能是保姆远亲，甚至朋友一起出行。<br><br>这些人的特征:<br><br>1. 这些人（保姆、远亲、朋友）跟所在的至亲家庭几乎不可能是同一个 <code>SurnameGroupId</code>，因此他们这些人的 <code>SurnameGroupSize==1</code><br>2. 有了上一条推论，我们清楚有了 <code>SurnameGoupId</code> 以后，我们根据 <code>TicketGroupId</code> 找到保姆所在的家庭，远亲一起来的家庭，朋友团，然后修改保姆远亲朋友的 <code>SurnameGroupId</code>，或者重新定义一个字段 <code>TogetherId</code>（这个方法更麻烦一些）。<br><br>首先，我们先创建出以下两个特征：<br><br>#### TicketGroupSize 和 SurnameGroupSize<br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">surname_group_value_count = all_data.SurnameGroupId.value_counts()</span><br><span class="line">all_data[<span class="string">'SurnameGroupSize'</span>] = all_data.apply(<span class="keyword">lambda</span> row : surname_group_value_count[row.SurnameGroupId], axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">all_data.sort_values([<span class="string">'SurnameGroupId'</span>]).loc[:, [<span class="string">'SurnameGroupSize'</span>, <span class="string">'SurnameGroupId'</span>, <span class="string">'TicketGroupId'</span>, <span class="string">'Cabin'</span>, <span class="string">'Name'</span>, <span class="string">'SibSp'</span>, <span class="string">'Parch'</span>, <span class="string">'Age'</span>]].head(<span class="number">8</span>)</span><br></pre></td></tr></table></figure><br><br><table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>SurnameGroupSize</th><br>      <th>SurnameGroupId</th><br>      <th>TicketGroupId</th><br>      <th>Cabin</th><br>      <th>Name</th><br>      <th>SibSp</th><br>      <th>Parch</th><br>      <th>Age</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>845</th><br>      <td>1</td><br>      <td>Abbing-3-S-7.55-C.A. 55__</td><br>      <td>3-S-7.55-C.A. 5547</td><br>      <td>NaN</td><br>      <td>Abbing, Mr. Anthony</td><br>      <td>0</td><br>      <td>0</td><br>      <td>42.0</td><br>    </tr><br>    <tr><br>      <th>1283</th><br>      <td>3</td><br>      <td>Abbott-3-S-20.25-C.A. 26__</td><br>      <td>3-S-20.25-C.A. 2673</td><br>      <td>NaN</td><br>      <td>Abbott, Master. Eugene Joseph</td><br>      <td>0</td><br>      <td>2</td><br>      <td>13.0</td><br>    </tr><br>    <tr><br>      <th>746</th><br>      <td>3</td><br>      <td>Abbott-3-S-20.25-C.A. 26__</td><br>      <td>3-S-20.25-C.A. 2673</td><br>      <td>NaN</td><br>      <td>Abbott, Mr. Rossmore Edward</td><br>      <td>1</td><br>      <td>1</td><br>      <td>16.0</td><br>    </tr><br>    <tr><br>      <th>279</th><br>      <td>3</td><br>      <td>Abbott-3-S-20.25-C.A. 26__</td><br>      <td>3-S-20.25-C.A. 2673</td><br>      <td>NaN</td><br>      <td>Abbott, Mrs. Stanton (Rosa Hunt)</td><br>      <td>1</td><br>      <td>1</td><br>      <td>35.0</td><br>    </tr><br>    <tr><br>      <th>948</th><br>      <td>2</td><br>      <td>Abelseth-3-S-7.65-3481__</td><br>      <td>3-S-7.65-348122</td><br>      <td>F G63</td><br>      <td>Abelseth, Mr. Olaus Jorgensen</td><br>      <td>0</td><br>      <td>0</td><br>      <td>25.0</td><br>    </tr><br>    <tr><br>      <th>1236</th><br>      <td>2</td><br>      <td>Abelseth-3-S-7.65-3481__</td><br>      <td>3-S-7.65-348125</td><br>      <td>NaN</td><br>      <td>Abelseth, Miss. Karen Marie</td><br>      <td>0</td><br>      <td>0</td><br>      <td>16.0</td><br>    </tr><br>    <tr><br>      <th>874</th><br>      <td>2</td><br>      <td>Abelson-2-C-24.0-P/PP 33__</td><br>      <td>2-C-24.0-P/PP 3381</td><br>      <td>NaN</td><br>      <td>Abelson, Mrs. Samuel (Hannah Wizosky)</td><br>      <td>1</td><br>      <td>0</td><br>      <td>28.0</td><br>    </tr><br>    <tr><br>      <th>308</th><br>      <td>2</td><br>      <td>Abelson-2-C-24.0-P/PP 33__</td><br>      <td>2-C-24.0-P/PP 3381</td><br>      <td>NaN</td><br>      <td>Abelson, Mr. Samuel</td><br>      <td>1</td><br>      <td>0</td><br>      <td>30.0</td><br>    </tr><br>  </tbody><br></table><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.barplot(x=<span class="string">'SurnameGroupSize'</span>, y=<span class="string">'Survived'</span>, data = all_data)</span><br></pre></td></tr></table></figure><br><br>    &lt;matplotlib.axes._subplots.AxesSubplot at 0x2d588eacc18&gt;<br><br><br><br><br><img src="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_116_1.png" alt="png"><br><br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ticket_group_value_count = dict(all_data.TicketGroupId.value_counts())</span><br><span class="line">all_data[<span class="string">'TicketGroupSize'</span>] = all_data.apply(<span class="keyword">lambda</span> row : ticket_group_value_count[row.TicketGroupId], axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">all_data.sort_values([<span class="string">'TicketGroupId'</span>]).loc[:, [<span class="string">'TicketGroupSize'</span>, <span class="string">'TicketGroupId'</span>, <span class="string">'SurnameGroupId'</span>, <span class="string">'Cabin'</span>, <span class="string">'Name'</span>, <span class="string">'SibSp'</span>, <span class="string">'Parch'</span>, <span class="string">'Age'</span>]].head(<span class="number">6</span>)</span><br></pre></td></tr></table></figure><br><br><table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>TicketGroupSize</th><br>      <th>TicketGroupId</th><br>      <th>SurnameGroupId</th><br>      <th>Cabin</th><br>      <th>Name</th><br>      <th>SibSp</th><br>      <th>Parch</th><br>      <th>Age</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>1130</th><br>      <td>3</td><br>      <td>1-C-106.425-PC 17761</td><br>      <td>Douglas-1-C-106.425-PC 177__</td><br>      <td>C86</td><br>      <td>Douglas, Mrs. Walter Donald (Mahala Dutton)</td><br>      <td>1</td><br>      <td>0</td><br>      <td>48.0</td><br>    </tr><br>    <tr><br>      <th>537</th><br>      <td>3</td><br>      <td>1-C-106.425-PC 17761</td><br>      <td>LeRoy-1-C-106.425-PC 177__</td><br>      <td>NaN</td><br>      <td>LeRoy, Miss. Bertha</td><br>      <td>0</td><br>      <td>0</td><br>      <td>30.0</td><br>    </tr><br>    <tr><br>      <th>544</th><br>      <td>3</td><br>      <td>1-C-106.425-PC 17761</td><br>      <td>Douglas-1-C-106.425-PC 177__</td><br>      <td>C86</td><br>      <td>Douglas, Mr. Walter Donald</td><br>      <td>1</td><br>      <td>0</td><br>      <td>50.0</td><br>    </tr><br>    <tr><br>      <th>1305</th><br>      <td>3</td><br>      <td>1-C-108.9-PC 17758</td><br>      <td>Oliva y Ocana-1-C-108.9-PC 177__</td><br>      <td>C105</td><br>      <td>Oliva y Ocana, Dona. Fermina</td><br>      <td>0</td><br>      <td>0</td><br>      <td>39.0</td><br>    </tr><br>    <tr><br>      <th>307</th><br>      <td>3</td><br>      <td>1-C-108.9-PC 17758</td><br>      <td>Penasco y Castellana-1-C-108.9-PC 177__</td><br>      <td>C65</td><br>      <td>Penasco y Castellana, Mrs. Victor de Satode (M…</td><br>      <td>1</td><br>      <td>0</td><br>      <td>17.0</td><br>    </tr><br>    <tr><br>      <th>505</th><br>      <td>3</td><br>      <td>1-C-108.9-PC 17758</td><br>      <td>Penasco y Castellana-1-C-108.9-PC 177__</td><br>      <td>C65</td><br>      <td>Penasco y Castellana, Mr. Victor de Satode</td><br>      <td>1</td><br>      <td>0</td><br>      <td>18.0</td><br>    </tr><br>  </tbody><br></table><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.barplot(x=<span class="string">'TicketGroupSize'</span>, y=<span class="string">'Survived'</span>, data = all_data)</span><br></pre></td></tr></table></figure><br><br>    &lt;matplotlib.axes._subplots.AxesSubplot at 0x2d588eac588&gt;<br><br><br><br><br><img src="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_118_1.png" alt="png"><br><br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">test = all_data.iloc[train.shape[<span class="number">0</span>]:, :]</span><br><span class="line">train = all_data.iloc[:train.shape[<span class="number">0</span>], :]</span><br><span class="line">train.head()</span><br></pre></td></tr></table></figure><br><br><table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>Age</th><br>      <th>Cabin</th><br>      <th>Embarked</th><br>      <th>Fare</th><br>      <th>Name</th><br>      <th>Parch</th><br>      <th>PassengerId</th><br>      <th>Pclass</th><br>      <th>Sex</th><br>      <th>SibSp</th><br>      <th>…</th><br>      <th>Ticket</th><br>      <th>TicketSize</th><br>      <th>SingleTicketFare</th><br>      <th>Title</th><br>      <th>Surname</th><br>      <th>FamilySize</th><br>      <th>SurnameGroupId</th><br>      <th>TicketGroupId</th><br>      <th>SurnameGroupSize</th><br>      <th>TicketGroupSize</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>22.0</td><br>      <td>NaN</td><br>      <td>S</td><br>      <td>7.2500</td><br>      <td>Braund, Mr. Owen Harris</td><br>      <td>0</td><br>      <td>1</td><br>      <td>3</td><br>      <td>male</td><br>      <td>1</td><br>      <td>…</td><br>      <td>A/5 21171</td><br>      <td>1</td><br>      <td>7.25000</td><br>      <td>Mr</td><br>      <td>Braund</td><br>      <td>2</td><br>      <td>Braund-3-S-7.25-A/5 211__</td><br>      <td>3-S-7.25-A/5 21171</td><br>      <td>1</td><br>      <td>1</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>38.0</td><br>      <td>C85</td><br>      <td>C</td><br>      <td>71.2833</td><br>      <td>Cumings, Mrs. John Bradley (Florence Briggs Th…</td><br>      <td>0</td><br>      <td>2</td><br>      <td>1</td><br>      <td>female</td><br>      <td>1</td><br>      <td>…</td><br>      <td>PC 17599</td><br>      <td>2</td><br>      <td>35.64165</td><br>      <td>Mrs</td><br>      <td>Cumings</td><br>      <td>2</td><br>      <td>Cumings-1-C-71.2833-PC 175__</td><br>      <td>1-C-71.2833-PC 17599</td><br>      <td>2</td><br>      <td>2</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>26.0</td><br>      <td>NaN</td><br>      <td>S</td><br>      <td>7.9250</td><br>      <td>Heikkinen, Miss. Laina</td><br>      <td>0</td><br>      <td>3</td><br>      <td>3</td><br>      <td>female</td><br>      <td>0</td><br>      <td>…</td><br>      <td>STON/O2. 3101282</td><br>      <td>1</td><br>      <td>7.92500</td><br>      <td>Miss</td><br>      <td>Heikkinen</td><br>      <td>1</td><br>      <td>Heikkinen-3-S-7.925-STON/O2. 31012__</td><br>      <td>3-S-7.925-STON/O2. 3101282</td><br>      <td>1</td><br>      <td>1</td><br>    </tr><br>    <tr><br>      <th>3</th><br>      <td>35.0</td><br>      <td>C123</td><br>      <td>S</td><br>      <td>53.1000</td><br>      <td>Futrelle, Mrs. Jacques Heath (Lily May Peel)</td><br>      <td>0</td><br>      <td>4</td><br>      <td>1</td><br>      <td>female</td><br>      <td>1</td><br>      <td>…</td><br>      <td>113803</td><br>      <td>2</td><br>      <td>26.55000</td><br>      <td>Mrs</td><br>      <td>Futrelle</td><br>      <td>2</td><br>      <td>Futrelle-1-S-53.1-1138__</td><br>      <td>1-S-53.1-113803</td><br>      <td>2</td><br>      <td>2</td><br>    </tr><br>    <tr><br>      <th>4</th><br>      <td>35.0</td><br>      <td>NaN</td><br>      <td>S</td><br>      <td>8.0500</td><br>      <td>Allen, Mr. William Henry</td><br>      <td>0</td><br>      <td>5</td><br>      <td>3</td><br>      <td>male</td><br>      <td>0</td><br>      <td>…</td><br>      <td>373450</td><br>      <td>1</td><br>      <td>8.05000</td><br>      <td>Mr</td><br>      <td>Allen</td><br>      <td>2</td><br>      <td>Allen-3-S-8.05-3734__</td><br>      <td>3-S-8.05-373450</td><br>      <td>1</td><br>      <td>1</td><br>    </tr><br>  </tbody><br></table><br><p>5 rows × 21 columns</p><br><br>#### 寻找保姆、远亲、朋友<br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tmp = pd.concat([train, test])</span><br><span class="line">nannies_firends_cousins = addNanniesCousinsFriends(all_data, verbose=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure><br><br>    Tottaly 789 solo passengers satifies the condtions<br>    Totally adding 130  nannies, cousins and firends to surname groups<br><br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nannies_firends_cousins_data = tmp.loc[tmp.SurnameGroupId.isin(nannies_firends_cousins), [<span class="string">'SurnameGroupId'</span>, <span class="string">'TicketGroupId'</span>, <span class="string">'Pclass'</span>, <span class="string">'Embarked'</span>, <span class="string">'Sex'</span>, <span class="string">'Fare'</span>, <span class="string">'Ticket'</span>, <span class="string">'SibSp'</span>, <span class="string">'Parch'</span>, <span class="string">'Age'</span>, <span class="string">'Surname'</span>,<span class="string">'Survived'</span>]].sort_values([<span class="string">'TicketGroupId'</span>])</span><br><span class="line"></span><br><span class="line">len(nannies_firends_cousins_data.TicketGroupId.unique())</span><br></pre></td></tr></table></figure><br><br>    65<br><br><br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tmp = <span class="keyword">None</span></span><br><span class="line">nannies_firends_cousins_data.drop([<span class="string">'Pclass'</span>,<span class="string">'Embarked'</span>, <span class="string">'Fare'</span>], axis = <span class="number">1</span>).head(<span class="number">20</span>)</span><br></pre></td></tr></table></figure><br><br><table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>SurnameGroupId</th><br>      <th>TicketGroupId</th><br>      <th>Sex</th><br>      <th>Ticket</th><br>      <th>SibSp</th><br>      <th>Parch</th><br>      <th>Age</th><br>      <th>Surname</th><br>      <th>Survived</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>544</th><br>      <td>Douglas-1-C-106.425-PC 177__</td><br>      <td>1-C-106.425-PC 17761</td><br>      <td>male</td><br>      <td>PC 17761</td><br>      <td>1</td><br>      <td>0</td><br>      <td>50.0</td><br>      <td>Douglas</td><br>      <td>0.0</td><br>    </tr><br>    <tr><br>      <th>537</th><br>      <td>LeRoy-1-C-106.425-PC 177__</td><br>      <td>1-C-106.425-PC 17761</td><br>      <td>female</td><br>      <td>PC 17761</td><br>      <td>0</td><br>      <td>0</td><br>      <td>30.0</td><br>      <td>LeRoy</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>1130</th><br>      <td>Douglas-1-C-106.425-PC 177__</td><br>      <td>1-C-106.425-PC 17761</td><br>      <td>female</td><br>      <td>PC 17761</td><br>      <td>1</td><br>      <td>0</td><br>      <td>48.0</td><br>      <td>Douglas</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>1305</th><br>      <td>Oliva y Ocana-1-C-108.9-PC 177__</td><br>      <td>1-C-108.9-PC 17758</td><br>      <td>female</td><br>      <td>PC 17758</td><br>      <td>0</td><br>      <td>0</td><br>      <td>39.0</td><br>      <td>Oliva y Ocana</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>505</th><br>      <td>Penasco y Castellana-1-C-108.9-PC 177__</td><br>      <td>1-C-108.9-PC 17758</td><br>      <td>male</td><br>      <td>PC 17758</td><br>      <td>1</td><br>      <td>0</td><br>      <td>18.0</td><br>      <td>Penasco y Castellana</td><br>      <td>0.0</td><br>    </tr><br>    <tr><br>      <th>307</th><br>      <td>Penasco y Castellana-1-C-108.9-PC 177__</td><br>      <td>1-C-108.9-PC 17758</td><br>      <td>female</td><br>      <td>PC 17758</td><br>      <td>1</td><br>      <td>0</td><br>      <td>17.0</td><br>      <td>Penasco y Castellana</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>698</th><br>      <td>Thayer-1-C-110.8833-174__</td><br>      <td>1-C-110.8833-17421</td><br>      <td>male</td><br>      <td>17421</td><br>      <td>1</td><br>      <td>1</td><br>      <td>49.0</td><br>      <td>Thayer</td><br>      <td>0.0</td><br>    </tr><br>    <tr><br>      <th>581</th><br>      <td>Thayer-1-C-110.8833-174__</td><br>      <td>1-C-110.8833-17421</td><br>      <td>female</td><br>      <td>17421</td><br>      <td>1</td><br>      <td>1</td><br>      <td>39.0</td><br>      <td>Thayer</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>550</th><br>      <td>Thayer-1-C-110.8833-174__</td><br>      <td>1-C-110.8833-17421</td><br>      <td>male</td><br>      <td>17421</td><br>      <td>0</td><br>      <td>2</td><br>      <td>17.0</td><br>      <td>Thayer</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>306</th><br>      <td>Fleming-1-C-110.8833-174__</td><br>      <td>1-C-110.8833-17421</td><br>      <td>female</td><br>      <td>17421</td><br>      <td>0</td><br>      <td>0</td><br>      <td>NaN</td><br>      <td>Fleming</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>319</th><br>      <td>Spedden-1-C-134.5-169__</td><br>      <td>1-C-134.5-16966</td><br>      <td>female</td><br>      <td>16966</td><br>      <td>1</td><br>      <td>1</td><br>      <td>40.0</td><br>      <td>Spedden</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>1087</th><br>      <td>Spedden-1-C-134.5-169__</td><br>      <td>1-C-134.5-16966</td><br>      <td>male</td><br>      <td>16966</td><br>      <td>0</td><br>      <td>2</td><br>      <td>6.0</td><br>      <td>Spedden</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>1133</th><br>      <td>Spedden-1-C-134.5-169__</td><br>      <td>1-C-134.5-16966</td><br>      <td>male</td><br>      <td>16966</td><br>      <td>1</td><br>      <td>1</td><br>      <td>45.0</td><br>      <td>Spedden</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>337</th><br>      <td>Burns-1-C-134.5-169__</td><br>      <td>1-C-134.5-16966</td><br>      <td>female</td><br>      <td>16966</td><br>      <td>0</td><br>      <td>0</td><br>      <td>41.0</td><br>      <td>Burns</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>1262</th><br>      <td>Wilson-1-C-134.5-169__</td><br>      <td>1-C-134.5-16966</td><br>      <td>female</td><br>      <td>16966</td><br>      <td>0</td><br>      <td>0</td><br>      <td>31.0</td><br>      <td>Wilson</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>373</th><br>      <td>Ringhini-1-C-135.6333-PC 177__</td><br>      <td>1-C-135.6333-PC 17760</td><br>      <td>male</td><br>      <td>PC 17760</td><br>      <td>0</td><br>      <td>0</td><br>      <td>22.0</td><br>      <td>Ringhini</td><br>      <td>0.0</td><br>    </tr><br>    <tr><br>      <th>1205</th><br>      <td>White-1-C-135.6333-PC 177__</td><br>      <td>1-C-135.6333-PC 17760</td><br>      <td>female</td><br>      <td>PC 17760</td><br>      <td>0</td><br>      <td>0</td><br>      <td>55.0</td><br>      <td>White</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>325</th><br>      <td>Young-1-C-135.6333-PC 177__</td><br>      <td>1-C-135.6333-PC 17760</td><br>      <td>female</td><br>      <td>PC 17760</td><br>      <td>0</td><br>      <td>0</td><br>      <td>36.0</td><br>      <td>Young</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>31</th><br>      <td>Spencer-1-C-146.5208-PC 175__</td><br>      <td>1-C-146.5208-PC 17569</td><br>      <td>female</td><br>      <td>PC 17569</td><br>      <td>1</td><br>      <td>0</td><br>      <td>NaN</td><br>      <td>Spencer</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>1207</th><br>      <td>Spencer-1-C-146.5208-PC 175__</td><br>      <td>1-C-146.5208-PC 17569</td><br>      <td>male</td><br>      <td>PC 17569</td><br>      <td>1</td><br>      <td>0</td><br>      <td>57.0</td><br>      <td>Spencer</td><br>      <td>NaN</td><br>    </tr><br>  </tbody><br></table><br><br><br><strong>我们来看看之前的保姆、远亲、朋友组</strong>：<br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nannies_firends_cousins_data.loc[(nannies_firends_cousins_data.Ticket == <span class="string">'PC 17608'</span>) | (nannies_firends_cousins_data.Ticket == <span class="string">'113572'</span>) | (nannies_firends_cousins_data.Ticket == <span class="string">'1601'</span>)]</span><br></pre></td></tr></table></figure><br><br><table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>SurnameGroupId</th><br>      <th>TicketGroupId</th><br>      <th>Pclass</th><br>      <th>Embarked</th><br>      <th>Sex</th><br>      <th>Fare</th><br>      <th>Ticket</th><br>      <th>SibSp</th><br>      <th>Parch</th><br>      <th>Age</th><br>      <th>Surname</th><br>      <th>Survived</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>915</th><br>      <td>Ryerson-1-C-262.375-PC 176__</td><br>      <td>1-C-262.375-PC 17608</td><br>      <td>1</td><br>      <td>C</td><br>      <td>female</td><br>      <td>262.3750</td><br>      <td>PC 17608</td><br>      <td>1</td><br>      <td>3</td><br>      <td>48.0</td><br>      <td>Ryerson</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>1033</th><br>      <td>Ryerson-1-C-262.375-PC 176__</td><br>      <td>1-C-262.375-PC 17608</td><br>      <td>1</td><br>      <td>C</td><br>      <td>male</td><br>      <td>262.3750</td><br>      <td>PC 17608</td><br>      <td>1</td><br>      <td>3</td><br>      <td>61.0</td><br>      <td>Ryerson</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>950</th><br>      <td>Chaudanson-1-C-262.375-PC 176__</td><br>      <td>1-C-262.375-PC 17608</td><br>      <td>1</td><br>      <td>C</td><br>      <td>female</td><br>      <td>262.3750</td><br>      <td>PC 17608</td><br>      <td>0</td><br>      <td>0</td><br>      <td>36.0</td><br>      <td>Chaudanson</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>311</th><br>      <td>Ryerson-1-C-262.375-PC 176__</td><br>      <td>1-C-262.375-PC 17608</td><br>      <td>1</td><br>      <td>C</td><br>      <td>female</td><br>      <td>262.3750</td><br>      <td>PC 17608</td><br>      <td>2</td><br>      <td>2</td><br>      <td>18.0</td><br>      <td>Ryerson</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>742</th><br>      <td>Ryerson-1-C-262.375-PC 176__</td><br>      <td>1-C-262.375-PC 17608</td><br>      <td>1</td><br>      <td>C</td><br>      <td>female</td><br>      <td>262.3750</td><br>      <td>PC 17608</td><br>      <td>2</td><br>      <td>2</td><br>      <td>21.0</td><br>      <td>Ryerson</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>955</th><br>      <td>Ryerson-1-C-262.375-PC 176__</td><br>      <td>1-C-262.375-PC 17608</td><br>      <td>1</td><br>      <td>C</td><br>      <td>male</td><br>      <td>262.3750</td><br>      <td>PC 17608</td><br>      <td>2</td><br>      <td>2</td><br>      <td>13.0</td><br>      <td>Ryerson</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>1266</th><br>      <td>Bowen-1-C-262.375-PC 176__</td><br>      <td>1-C-262.375-PC 17608</td><br>      <td>1</td><br>      <td>C</td><br>      <td>female</td><br>      <td>262.3750</td><br>      <td>PC 17608</td><br>      <td>0</td><br>      <td>0</td><br>      <td>45.0</td><br>      <td>Bowen</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>61</th><br>      <td>Icard-1-nan-80.0-1135__</td><br>      <td>1-nan-80.0-113572</td><br>      <td>1</td><br>      <td>NaN</td><br>      <td>female</td><br>      <td>80.0000</td><br>      <td>113572</td><br>      <td>0</td><br>      <td>0</td><br>      <td>38.0</td><br>      <td>Icard</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>829</th><br>      <td>Stone-1-nan-80.0-1135__</td><br>      <td>1-nan-80.0-113572</td><br>      <td>1</td><br>      <td>NaN</td><br>      <td>female</td><br>      <td>80.0000</td><br>      <td>113572</td><br>      <td>0</td><br>      <td>0</td><br>      <td>62.0</td><br>      <td>Stone</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>838</th><br>      <td>Chip-3-S-56.4958-16__</td><br>      <td>3-S-56.4958-1601</td><br>      <td>3</td><br>      <td>S</td><br>      <td>male</td><br>      <td>56.4958</td><br>      <td>1601</td><br>      <td>0</td><br>      <td>0</td><br>      <td>32.0</td><br>      <td>Chip</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>509</th><br>      <td>Lang-3-S-56.4958-16__</td><br>      <td>3-S-56.4958-1601</td><br>      <td>3</td><br>      <td>S</td><br>      <td>male</td><br>      <td>56.4958</td><br>      <td>1601</td><br>      <td>0</td><br>      <td>0</td><br>      <td>26.0</td><br>      <td>Lang</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>169</th><br>      <td>Ling-3-S-56.4958-16__</td><br>      <td>3-S-56.4958-1601</td><br>      <td>3</td><br>      <td>S</td><br>      <td>male</td><br>      <td>56.4958</td><br>      <td>1601</td><br>      <td>0</td><br>      <td>0</td><br>      <td>28.0</td><br>      <td>Ling</td><br>      <td>0.0</td><br>    </tr><br>    <tr><br>      <th>930</th><br>      <td>Hee-3-S-56.4958-16__</td><br>      <td>3-S-56.4958-1601</td><br>      <td>3</td><br>      <td>S</td><br>      <td>male</td><br>      <td>56.4958</td><br>      <td>1601</td><br>      <td>0</td><br>      <td>0</td><br>      <td>NaN</td><br>      <td>Hee</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>643</th><br>      <td>Foo-3-S-56.4958-16__</td><br>      <td>3-S-56.4958-1601</td><br>      <td>3</td><br>      <td>S</td><br>      <td>male</td><br>      <td>56.4958</td><br>      <td>1601</td><br>      <td>0</td><br>      <td>0</td><br>      <td>NaN</td><br>      <td>Foo</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>74</th><br>      <td>Bing-3-S-56.4958-16__</td><br>      <td>3-S-56.4958-1601</td><br>      <td>3</td><br>      <td>S</td><br>      <td>male</td><br>      <td>56.4958</td><br>      <td>1601</td><br>      <td>0</td><br>      <td>0</td><br>      <td>32.0</td><br>      <td>Bing</td><br>      <td>1.0</td><br>    </tr><br>  </tbody><br></table><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nannies_firends_cousins_data.loc[nannies_firends_cousins_data.Surname.isin([<span class="string">'Spedden'</span>, <span class="string">'Allison'</span>, <span class="string">'Zabour'</span>, <span class="string">'Panula'</span>, <span class="string">'Wick'</span>, <span class="string">'Ryerson'</span>])]</span><br></pre></td></tr></table></figure><br><br><table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>SurnameGroupId</th><br>      <th>TicketGroupId</th><br>      <th>Pclass</th><br>      <th>Embarked</th><br>      <th>Sex</th><br>      <th>Fare</th><br>      <th>Ticket</th><br>      <th>SibSp</th><br>      <th>Parch</th><br>      <th>Age</th><br>      <th>Surname</th><br>      <th>Survived</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>319</th><br>      <td>Spedden-1-C-134.5-169__</td><br>      <td>1-C-134.5-16966</td><br>      <td>1</td><br>      <td>C</td><br>      <td>female</td><br>      <td>134.5000</td><br>      <td>16966</td><br>      <td>1</td><br>      <td>1</td><br>      <td>40.00</td><br>      <td>Spedden</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>1087</th><br>      <td>Spedden-1-C-134.5-169__</td><br>      <td>1-C-134.5-16966</td><br>      <td>1</td><br>      <td>C</td><br>      <td>male</td><br>      <td>134.5000</td><br>      <td>16966</td><br>      <td>0</td><br>      <td>2</td><br>      <td>6.00</td><br>      <td>Spedden</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>1133</th><br>      <td>Spedden-1-C-134.5-169__</td><br>      <td>1-C-134.5-16966</td><br>      <td>1</td><br>      <td>C</td><br>      <td>male</td><br>      <td>134.5000</td><br>      <td>16966</td><br>      <td>1</td><br>      <td>1</td><br>      <td>45.00</td><br>      <td>Spedden</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>915</th><br>      <td>Ryerson-1-C-262.375-PC 176__</td><br>      <td>1-C-262.375-PC 17608</td><br>      <td>1</td><br>      <td>C</td><br>      <td>female</td><br>      <td>262.3750</td><br>      <td>PC 17608</td><br>      <td>1</td><br>      <td>3</td><br>      <td>48.00</td><br>      <td>Ryerson</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>1033</th><br>      <td>Ryerson-1-C-262.375-PC 176__</td><br>      <td>1-C-262.375-PC 17608</td><br>      <td>1</td><br>      <td>C</td><br>      <td>male</td><br>      <td>262.3750</td><br>      <td>PC 17608</td><br>      <td>1</td><br>      <td>3</td><br>      <td>61.00</td><br>      <td>Ryerson</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>311</th><br>      <td>Ryerson-1-C-262.375-PC 176__</td><br>      <td>1-C-262.375-PC 17608</td><br>      <td>1</td><br>      <td>C</td><br>      <td>female</td><br>      <td>262.3750</td><br>      <td>PC 17608</td><br>      <td>2</td><br>      <td>2</td><br>      <td>18.00</td><br>      <td>Ryerson</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>742</th><br>      <td>Ryerson-1-C-262.375-PC 176__</td><br>      <td>1-C-262.375-PC 17608</td><br>      <td>1</td><br>      <td>C</td><br>      <td>female</td><br>      <td>262.3750</td><br>      <td>PC 17608</td><br>      <td>2</td><br>      <td>2</td><br>      <td>21.00</td><br>      <td>Ryerson</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>955</th><br>      <td>Ryerson-1-C-262.375-PC 176__</td><br>      <td>1-C-262.375-PC 17608</td><br>      <td>1</td><br>      <td>C</td><br>      <td>male</td><br>      <td>262.3750</td><br>      <td>PC 17608</td><br>      <td>2</td><br>      <td>2</td><br>      <td>13.00</td><br>      <td>Ryerson</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>498</th><br>      <td>Allison-1-S-151.55-1137__</td><br>      <td>1-S-151.55-113781</td><br>      <td>1</td><br>      <td>S</td><br>      <td>female</td><br>      <td>151.5500</td><br>      <td>113781</td><br>      <td>1</td><br>      <td>2</td><br>      <td>25.00</td><br>      <td>Allison</td><br>      <td>0.0</td><br>    </tr><br>    <tr><br>      <th>297</th><br>      <td>Allison-1-S-151.55-1137__</td><br>      <td>1-S-151.55-113781</td><br>      <td>1</td><br>      <td>S</td><br>      <td>female</td><br>      <td>151.5500</td><br>      <td>113781</td><br>      <td>1</td><br>      <td>2</td><br>      <td>2.00</td><br>      <td>Allison</td><br>      <td>0.0</td><br>    </tr><br>    <tr><br>      <th>305</th><br>      <td>Allison-1-S-151.55-1137__</td><br>      <td>1-S-151.55-113781</td><br>      <td>1</td><br>      <td>S</td><br>      <td>male</td><br>      <td>151.5500</td><br>      <td>113781</td><br>      <td>1</td><br>      <td>2</td><br>      <td>0.92</td><br>      <td>Allison</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>1197</th><br>      <td>Allison-1-S-151.55-1137__</td><br>      <td>1-S-151.55-113781</td><br>      <td>1</td><br>      <td>S</td><br>      <td>male</td><br>      <td>151.5500</td><br>      <td>113781</td><br>      <td>1</td><br>      <td>2</td><br>      <td>30.00</td><br>      <td>Allison</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>1108</th><br>      <td>Wick-1-S-164.8667-369__</td><br>      <td>1-S-164.8667-36928</td><br>      <td>1</td><br>      <td>S</td><br>      <td>male</td><br>      <td>164.8667</td><br>      <td>36928</td><br>      <td>1</td><br>      <td>1</td><br>      <td>57.00</td><br>      <td>Wick</td><br>      <td>NaN</td><br>    </tr><br>    <tr><br>      <th>856</th><br>      <td>Wick-1-S-164.8667-369__</td><br>      <td>1-S-164.8667-36928</td><br>      <td>1</td><br>      <td>S</td><br>      <td>female</td><br>      <td>164.8667</td><br>      <td>36928</td><br>      <td>1</td><br>      <td>1</td><br>      <td>45.00</td><br>      <td>Wick</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>318</th><br>      <td>Wick-1-S-164.8667-369__</td><br>      <td>1-S-164.8667-36928</td><br>      <td>1</td><br>      <td>S</td><br>      <td>female</td><br>      <td>164.8667</td><br>      <td>36928</td><br>      <td>0</td><br>      <td>2</td><br>      <td>31.00</td><br>      <td>Wick</td><br>      <td>1.0</td><br>    </tr><br>    <tr><br>      <th>50</th><br>      <td>Panula-3-S-39.6875-31012__</td><br>      <td>3-S-39.6875-3101295</td><br>      <td>3</td><br>      <td>S</td><br>      <td>male</td><br>      <td>39.6875</td><br>      <td>3101295</td><br>      <td>4</td><br>      <td>1</td><br>      <td>7.00</td><br>      <td>Panula</td><br>      <td>0.0</td><br>    </tr><br>    <tr><br>      <th>638</th><br>      <td>Panula-3-S-39.6875-31012__</td><br>      <td>3-S-39.6875-3101295</td><br>      <td>3</td><br>      <td>S</td><br>      <td>female</td><br>      <td>39.6875</td><br>      <td>3101295</td><br>      <td>0</td><br>      <td>5</td><br>      <td>41.00</td><br>      <td>Panula</td><br>      <td>0.0</td><br>    </tr><br>    <tr><br>      <th>824</th><br>      <td>Panula-3-S-39.6875-31012__</td><br>      <td>3-S-39.6875-3101295</td><br>      <td>3</td><br>      <td>S</td><br>      <td>male</td><br>      <td>39.6875</td><br>      <td>3101295</td><br>      <td>4</td><br>      <td>1</td><br>      <td>2.00</td><br>      <td>Panula</td><br>      <td>0.0</td><br>    </tr><br>    <tr><br>      <th>164</th><br>      <td>Panula-3-S-39.6875-31012__</td><br>      <td>3-S-39.6875-3101295</td><br>      <td>3</td><br>      <td>S</td><br>      <td>male</td><br>      <td>39.6875</td><br>      <td>3101295</td><br>      <td>4</td><br>      <td>1</td><br>      <td>1.00</td><br>      <td>Panula</td><br>      <td>0.0</td><br>    </tr><br>    <tr><br>      <th>266</th><br>      <td>Panula-3-S-39.6875-31012__</td><br>      <td>3-S-39.6875-3101295</td><br>      <td>3</td><br>      <td>S</td><br>      <td>male</td><br>      <td>39.6875</td><br>      <td>3101295</td><br>      <td>4</td><br>      <td>1</td><br>      <td>16.00</td><br>      <td>Panula</td><br>      <td>0.0</td><br>    </tr><br>    <tr><br>      <th>686</th><br>      <td>Panula-3-S-39.6875-31012__</td><br>      <td>3-S-39.6875-3101295</td><br>      <td>3</td><br>      <td>S</td><br>      <td>male</td><br>      <td>39.6875</td><br>      <td>3101295</td><br>      <td>4</td><br>      <td>1</td><br>      <td>14.00</td><br>      <td>Panula</td><br>      <td>0.0</td><br>    </tr><br>  </tbody><br></table><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nannies_firends_cousins_data.groupby([<span class="string">'SurnameGroupId'</span>]).Survived.mean().value_counts()</span><br></pre></td></tr></table></figure><br><br>    1.000000    60<br>    0.000000    46<br>    0.500000     5<br>    0.333333     1<br>    0.666667     1<br>    Name: Survived, dtype: int64<br><br><br><br>#### 多人一起出行的分组平均幸存率<br><br><strong>查看原来的数据，利用未调整 <code>SurnameGroupId</code> 前的 <code>SurnameGroupSize</code> 的值：</strong><br><br>1.<font color="blue">性别、年龄无差别统计一起出行的人平均幸存率：</font>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tmp = all_data.loc[(all_data.SurnameGroupSize &gt; <span class="number">1</span>)].groupby([<span class="string">'SurnameGroupId'</span>]).Survived.mean().value_counts()</span><br><span class="line">tmp</span><br></pre></td></tr></table></figure>
<pre><code>0.000000    73
1.000000    70
0.500000    29
0.666667     9
0.333333     1
0.750000     1
Name: Survived, dtype: int64
</code></pre><p>整组人全部幸存或全部遇难:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(tmp.loc[<span class="number">0</span>] + tmp.loc[<span class="number">1</span>]) / (np.sum(tmp.values))</span><br></pre></td></tr></table></figure>
<pre><code>0.7814207650273224
</code></pre><p>整组人幸存率大于等于$2/3$ 或 $0$:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np.sum(tmp.loc[(tmp.index &gt; <span class="number">0.5</span>) | (tmp.index == <span class="number">0</span>)].values) / (np.sum(tmp.values))</span><br></pre></td></tr></table></figure>
<pre><code>0.8360655737704918
</code></pre><p>2.<font color="blue">只统计一起出行的人当中把女性小孩单独分组的平均幸存率：</font></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tmp = all_data.loc[(all_data.SurnameGroupSize &gt; <span class="number">1</span>) &amp; (index_boy | index_female)].groupby([<span class="string">'SurnameGroupId'</span>]).Survived.mean().value_counts()</span><br><span class="line">tmp</span><br></pre></td></tr></table></figure>
<pre><code>1.000000    101
0.000000     31
0.333333      1
0.750000      1
Name: Survived, dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(tmp.loc[<span class="number">0</span>] + tmp.loc[<span class="number">1</span>]) / (np.sum(tmp.values))</span><br></pre></td></tr></table></figure>
<pre><code>0.9850746268656716
</code></pre><p>女性男孩的数据按照 <code>SurnameGroupId</code> 分组以后，几乎所有的男孩和女性要么全遇难，要么全部幸存。</p>
<font color="red"><strong>调整 <code>SurnameGroupId</code> 后的数据，<code>SurnameGroupSize</code> 需要重新计算</strong></font>：<br><br>1.性别、年龄无差别统计一起出行的人平均幸存率：<br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">surname_group_value_count = dict(all_data.SurnameGroupId.value_counts())</span><br><span class="line">all_data[<span class="string">'SurnameGroupSize'</span>] = all_data.apply(<span class="keyword">lambda</span> row : surname_group_value_count[row.SurnameGroupId], axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tmp = all_data.loc[(all_data.SurnameGroupSize &gt; <span class="number">1</span>)].groupby([<span class="string">'SurnameGroupId'</span>]).Survived.mean().value_counts()</span><br><span class="line">tmp</span><br></pre></td></tr></table></figure><br><br>    0.000000    89<br>    1.000000    84<br>    0.500000    34<br>    0.666667    11<br>    0.750000     2<br>    0.800000     1<br>    0.333333     1<br>    Name: Survived, dtype: int64<br><br><br><br>整组幸存率为$0$或$1$的概率：<br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(tmp.loc[<span class="number">0</span>] + tmp.loc[<span class="number">1</span>]) / (np.sum(tmp.values))</span><br></pre></td></tr></table></figure><br><br>    0.7792792792792793<br><br><br><br>整组幸存率大于等于$2/3$或$0$ :<br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np.sum(tmp.loc[(tmp.index &gt; <span class="number">0.5</span>) | (tmp.index == <span class="number">0</span>)].values) / (np.sum(tmp.values))</span><br></pre></td></tr></table></figure><br><br>    0.8423423423423423<br><br><br><br>2.只统计一起出行的人当中把<strong>女性男孩单独分组</strong>的平均幸存率：<br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tmp = all_data.loc[(all_data.SurnameGroupSize &gt; <span class="number">1</span>) &amp; (index_boy | index_female)].groupby([<span class="string">'SurnameGroupId'</span>]).Survived.mean().value_counts()</span><br><span class="line">tmp</span><br></pre></td></tr></table></figure><br><br>    1.00    122<br>    0.00     34<br>    0.75      1<br>    0.50      1<br>    Name: Survived, dtype: int64<br><br><br><br>整组幸存率为0或1的概率：<br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(tmp.loc[<span class="number">0</span>] + tmp.loc[<span class="number">1</span>]) / np.sum(tmp.values)</span><br></pre></td></tr></table></figure><br><br>    0.9873417721518988<br><br><br><br>回顾一下之前的<font color="red"><strong>目标</strong></font>：<font color="blue"><strong>默认预测女性都存活，男性都遇难，再加上以下：</strong></font>

<ol>
<li><font color="blue">预测什么样的女性会遇难，毕竟少数，如果能够预测对，正确率就会极大提高。</font>
</li>
<li><font color="blue">预测什么样的男孩（最小年龄段的男性）会幸存，也是少数，如果能够预测对，正确率就会极大提高。</font>
</li>
<li><font color="blue">不是第一个年龄段的男性什么条件下会存活？</font>

</li>
</ol>
<h5 id="遇难的女性所在的分组情况："><a href="#遇难的女性所在的分组情况：" class="headerlink" title="遇难的女性所在的分组情况："></a>遇难的女性所在的分组情况：</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">perished_females_in_group = all_data.loc[(all_data.SurnameGroupSize &gt; <span class="number">1</span>) &amp; (all_data.Survived == <span class="number">0</span>) &amp; (index_female), <span class="string">'SurnameGroupId'</span>].unique()</span><br><span class="line">perished_females_in_group</span><br></pre></td></tr></table></figure>
<pre><code>array([&apos;Vander Planke-3-S-18.0-3457__&apos;, &apos;Palsson-3-S-21.075-3499__&apos;,
       &apos;Turpin-2-S-21.0-116__&apos;, &apos;Arnold-Franchi-3-S-17.8-3492__&apos;,
       &apos;Goodwin-3-S-46.9-CA 21__&apos;, &apos;Zabour-3-C-14.4542-26__&apos;,
       &apos;Jussila-3-S-9.825-41__&apos;, &apos;Yousseff-3-C-14.4583-26__&apos;,
       &apos;Andersson-3-S-31.275-3470__&apos;, &apos;Robins-3-S-14.5-A/5. 33__&apos;,
       &apos;Boulos-3-C-15.2458-26__&apos;, &apos;Ford-3-S-34.375-W./C. 66__&apos;,
       &apos;Skoog-3-S-27.9-3470__&apos;, &apos;Sage-3-S-69.55-CA. 23__&apos;,
       &apos;Strom-3-S-10.4625-3470__&apos;, &apos;Lefebre-3-S-25.4667-41__&apos;,
       &apos;Rosblom-3-S-20.2125-3701__&apos;, &apos;Allison-1-S-151.55-1137__&apos;,
       &apos;Lahtinen-2-S-26.0-2506__&apos;, &apos;Barbara-3-C-14.4542-26__&apos;,
       &apos;Oreskovic-3-S-8.6625-3150__&apos;, &apos;Van Impe-3-S-24.15-3457__&apos;,
       &apos;Danbom-3-S-14.4-3470__&apos;, &apos;Canavan-3-Q-7.75-3648__&apos;,
       &apos;Cacic-3-S-8.6625-3150__&apos;, &apos;Caram-3-C-14.4583-26__&apos;,
       &apos;Lobb-3-S-16.1-A/5. 33__&apos;, &apos;Panula-3-S-39.6875-31012__&apos;,
       &apos;Bourke-3-Q-15.5-3648__&apos;, &apos;Ilmakangas-3-S-7.925-STON/O2. 31012__&apos;,
       &apos;Mudd-2-S-10.5-S.O./P.P.__&apos;, &apos;Carter-2-S-26.0-2442__&apos;,
       &apos;Rice-3-Q-29.125-3826__&apos;, &apos;Johnston-3-S-23.45-W./C. 66__&apos;],
      dtype=object)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tmp = all_data.loc[all_data.SurnameGroupId.isin(perished_females_in_group), [<span class="string">'SurnameGroupId'</span>, <span class="string">'Survived'</span>]].groupby([<span class="string">'SurnameGroupId'</span>]).Survived.mean().value_counts()</span><br><span class="line">tmp</span><br></pre></td></tr></table></figure>
<pre><code>0.0    33
0.5     1
Name: Survived, dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmp[<span class="number">0</span>] / tmp.values.sum()</span><br></pre></td></tr></table></figure>
<pre><code>0.9705882352941176
</code></pre><p>遇难的女性所在的分组不幸全军覆没，由此可以得出结论：如果整组都遇难那么，所在组的女性就会遇难。</p>
<h5 id="幸存的女性所在的分组情况："><a href="#幸存的女性所在的分组情况：" class="headerlink" title="幸存的女性所在的分组情况："></a>幸存的女性所在的分组情况：</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">survived_females_in_group = all_data.loc[(all_data.SurnameGroupSize &gt; <span class="number">1</span>) &amp; (all_data.Survived == <span class="number">1.0</span>) &amp; (index_female), <span class="string">'SurnameGroupId'</span>].unique()</span><br><span class="line">tmp = all_data.loc[all_data.SurnameGroupId.isin(survived_females_in_group), [<span class="string">'SurnameGroupId'</span>, <span class="string">'Survived'</span>]].groupby([<span class="string">'SurnameGroupId'</span>]).Survived.mean().value_counts()</span><br><span class="line">tmp</span><br></pre></td></tr></table></figure>
<pre><code>1.000000    75
0.500000    28
0.666667    10
0.750000     2
0.333333     1
Name: Survived, dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmp[<span class="number">1</span>] / tmp.values.sum()</span><br></pre></td></tr></table></figure>
<pre><code>0.646551724137931
</code></pre><h5 id="遇难的男孩所在的分组情况"><a href="#遇难的男孩所在的分组情况" class="headerlink" title="遇难的男孩所在的分组情况"></a>遇难的男孩所在的分组情况</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">perished_boys_in_group = all_data.loc[ (all_data.SurnameGroupSize &gt; <span class="number">1</span>) &amp; (all_data.Survived == <span class="number">0</span>) &amp; (index_boy), <span class="string">'SurnameGroupId'</span>].unique()</span><br><span class="line">perished_boys_in_group</span><br></pre></td></tr></table></figure>
<pre><code>array([&apos;Palsson-3-S-21.075-3499__&apos;, &apos;Rice-3-Q-29.125-3826__&apos;,
       &apos;Panula-3-S-39.6875-31012__&apos;, &apos;Goodwin-3-S-46.9-CA 21__&apos;,
       &apos;Skoog-3-S-27.9-3470__&apos;, &apos;Sage-3-S-69.55-CA. 23__&apos;,
       &apos;Lefebre-3-S-25.4667-41__&apos;, &apos;Asplund-3-S-31.3875-3470__&apos;,
       &apos;Hassan-3-C-18.7875-26__&apos;, &apos;Andersson-3-S-31.275-3470__&apos;],
      dtype=object)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tmp = all_data.loc[all_data.SurnameGroupId.isin(perished_boys_in_group), [<span class="string">'SurnameGroupId'</span>, <span class="string">'Survived'</span>]].groupby([<span class="string">'SurnameGroupId'</span>]).Survived.mean().value_counts()</span><br><span class="line">tmp</span><br></pre></td></tr></table></figure>
<pre><code>0.00    8
0.50    1
0.75    1
Name: Survived, dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmp[<span class="number">0</span>] / tmp.values.sum()</span><br></pre></td></tr></table></figure>
<pre><code>0.8
</code></pre><p>遇难的男孩所在的分组不幸全军覆没，由此可以得出结论：如果整组都遇难那么，所在组的男孩就会遇难。</p>
<h5 id="幸存男孩所在的分组"><a href="#幸存男孩所在的分组" class="headerlink" title="幸存男孩所在的分组"></a>幸存男孩所在的分组</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">survived_boys_in_group = all_data.loc[ (all_data.SurnameGroupSize &gt; <span class="number">1</span>) &amp; (all_data.Survived == <span class="number">1</span>) &amp; (index_boy), <span class="string">'SurnameGroupId'</span>].unique()</span><br><span class="line">tmp = all_data.loc[all_data.SurnameGroupId.isin(survived_boys_in_group), [<span class="string">'SurnameGroupId'</span>, <span class="string">'Survived'</span>]].groupby([<span class="string">'SurnameGroupId'</span>]).Survived.mean().value_counts()</span><br><span class="line">tmp</span><br></pre></td></tr></table></figure>
<pre><code>1.000000    12
0.500000     4
0.666667     2
0.750000     1
Name: Survived, dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmp[<span class="number">1</span>] / tmp.values.sum()</span><br></pre></td></tr></table></figure>
<pre><code>0.631578947368421
</code></pre><h5 id="幸存成年男性所在分组情况"><a href="#幸存成年男性所在分组情况" class="headerlink" title="幸存成年男性所在分组情况"></a>幸存成年男性所在分组情况</h5><p>由之前分析我们得到，成年男性幸存率非常低 $20\%$不到</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">survived_male_adults_in_group = all_data.loc[(all_data.SurnameGroupSize &gt; <span class="number">1</span>) &amp; (all_data.Survived == <span class="number">1</span>) &amp; (~index_boy) &amp; (all_data.Sex == <span class="string">'male'</span>)]</span><br><span class="line">survived_male_adults_in_group.SurnameGroupId.unique()</span><br></pre></td></tr></table></figure>
<pre><code>array([&apos;Ling-3-S-56.4958-16__&apos;, &apos;Greenfield-1-C-63.3583-PC 177__&apos;,
       &apos;Hassan-3-C-18.7875-26__&apos;, &apos;Hoyt-1-S-90.0-199__&apos;,
       &apos;Beckwith-1-S-52.5542-117__&apos;, &apos;Tornquist-3-S-0.0-LI__&apos;,
       &apos;McCoy-3-Q-23.25-3672__&apos;, &apos;Harder-1-C-55.4417-117__&apos;,
       &apos;Carter-1-S-120.0-1137__&apos;, &apos;Goldenberg-1-C-89.1042-174__&apos;,
       &apos;Bishop-1-C-91.0792-119__&apos;, &apos;Beane-2-S-26.0-29__&apos;,
       &apos;Thayer-1-C-110.8833-174__&apos;, &apos;Jonsson-3-S-7.8542-3504__&apos;,
       &apos;Frolicher-Stehli-1-C-79.2-135__&apos;,
       &apos;Duff Gordon-1-C-56.9292-PC 174__&apos;, &apos;Kimball-1-S-52.5542-117__&apos;,
       &apos;Nakid-3-C-15.7417-26__&apos;, &apos;Harper-1-C-76.7292-PC 175__&apos;,
       &apos;Frauenthal-1-S-133.65-PC 176__&apos;, &apos;Cardeza-1-C-512.3292-PC 177__&apos;,
       &apos;Dick-1-S-57.0-174__&apos;, &apos;Lam-3-S-56.4958-16__&apos;,
       &apos;Taylor-1-S-52.0-199__&apos;, &apos;Chambers-1-S-53.1-1138__&apos;], dtype=object)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">survived_male_adults_in_group.shape</span><br></pre></td></tr></table></figure>
<pre><code>(30, 21)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tmp = all_data.loc[all_data.SurnameGroupId.isin(survived_male_adults_in_group.SurnameGroupId), [<span class="string">'SurnameGroupId'</span>, <span class="string">'Survived'</span>]].groupby([<span class="string">'SurnameGroupId'</span>]).Survived.mean().value_counts()</span><br><span class="line">tmp</span><br></pre></td></tr></table></figure>
<pre><code>1.00    20
0.50     3
0.80     1
0.75     1
Name: Survived, dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmp.loc[<span class="number">1</span>] / tmp.values.sum()</span><br></pre></td></tr></table></figure>
<pre><code>0.8
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pylab.rcParams[<span class="string">'figure.figsize'</span>] = (<span class="number">4</span>,<span class="number">4</span>)</span><br><span class="line">sns.barplot(x=<span class="string">'Pclass'</span>, y=<span class="string">'Survived'</span>, data=all_data.loc[all_data.SurnameGroupId.isin(survived_male_adults_in_group.SurnameGroupId)])</span><br></pre></td></tr></table></figure>
<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x2d58901e9b0&gt;
</code></pre><p><img src="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_171_1.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">male_adults_in_group = all_data.loc[(all_data.SurnameGroupSize &gt; <span class="number">1</span>) &amp; (~index_boy) &amp; (all_data.Sex == <span class="string">'male'</span>)]</span><br><span class="line">pylab.rcParams[<span class="string">'figure.figsize'</span>] = (<span class="number">4</span>,<span class="number">4</span>)</span><br><span class="line">sns.barplot(x=<span class="string">'Pclass'</span>, y=<span class="string">'Survived'</span>, data=male_adults_in_group)</span><br></pre></td></tr></table></figure>
<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x2d588fcde80&gt;
</code></pre><p><img src="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_172_1.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#all_data.loc[all_data.SurnameGroupId.isin(survived_male_adults_in_group.SurnameGroupId)].sort_values(['SurnameGroupId']).to_csv('幸存的成年男性.csv', index = None)</span></span><br></pre></td></tr></table></figure>
<h5 id="遇难成年男性所在分组情况"><a href="#遇难成年男性所在分组情况" class="headerlink" title="遇难成年男性所在分组情况"></a>遇难成年男性所在分组情况</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">perished_male_adults_in_group = all_data.loc[(all_data.SurnameGroupSize &gt; <span class="number">1</span>) &amp; (all_data.Survived == <span class="number">0</span>) &amp; (~index_boy) &amp; (all_data.Sex == <span class="string">'male'</span>), <span class="string">'SurnameGroupId'</span>].unique()</span><br><span class="line">tmp = all_data.loc[all_data.SurnameGroupId.isin(perished_male_adults_in_group), [<span class="string">'SurnameGroupId'</span>, <span class="string">'Survived'</span>]].groupby([<span class="string">'SurnameGroupId'</span>]).Survived.mean().value_counts()</span><br><span class="line">tmp</span><br></pre></td></tr></table></figure>
<pre><code>0.000000    76
0.500000    32
0.666667    11
0.800000     1
0.333333     1
0.750000     1
Name: Survived, dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmp.loc[<span class="number">0</span>] / tmp.values.sum()</span><br></pre></td></tr></table></figure>
<pre><code>0.6229508196721312
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">perished_females_in_group = <span class="keyword">None</span></span><br><span class="line">survived_females_in_group = <span class="keyword">None</span></span><br><span class="line">perished_boys_in_group = <span class="keyword">None</span></span><br><span class="line">survived_male_adults_in_group = <span class="keyword">None</span></span><br><span class="line">perished_male_adults_in_group = <span class="keyword">None</span></span><br></pre></td></tr></table></figure>
<font color="red"><strong>经过上面的分析，我们能用到的就是将女士和男孩单独区分出来，当他们所在的组是全部幸存或者全部遇难的话，就可以直接判断他们幸存与否</strong></font>

<h3 id="整组幸存情况都未知"><a href="#整组幸存情况都未知" class="headerlink" title="整组幸存情况都未知"></a>整组幸存情况都未知</h3><p>回顾一下之前的<font color="red"><strong>目标</strong></font>：<font color="blue"><strong>默认预测女性都存活，男性都遇难，再加上以下：</strong></font></p>
<ol>
<li><font color="blue">预测什么样的女性会遇难，毕竟少数，如果能够预测对，正确率就会极大提高。</font>
</li>
<li><font color="blue">预测什么样的男孩（最小年龄段的男性）会幸存，也是少数，如果能够预测对，正确率就会极大提高。</font>
</li>
<li><font color="blue">不是第一个年龄段的男性什么条件下会存活？</font>

</li>
</ol>
<p>我们这时候需要考虑<strong>整组人是否幸存都未知的数据</strong>，因为这样的数据我们没法利用组内的平均幸存率做预测。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">selected_features = [<span class="string">'SurnameGroupId'</span>, <span class="string">'Cabin'</span>, <span class="string">'Pclass'</span>, <span class="string">'Embarked'</span>, <span class="string">'Sex'</span>, <span class="string">'Fare'</span>, <span class="string">'TicketGroupId'</span>, <span class="string">'SibSp'</span>, <span class="string">'Parch'</span>, <span class="string">'Age'</span>, <span class="string">'Survived'</span>, <span class="string">'Title'</span>, <span class="string">'SurnameGroupSize'</span>, <span class="string">'SingleTicketFare'</span>]</span><br><span class="line">groups = all_data.loc[(all_data.SurnameGroupSize &gt; <span class="number">1</span>), selected_features].sort_values([<span class="string">'SurnameGroupId'</span>, <span class="string">'Survived'</span>]).groupby([<span class="string">'SurnameGroupId'</span>])</span><br><span class="line"></span><br><span class="line">all_perished_groups = pd.DataFrame()</span><br><span class="line">one_more_survived_groups = pd.DataFrame()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> index, group <span class="keyword">in</span> groups:</span><br><span class="line">    indices = group.Survived.value_counts().index</span><br><span class="line">    <span class="keyword">if</span> indices.shape[<span class="number">0</span>] == <span class="number">0</span>:</span><br><span class="line">        all_perished_groups = all_perished_groups.append(group)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        one_more_survived_groups = one_more_survived_groups.append(group)</span><br><span class="line">        </span><br><span class="line">groups = <span class="keyword">None</span></span><br></pre></td></tr></table></figure>
<p>整组人幸存情况未知的组数为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_perished_groups.SurnameGroupId.unique().shape[<span class="number">0</span>], len(one_more_survived_groups.SurnameGroupId.unique())</span><br></pre></td></tr></table></figure>
<pre><code>(21, 222)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_perished_groups.SurnameGroupId.shape[<span class="number">0</span>], one_more_survived_groups.SurnameGroupId.count()</span><br></pre></td></tr></table></figure>
<pre><code>(44, 606)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_perished_groups.drop([<span class="string">'Survived'</span>, <span class="string">'SurnameGroupSize'</span>], axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>SurnameGroupId</th><br>      <th>Cabin</th><br>      <th>Pclass</th><br>      <th>Embarked</th><br>      <th>Sex</th><br>      <th>Fare</th><br>      <th>TicketGroupId</th><br>      <th>SibSp</th><br>      <th>Parch</th><br>      <th>Age</th><br>      <th>Title</th><br>      <th>SingleTicketFare</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>948</th><br>      <td>Abelseth-3-S-7.65-3481__</td><br>      <td>F G63</td><br>      <td>3</td><br>      <td>S</td><br>      <td>male</td><br>      <td>7.6500</td><br>      <td>3-S-7.65-348122</td><br>      <td>0</td><br>      <td>0</td><br>      <td>25.00</td><br>      <td>Mr</td><br>      <td>7.650000</td><br>    </tr><br>    <tr><br>      <th>1236</th><br>      <td>Abelseth-3-S-7.65-3481__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>S</td><br>      <td>female</td><br>      <td>7.6500</td><br>      <td>3-S-7.65-348125</td><br>      <td>0</td><br>      <td>0</td><br>      <td>16.00</td><br>      <td>Miss</td><br>      <td>7.650000</td><br>    </tr><br>    <tr><br>      <th>1105</th><br>      <td>Andersson-3-S-7.775-3470__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>S</td><br>      <td>female</td><br>      <td>7.7750</td><br>      <td>3-S-7.775-347091</td><br>      <td>4</td><br>      <td>2</td><br>      <td>38.00</td><br>      <td>Miss</td><br>      <td>7.775000</td><br>    </tr><br>    <tr><br>      <th>1211</th><br>      <td>Andersson-3-S-7.775-3470__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>S</td><br>      <td>male</td><br>      <td>7.7750</td><br>      <td>3-S-7.775-347075</td><br>      <td>0</td><br>      <td>0</td><br>      <td>26.00</td><br>      <td>Mr</td><br>      <td>7.775000</td><br>    </tr><br>    <tr><br>      <th>1143</th><br>      <td>Clark-1-C-136.7792-135__</td><br>      <td>C89</td><br>      <td>1</td><br>      <td>C</td><br>      <td>male</td><br>      <td>136.7792</td><br>      <td>1-C-136.7792-13508</td><br>      <td>1</td><br>      <td>0</td><br>      <td>27.00</td><br>      <td>Mr</td><br>      <td>68.389600</td><br>    </tr><br>    <tr><br>      <th>1163</th><br>      <td>Clark-1-C-136.7792-135__</td><br>      <td>C89</td><br>      <td>1</td><br>      <td>C</td><br>      <td>female</td><br>      <td>136.7792</td><br>      <td>1-C-136.7792-13508</td><br>      <td>1</td><br>      <td>0</td><br>      <td>26.00</td><br>      <td>Mrs</td><br>      <td>68.389600</td><br>    </tr><br>    <tr><br>      <th>981</th><br>      <td>Dyker-3-S-13.9-3470__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>S</td><br>      <td>female</td><br>      <td>13.9000</td><br>      <td>3-S-13.9-347072</td><br>      <td>1</td><br>      <td>0</td><br>      <td>22.00</td><br>      <td>Mrs</td><br>      <td>6.950000</td><br>    </tr><br>    <tr><br>      <th>1063</th><br>      <td>Dyker-3-S-13.9-3470__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>S</td><br>      <td>male</td><br>      <td>13.9000</td><br>      <td>3-S-13.9-347072</td><br>      <td>1</td><br>      <td>0</td><br>      <td>23.00</td><br>      <td>Mr</td><br>      <td>6.950000</td><br>    </tr><br>    <tr><br>      <th>1259</th><br>      <td>Gibson-1-C-59.4-1123__</td><br>      <td>NaN</td><br>      <td>1</td><br>      <td>C</td><br>      <td>female</td><br>      <td>59.4000</td><br>      <td>1-C-59.4-112378</td><br>      <td>0</td><br>      <td>1</td><br>      <td>45.00</td><br>      <td>Mrs</td><br>      <td>29.700000</td><br>    </tr><br>    <tr><br>      <th>1293</th><br>      <td>Gibson-1-C-59.4-1123__</td><br>      <td>NaN</td><br>      <td>1</td><br>      <td>C</td><br>      <td>female</td><br>      <td>59.4000</td><br>      <td>1-C-59.4-112378</td><br>      <td>0</td><br>      <td>1</td><br>      <td>22.00</td><br>      <td>Miss</td><br>      <td>29.700000</td><br>    </tr><br>    <tr><br>      <th>904</th><br>      <td>Howard-2-S-26.0-240__</td><br>      <td>NaN</td><br>      <td>2</td><br>      <td>S</td><br>      <td>male</td><br>      <td>26.0000</td><br>      <td>2-S-26.0-24065</td><br>      <td>1</td><br>      <td>0</td><br>      <td>63.00</td><br>      <td>Mr</td><br>      <td>13.000000</td><br>    </tr><br>    <tr><br>      <th>1104</th><br>      <td>Howard-2-S-26.0-240__</td><br>      <td>NaN</td><br>      <td>2</td><br>      <td>S</td><br>      <td>female</td><br>      <td>26.0000</td><br>      <td>2-S-26.0-24065</td><br>      <td>1</td><br>      <td>0</td><br>      <td>60.00</td><br>      <td>Mrs</td><br>      <td>13.000000</td><br>    </tr><br>    <tr><br>      <th>922</th><br>      <td>Jefferys-2-S-31.5-C.A. 310__</td><br>      <td>NaN</td><br>      <td>2</td><br>      <td>S</td><br>      <td>male</td><br>      <td>31.5000</td><br>      <td>2-S-31.5-C.A. 31029</td><br>      <td>2</td><br>      <td>0</td><br>      <td>24.00</td><br>      <td>Mr</td><br>      <td>10.500000</td><br>    </tr><br>    <tr><br>      <th>1210</th><br>      <td>Jefferys-2-S-31.5-C.A. 310__</td><br>      <td>NaN</td><br>      <td>2</td><br>      <td>S</td><br>      <td>male</td><br>      <td>31.5000</td><br>      <td>2-S-31.5-C.A. 31029</td><br>      <td>2</td><br>      <td>0</td><br>      <td>22.00</td><br>      <td>Mr</td><br>      <td>10.500000</td><br>    </tr><br>    <tr><br>      <th>1229</th><br>      <td>Jefferys-2-S-31.5-C.A. 310__</td><br>      <td>NaN</td><br>      <td>2</td><br>      <td>S</td><br>      <td>male</td><br>      <td>31.5000</td><br>      <td>2-S-31.5-C.A. 31029</td><br>      <td>0</td><br>      <td>0</td><br>      <td>25.00</td><br>      <td>Mr</td><br>      <td>10.500000</td><br>    </tr><br>    <tr><br>      <th>956</th><br>      <td>Karnes-2-S-21.0-F.C.C. 135__</td><br>      <td>NaN</td><br>      <td>2</td><br>      <td>S</td><br>      <td>female</td><br>      <td>21.0000</td><br>      <td>2-S-21.0-F.C.C. 13534</td><br>      <td>0</td><br>      <td>0</td><br>      <td>NaN</td><br>      <td>Mrs</td><br>      <td>10.500000</td><br>    </tr><br>    <tr><br>      <th>1137</th><br>      <td>Karnes-2-S-21.0-F.C.C. 135__</td><br>      <td>NaN</td><br>      <td>2</td><br>      <td>S</td><br>      <td>female</td><br>      <td>21.0000</td><br>      <td>2-S-21.0-F.C.C. 13534</td><br>      <td>0</td><br>      <td>0</td><br>      <td>22.00</td><br>      <td>Mrs</td><br>      <td>10.500000</td><br>    </tr><br>    <tr><br>      <th>976</th><br>      <td>Khalil-3-C-14.4542-26__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>C</td><br>      <td>male</td><br>      <td>14.4542</td><br>      <td>3-C-14.4542-2660</td><br>      <td>1</td><br>      <td>0</td><br>      <td>NaN</td><br>      <td>Mr</td><br>      <td>7.227100</td><br>    </tr><br>    <tr><br>      <th>1140</th><br>      <td>Khalil-3-C-14.4542-26__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>C</td><br>      <td>female</td><br>      <td>14.4542</td><br>      <td>3-C-14.4542-2660</td><br>      <td>1</td><br>      <td>0</td><br>      <td>NaN</td><br>      <td>Mrs</td><br>      <td>7.227100</td><br>    </tr><br>    <tr><br>      <th>1044</th><br>      <td>Klasen-3-S-12.1833-3504__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>S</td><br>      <td>female</td><br>      <td>12.1833</td><br>      <td>3-S-12.1833-350405</td><br>      <td>0</td><br>      <td>2</td><br>      <td>36.00</td><br>      <td>Mrs</td><br>      <td>6.091650</td><br>    </tr><br>    <tr><br>      <th>1154</th><br>      <td>Klasen-3-S-12.1833-3504__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>S</td><br>      <td>female</td><br>      <td>12.1833</td><br>      <td>3-S-12.1833-350405</td><br>      <td>1</td><br>      <td>1</td><br>      <td>1.00</td><br>      <td>Miss</td><br>      <td>6.091650</td><br>    </tr><br>    <tr><br>      <th>1009</th><br>      <td>McCaffry-1-C-75.2417-130__</td><br>      <td>C6</td><br>      <td>1</td><br>      <td>C</td><br>      <td>male</td><br>      <td>75.2417</td><br>      <td>1-C-75.2417-13050</td><br>      <td>0</td><br>      <td>0</td><br>      <td>36.00</td><br>      <td>Mr</td><br>      <td>37.620850</td><br>    </tr><br>    <tr><br>      <th>1161</th><br>      <td>McCaffry-1-C-75.2417-130__</td><br>      <td>C6</td><br>      <td>1</td><br>      <td>C</td><br>      <td>male</td><br>      <td>75.2417</td><br>      <td>1-C-75.2417-13050</td><br>      <td>0</td><br>      <td>0</td><br>      <td>46.00</td><br>      <td>Mr</td><br>      <td>37.620850</td><br>    </tr><br>    <tr><br>      <th>1050</th><br>      <td>Peacock-3-S-13.775-SOTON/O.Q. 31013__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>S</td><br>      <td>female</td><br>      <td>13.7750</td><br>      <td>3-S-13.775-SOTON/O.Q. 3101315</td><br>      <td>0</td><br>      <td>2</td><br>      <td>26.00</td><br>      <td>Mrs</td><br>      <td>4.591667</td><br>    </tr><br>    <tr><br>      <th>1172</th><br>      <td>Peacock-3-S-13.775-SOTON/O.Q. 31013__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>S</td><br>      <td>male</td><br>      <td>13.7750</td><br>      <td>3-S-13.775-SOTON/O.Q. 3101315</td><br>      <td>1</td><br>      <td>1</td><br>      <td>0.75</td><br>      <td>Master</td><br>      <td>4.591667</td><br>    </tr><br>    <tr><br>      <th>1300</th><br>      <td>Peacock-3-S-13.775-SOTON/O.Q. 31013__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>S</td><br>      <td>female</td><br>      <td>13.7750</td><br>      <td>3-S-13.775-SOTON/O.Q. 3101315</td><br>      <td>1</td><br>      <td>1</td><br>      <td>3.00</td><br>      <td>Miss</td><br>      <td>4.591667</td><br>    </tr><br>    <tr><br>      <th>1077</th><br>      <td>Phillips-2-S-21.0-S.O./P.P.<strong></strong></td><br>      <td>NaN</td><br>      <td>2</td><br>      <td>S</td><br>      <td>female</td><br>      <td>21.0000</td><br>      <td>2-S-21.0-S.O./P.P. 2</td><br>      <td>0</td><br>      <td>1</td><br>      <td>21.00</td><br>      <td>Miss</td><br>      <td>10.500000</td><br>    </tr><br>    <tr><br>      <th>1193</th><br>      <td>Phillips-2-S-21.0-S.O./P.P.</td><br>      <td>NaN</td><br>      <td>2</td><br>      <td>S</td><br>      <td>male</td><br>      <td>21.0000</td><br>      <td>2-S-21.0-S.O./P.P. 2</td><br>      <td>0</td><br>      <td>1</td><br>      <td>43.00</td><br>      <td>Mr</td><br>      <td>10.500000</td><br>    </tr><br>    <tr><br>      <th>1160</th><br>      <td>Pokrnic-3-S-8.6625-3150__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>S</td><br>      <td>male</td><br>      <td>8.6625</td><br>      <td>3-S-8.6625-315095</td><br>      <td>0</td><br>      <td>0</td><br>      <td>17.00</td><br>      <td>Mr</td><br>      <td>8.662500</td><br>    </tr><br>    <tr><br>      <th>1194</th><br>      <td>Pokrnic-3-S-8.6625-3150__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>S</td><br>      <td>male</td><br>      <td>8.6625</td><br>      <td>3-S-8.6625-315092</td><br>      <td>0</td><br>      <td>0</td><br>      <td>24.00</td><br>      <td>Mr</td><br>      <td>8.662500</td><br>    </tr><br>    <tr><br>      <th>925</th><br>      <td>Schabert-1-C-57.75-132__</td><br>      <td>C78</td><br>      <td>1</td><br>      <td>C</td><br>      <td>male</td><br>      <td>57.7500</td><br>      <td>1-C-57.75-13236</td><br>      <td>1</td><br>      <td>0</td><br>      <td>30.00</td><br>      <td>Mr</td><br>      <td>28.875000</td><br>    </tr><br>    <tr><br>      <th>1013</th><br>      <td>Schabert-1-C-57.75-132__</td><br>      <td>C28</td><br>      <td>1</td><br>      <td>C</td><br>      <td>female</td><br>      <td>57.7500</td><br>      <td>1-C-57.75-13236</td><br>      <td>1</td><br>      <td>0</td><br>      <td>35.00</td><br>      <td>Mrs</td><br>      <td>28.875000</td><br>    </tr><br>    <tr><br>      <th>941</th><br>      <td>Smith-1-S-60.0-136__</td><br>      <td>C31</td><br>      <td>1</td><br>      <td>S</td><br>      <td>male</td><br>      <td>60.0000</td><br>      <td>1-S-60.0-13695</td><br>      <td>1</td><br>      <td>0</td><br>      <td>24.00</td><br>      <td>Mr</td><br>      <td>30.000000</td><br>    </tr><br>    <tr><br>      <th>1286</th><br>      <td>Smith-1-S-60.0-136__</td><br>      <td>C31</td><br>      <td>1</td><br>      <td>S</td><br>      <td>female</td><br>      <td>60.0000</td><br>      <td>1-S-60.0-13695</td><br>      <td>1</td><br>      <td>0</td><br>      <td>18.00</td><br>      <td>Mrs</td><br>      <td>30.000000</td><br>    </tr><br>    <tr><br>      <th>903</th><br>      <td>Snyder-1-S-82.2667-212__</td><br>      <td>B45</td><br>      <td>1</td><br>      <td>S</td><br>      <td>female</td><br>      <td>82.2667</td><br>      <td>1-S-82.2667-21228</td><br>      <td>1</td><br>      <td>0</td><br>      <td>23.00</td><br>      <td>Mrs</td><br>      <td>41.133350</td><br>    </tr><br>    <tr><br>      <th>1178</th><br>      <td>Snyder-1-S-82.2667-212__</td><br>      <td>B45</td><br>      <td>1</td><br>      <td>S</td><br>      <td>male</td><br>      <td>82.2667</td><br>      <td>1-S-82.2667-21228</td><br>      <td>1</td><br>      <td>0</td><br>      <td>24.00</td><br>      <td>Mr</td><br>      <td>41.133350</td><br>    </tr><br>    <tr><br>      <th>991</th><br>      <td>Stengel-1-C-55.4417-117__</td><br>      <td>C116</td><br>      <td>1</td><br>      <td>C</td><br>      <td>female</td><br>      <td>55.4417</td><br>      <td>1-C-55.4417-11778</td><br>      <td>1</td><br>      <td>0</td><br>      <td>43.00</td><br>      <td>Mrs</td><br>      <td>27.720850</td><br>    </tr><br>    <tr><br>      <th>1068</th><br>      <td>Stengel-1-C-55.4417-117__</td><br>      <td>C116</td><br>      <td>1</td><br>      <td>C</td><br>      <td>male</td><br>      <td>55.4417</td><br>      <td>1-C-55.4417-11778</td><br>      <td>1</td><br>      <td>0</td><br>      <td>54.00</td><br>      <td>Mr</td><br>      <td>27.720850</td><br>    </tr><br>    <tr><br>      <th>1007</th><br>      <td>Thomas-3-C-6.4375-26__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>C</td><br>      <td>male</td><br>      <td>6.4375</td><br>      <td>3-C-6.4375-2681</td><br>      <td>0</td><br>      <td>0</td><br>      <td>NaN</td><br>      <td>Mr</td><br>      <td>6.437500</td><br>    </tr><br>    <tr><br>      <th>1024</th><br>      <td>Thomas-3-C-6.4375-26__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>C</td><br>      <td>male</td><br>      <td>6.4375</td><br>      <td>3-C-6.4375-2621</td><br>      <td>1</td><br>      <td>0</td><br>      <td>NaN</td><br>      <td>Mr</td><br>      <td>6.437500</td><br>    </tr><br>    <tr><br>      <th>1169</th><br>      <td>Ware-2-S-21.0-CA 313__</td><br>      <td>NaN</td><br>      <td>2</td><br>      <td>S</td><br>      <td>male</td><br>      <td>21.0000</td><br>      <td>2-S-21.0-CA 31352</td><br>      <td>1</td><br>      <td>0</td><br>      <td>30.00</td><br>      <td>Mr</td><br>      <td>10.500000</td><br>    </tr><br>    <tr><br>      <th>1253</th><br>      <td>Ware-2-S-21.0-CA 313__</td><br>      <td>NaN</td><br>      <td>2</td><br>      <td>S</td><br>      <td>female</td><br>      <td>21.0000</td><br>      <td>2-S-21.0-CA 31352</td><br>      <td>0</td><br>      <td>0</td><br>      <td>31.00</td><br>      <td>Mrs</td><br>      <td>10.500000</td><br>    </tr><br>    <tr><br>      <th>1027</th><br>      <td>Zakarian-3-C-7.225-26__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>C</td><br>      <td>male</td><br>      <td>7.2250</td><br>      <td>3-C-7.225-2656</td><br>      <td>0</td><br>      <td>0</td><br>      <td>26.50</td><br>      <td>Mr</td><br>      <td>7.225000</td><br>    </tr><br>    <tr><br>      <th>1062</th><br>      <td>Zakarian-3-C-7.225-26__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>C</td><br>      <td>male</td><br>      <td>7.2250</td><br>      <td>3-C-7.225-2670</td><br>      <td>0</td><br>      <td>0</td><br>      <td>27.00</td><br>      <td>Mr</td><br>      <td>7.225000</td><br>    </tr><br>  </tbody><br></table>

<p>挑出女性和男孩的情况： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_perished_groups.loc[(all_perished_groups.Sex == <span class="string">'female'</span>) | ((all_perished_groups.Age &lt;= children_age_upper_limit) &amp; (all_perished_groups.Sex == <span class="string">'male'</span>)) | (all_perished_groups.Title == <span class="string">'Master'</span>)]</span><br></pre></td></tr></table></figure>
<table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>SurnameGroupId</th><br>      <th>Cabin</th><br>      <th>Pclass</th><br>      <th>Embarked</th><br>      <th>Sex</th><br>      <th>Fare</th><br>      <th>TicketGroupId</th><br>      <th>SibSp</th><br>      <th>Parch</th><br>      <th>Age</th><br>      <th>Survived</th><br>      <th>Title</th><br>      <th>SurnameGroupSize</th><br>      <th>SingleTicketFare</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>1236</th><br>      <td>Abelseth-3-S-7.65-3481__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>S</td><br>      <td>female</td><br>      <td>7.6500</td><br>      <td>3-S-7.65-348125</td><br>      <td>0</td><br>      <td>0</td><br>      <td>16.00</td><br>      <td>NaN</td><br>      <td>Miss</td><br>      <td>2</td><br>      <td>7.650000</td><br>    </tr><br>    <tr><br>      <th>1105</th><br>      <td>Andersson-3-S-7.775-3470__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>S</td><br>      <td>female</td><br>      <td>7.7750</td><br>      <td>3-S-7.775-347091</td><br>      <td>4</td><br>      <td>2</td><br>      <td>38.00</td><br>      <td>NaN</td><br>      <td>Miss</td><br>      <td>2</td><br>      <td>7.775000</td><br>    </tr><br>    <tr><br>      <th>1163</th><br>      <td>Clark-1-C-136.7792-135__</td><br>      <td>C89</td><br>      <td>1</td><br>      <td>C</td><br>      <td>female</td><br>      <td>136.7792</td><br>      <td>1-C-136.7792-13508</td><br>      <td>1</td><br>      <td>0</td><br>      <td>26.00</td><br>      <td>NaN</td><br>      <td>Mrs</td><br>      <td>2</td><br>      <td>68.389600</td><br>    </tr><br>    <tr><br>      <th>981</th><br>      <td>Dyker-3-S-13.9-3470__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>S</td><br>      <td>female</td><br>      <td>13.9000</td><br>      <td>3-S-13.9-347072</td><br>      <td>1</td><br>      <td>0</td><br>      <td>22.00</td><br>      <td>NaN</td><br>      <td>Mrs</td><br>      <td>2</td><br>      <td>6.950000</td><br>    </tr><br>    <tr><br>      <th>1259</th><br>      <td>Gibson-1-C-59.4-1123__</td><br>      <td>NaN</td><br>      <td>1</td><br>      <td>C</td><br>      <td>female</td><br>      <td>59.4000</td><br>      <td>1-C-59.4-112378</td><br>      <td>0</td><br>      <td>1</td><br>      <td>45.00</td><br>      <td>NaN</td><br>      <td>Mrs</td><br>      <td>2</td><br>      <td>29.700000</td><br>    </tr><br>    <tr><br>      <th>1293</th><br>      <td>Gibson-1-C-59.4-1123__</td><br>      <td>NaN</td><br>      <td>1</td><br>      <td>C</td><br>      <td>female</td><br>      <td>59.4000</td><br>      <td>1-C-59.4-112378</td><br>      <td>0</td><br>      <td>1</td><br>      <td>22.00</td><br>      <td>NaN</td><br>      <td>Miss</td><br>      <td>2</td><br>      <td>29.700000</td><br>    </tr><br>    <tr><br>      <th>1104</th><br>      <td>Howard-2-S-26.0-240__</td><br>      <td>NaN</td><br>      <td>2</td><br>      <td>S</td><br>      <td>female</td><br>      <td>26.0000</td><br>      <td>2-S-26.0-24065</td><br>      <td>1</td><br>      <td>0</td><br>      <td>60.00</td><br>      <td>NaN</td><br>      <td>Mrs</td><br>      <td>2</td><br>      <td>13.000000</td><br>    </tr><br>    <tr><br>      <th>956</th><br>      <td>Karnes-2-S-21.0-F.C.C. 135__</td><br>      <td>NaN</td><br>      <td>2</td><br>      <td>S</td><br>      <td>female</td><br>      <td>21.0000</td><br>      <td>2-S-21.0-F.C.C. 13534</td><br>      <td>0</td><br>      <td>0</td><br>      <td>NaN</td><br>      <td>NaN</td><br>      <td>Mrs</td><br>      <td>2</td><br>      <td>10.500000</td><br>    </tr><br>    <tr><br>      <th>1137</th><br>      <td>Karnes-2-S-21.0-F.C.C. 135__</td><br>      <td>NaN</td><br>      <td>2</td><br>      <td>S</td><br>      <td>female</td><br>      <td>21.0000</td><br>      <td>2-S-21.0-F.C.C. 13534</td><br>      <td>0</td><br>      <td>0</td><br>      <td>22.00</td><br>      <td>NaN</td><br>      <td>Mrs</td><br>      <td>2</td><br>      <td>10.500000</td><br>    </tr><br>    <tr><br>      <th>1140</th><br>      <td>Khalil-3-C-14.4542-26__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>C</td><br>      <td>female</td><br>      <td>14.4542</td><br>      <td>3-C-14.4542-2660</td><br>      <td>1</td><br>      <td>0</td><br>      <td>NaN</td><br>      <td>NaN</td><br>      <td>Mrs</td><br>      <td>2</td><br>      <td>7.227100</td><br>    </tr><br>    <tr><br>      <th>1044</th><br>      <td>Klasen-3-S-12.1833-3504__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>S</td><br>      <td>female</td><br>      <td>12.1833</td><br>      <td>3-S-12.1833-350405</td><br>      <td>0</td><br>      <td>2</td><br>      <td>36.00</td><br>      <td>NaN</td><br>      <td>Mrs</td><br>      <td>2</td><br>      <td>6.091650</td><br>    </tr><br>    <tr><br>      <th>1154</th><br>      <td>Klasen-3-S-12.1833-3504__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>S</td><br>      <td>female</td><br>      <td>12.1833</td><br>      <td>3-S-12.1833-350405</td><br>      <td>1</td><br>      <td>1</td><br>      <td>1.00</td><br>      <td>NaN</td><br>      <td>Miss</td><br>      <td>2</td><br>      <td>6.091650</td><br>    </tr><br>    <tr><br>      <th>1050</th><br>      <td>Peacock-3-S-13.775-SOTON/O.Q. 31013__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>S</td><br>      <td>female</td><br>      <td>13.7750</td><br>      <td>3-S-13.775-SOTON/O.Q. 3101315</td><br>      <td>0</td><br>      <td>2</td><br>      <td>26.00</td><br>      <td>NaN</td><br>      <td>Mrs</td><br>      <td>3</td><br>      <td>4.591667</td><br>    </tr><br>    <tr><br>      <th>1172</th><br>      <td>Peacock-3-S-13.775-SOTON/O.Q. 31013__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>S</td><br>      <td>male</td><br>      <td>13.7750</td><br>      <td>3-S-13.775-SOTON/O.Q. 3101315</td><br>      <td>1</td><br>      <td>1</td><br>      <td>0.75</td><br>      <td>NaN</td><br>      <td>Master</td><br>      <td>3</td><br>      <td>4.591667</td><br>    </tr><br>    <tr><br>      <th>1300</th><br>      <td>Peacock-3-S-13.775-SOTON/O.Q. 31013__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>S</td><br>      <td>female</td><br>      <td>13.7750</td><br>      <td>3-S-13.775-SOTON/O.Q. 3101315</td><br>      <td>1</td><br>      <td>1</td><br>      <td>3.00</td><br>      <td>NaN</td><br>      <td>Miss</td><br>      <td>3</td><br>      <td>4.591667</td><br>    </tr><br>    <tr><br>      <th>1077</th><br>      <td>Phillips-2-S-21.0-S.O./P.P.<strong></strong></td><br>      <td>NaN</td><br>      <td>2</td><br>      <td>S</td><br>      <td>female</td><br>      <td>21.0000</td><br>      <td>2-S-21.0-S.O./P.P. 2</td><br>      <td>0</td><br>      <td>1</td><br>      <td>21.00</td><br>      <td>NaN</td><br>      <td>Miss</td><br>      <td>2</td><br>      <td>10.500000</td><br>    </tr><br>    <tr><br>      <th>1013</th><br>      <td>Schabert-1-C-57.75-132</td><br>      <td>C28</td><br>      <td>1</td><br>      <td>C</td><br>      <td>female</td><br>      <td>57.7500</td><br>      <td>1-C-57.75-13236</td><br>      <td>1</td><br>      <td>0</td><br>      <td>35.00</td><br>      <td>NaN</td><br>      <td>Mrs</td><br>      <td>2</td><br>      <td>28.875000</td><br>    </tr><br>    <tr><br>      <th>1286</th><br>      <td>Smith-1-S-60.0-136__</td><br>      <td>C31</td><br>      <td>1</td><br>      <td>S</td><br>      <td>female</td><br>      <td>60.0000</td><br>      <td>1-S-60.0-13695</td><br>      <td>1</td><br>      <td>0</td><br>      <td>18.00</td><br>      <td>NaN</td><br>      <td>Mrs</td><br>      <td>2</td><br>      <td>30.000000</td><br>    </tr><br>    <tr><br>      <th>903</th><br>      <td>Snyder-1-S-82.2667-212__</td><br>      <td>B45</td><br>      <td>1</td><br>      <td>S</td><br>      <td>female</td><br>      <td>82.2667</td><br>      <td>1-S-82.2667-21228</td><br>      <td>1</td><br>      <td>0</td><br>      <td>23.00</td><br>      <td>NaN</td><br>      <td>Mrs</td><br>      <td>2</td><br>      <td>41.133350</td><br>    </tr><br>    <tr><br>      <th>991</th><br>      <td>Stengel-1-C-55.4417-117__</td><br>      <td>C116</td><br>      <td>1</td><br>      <td>C</td><br>      <td>female</td><br>      <td>55.4417</td><br>      <td>1-C-55.4417-11778</td><br>      <td>1</td><br>      <td>0</td><br>      <td>43.00</td><br>      <td>NaN</td><br>      <td>Mrs</td><br>      <td>2</td><br>      <td>27.720850</td><br>    </tr><br>    <tr><br>      <th>1253</th><br>      <td>Ware-2-S-21.0-CA 313__</td><br>      <td>NaN</td><br>      <td>2</td><br>      <td>S</td><br>      <td>female</td><br>      <td>21.0000</td><br>      <td>2-S-21.0-CA 31352</td><br>      <td>0</td><br>      <td>0</td><br>      <td>31.00</td><br>      <td>NaN</td><br>      <td>Mrs</td><br>      <td>2</td><br>      <td>10.500000</td><br>    </tr><br>  </tbody><br></table>

<p>检查一下：<code>van Billiard</code> 家庭：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_data.loc[all_data.Surname == <span class="string">'van Billiard'</span>].drop([<span class="string">'Ticket'</span>, <span class="string">'FamilySize'</span>, <span class="string">'Surname'</span>, <span class="string">'Name'</span>, <span class="string">'TicketGroupSize'</span>, <span class="string">'PassengerId'</span>], axis = <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>Age</th><br>      <th>Cabin</th><br>      <th>Embarked</th><br>      <th>Fare</th><br>      <th>Parch</th><br>      <th>Pclass</th><br>      <th>Sex</th><br>      <th>SibSp</th><br>      <th>Survived</th><br>      <th>TicketSize</th><br>      <th>SingleTicketFare</th><br>      <th>Title</th><br>      <th>SurnameGroupId</th><br>      <th>TicketGroupId</th><br>      <th>SurnameGroupSize</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>153</th><br>      <td>40.5</td><br>      <td>NaN</td><br>      <td>S</td><br>      <td>14.5</td><br>      <td>2</td><br>      <td>3</td><br>      <td>male</td><br>      <td>0</td><br>      <td>0.0</td><br>      <td>3</td><br>      <td>4.833333</td><br>      <td>Mr</td><br>      <td>van Billiard-3-S-14.5-A/5. 8__</td><br>      <td>3-S-14.5-A/5. 851</td><br>      <td>3</td><br>    </tr><br>    <tr><br>      <th>1083</th><br>      <td>11.5</td><br>      <td>NaN</td><br>      <td>S</td><br>      <td>14.5</td><br>      <td>1</td><br>      <td>3</td><br>      <td>male</td><br>      <td>1</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>4.833333</td><br>      <td>Master</td><br>      <td>van Billiard-3-S-14.5-A/5. 8__</td><br>      <td>3-S-14.5-A/5. 851</td><br>      <td>3</td><br>    </tr><br>    <tr><br>      <th>1235</th><br>      <td>NaN</td><br>      <td>NaN</td><br>      <td>S</td><br>      <td>14.5</td><br>      <td>1</td><br>      <td>3</td><br>      <td>male</td><br>      <td>1</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>4.833333</td><br>      <td>Master</td><br>      <td>van Billiard-3-S-14.5-A/5. 8__</td><br>      <td>3-S-14.5-A/5. 851</td><br>      <td>3</td><br>    </tr><br>  </tbody><br></table>

<h4 id="至少一个人生存情况可知的组"><a href="#至少一个人生存情况可知的组" class="headerlink" title="至少一个人生存情况可知的组"></a>至少一个人生存情况可知的组</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">one_more_survived_groups.head(<span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>SurnameGroupId</th><br>      <th>Cabin</th><br>      <th>Pclass</th><br>      <th>Embarked</th><br>      <th>Sex</th><br>      <th>Fare</th><br>      <th>TicketGroupId</th><br>      <th>SibSp</th><br>      <th>Parch</th><br>      <th>Age</th><br>      <th>Survived</th><br>      <th>Title</th><br>      <th>SurnameGroupSize</th><br>      <th>SingleTicketFare</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>746</th><br>      <td>Abbott-3-S-20.25-C.A. 26__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>S</td><br>      <td>male</td><br>      <td>20.2500</td><br>      <td>3-S-20.25-C.A. 2673</td><br>      <td>1</td><br>      <td>1</td><br>      <td>16.00</td><br>      <td>0.0</td><br>      <td>Mr</td><br>      <td>3</td><br>      <td>6.750000</td><br>    </tr><br>    <tr><br>      <th>279</th><br>      <td>Abbott-3-S-20.25-C.A. 26__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>S</td><br>      <td>female</td><br>      <td>20.2500</td><br>      <td>3-S-20.25-C.A. 2673</td><br>      <td>1</td><br>      <td>1</td><br>      <td>35.00</td><br>      <td>1.0</td><br>      <td>Mrs</td><br>      <td>3</td><br>      <td>6.750000</td><br>    </tr><br>    <tr><br>      <th>1283</th><br>      <td>Abbott-3-S-20.25-C.A. 26__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>S</td><br>      <td>male</td><br>      <td>20.2500</td><br>      <td>3-S-20.25-C.A. 2673</td><br>      <td>0</td><br>      <td>2</td><br>      <td>13.00</td><br>      <td>NaN</td><br>      <td>Master</td><br>      <td>3</td><br>      <td>6.750000</td><br>    </tr><br>    <tr><br>      <th>308</th><br>      <td>Abelson-2-C-24.0-P/PP 33__</td><br>      <td>NaN</td><br>      <td>2</td><br>      <td>C</td><br>      <td>male</td><br>      <td>24.0000</td><br>      <td>2-C-24.0-P/PP 3381</td><br>      <td>1</td><br>      <td>0</td><br>      <td>30.00</td><br>      <td>0.0</td><br>      <td>Mr</td><br>      <td>2</td><br>      <td>12.000000</td><br>    </tr><br>    <tr><br>      <th>874</th><br>      <td>Abelson-2-C-24.0-P/PP 33__</td><br>      <td>NaN</td><br>      <td>2</td><br>      <td>C</td><br>      <td>female</td><br>      <td>24.0000</td><br>      <td>2-C-24.0-P/PP 3381</td><br>      <td>1</td><br>      <td>0</td><br>      <td>28.00</td><br>      <td>1.0</td><br>      <td>Mrs</td><br>      <td>2</td><br>      <td>12.000000</td><br>    </tr><br>    <tr><br>      <th>855</th><br>      <td>Aks-3-S-9.35-3920__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>S</td><br>      <td>female</td><br>      <td>9.3500</td><br>      <td>3-S-9.35-392091</td><br>      <td>0</td><br>      <td>1</td><br>      <td>18.00</td><br>      <td>1.0</td><br>      <td>Mrs</td><br>      <td>2</td><br>      <td>4.675000</td><br>    </tr><br>    <tr><br>      <th>1198</th><br>      <td>Aks-3-S-9.35-3920__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>S</td><br>      <td>male</td><br>      <td>9.3500</td><br>      <td>3-S-9.35-392091</td><br>      <td>0</td><br>      <td>1</td><br>      <td>0.83</td><br>      <td>NaN</td><br>      <td>Master</td><br>      <td>2</td><br>      <td>4.675000</td><br>    </tr><br>    <tr><br>      <th>210</th><br>      <td>Ali-3-S-7.05-SOTON/O.Q. 31013__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>S</td><br>      <td>male</td><br>      <td>7.0500</td><br>      <td>3-S-7.05-SOTON/O.Q. 3101311</td><br>      <td>0</td><br>      <td>0</td><br>      <td>24.00</td><br>      <td>0.0</td><br>      <td>Mr</td><br>      <td>2</td><br>      <td>7.050000</td><br>    </tr><br>    <tr><br>      <th>784</th><br>      <td>Ali-3-S-7.05-SOTON/O.Q. 31013__</td><br>      <td>NaN</td><br>      <td>3</td><br>      <td>S</td><br>      <td>male</td><br>      <td>7.0500</td><br>      <td>3-S-7.05-SOTON/O.Q. 3101312</td><br>      <td>0</td><br>      <td>0</td><br>      <td>25.00</td><br>      <td>0.0</td><br>      <td>Mr</td><br>      <td>2</td><br>      <td>7.050000</td><br>    </tr><br>    <tr><br>      <th>689</th><br>      <td>Allen-1-S-211.3375-241__</td><br>      <td>B5</td><br>      <td>1</td><br>      <td>S</td><br>      <td>female</td><br>      <td>211.3375</td><br>      <td>1-S-211.3375-24160</td><br>      <td>0</td><br>      <td>1</td><br>      <td>15.00</td><br>      <td>1.0</td><br>      <td>Miss</td><br>      <td>4</td><br>      <td>52.834375</td><br>    </tr><br>  </tbody><br></table>

<h4 id="Pclass"><a href="#Pclass" class="headerlink" title="Pclass"></a>Pclass</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pclass_survived = dict(one_more_survived_groups.groupby([<span class="string">'Pclass'</span>]).Survived.mean())</span><br><span class="line">print(pclass_survived)</span><br><span class="line">plt.rcParams[<span class="string">'figure.figsize'</span>] =(<span class="number">5</span>, <span class="number">2</span>)</span><br><span class="line">sns.barplot(x=<span class="string">'Survived'</span>, y=<span class="string">'Pclass'</span>, data=one_more_survived_groups, orient=<span class="string">'h'</span>)</span><br></pre></td></tr></table></figure>
<pre><code>{1: 0.723404255319149, 2: 0.5567010309278351, 3: 0.27860696517412936}





&lt;matplotlib.axes._subplots.AxesSubplot at 0x2d5890c9978&gt;
</code></pre><p><img src="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_192_2.png" alt="png"></p>
<h4 id="Embarked"><a href="#Embarked" class="headerlink" title="Embarked"></a>Embarked</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">embarked_survived = dict(one_more_survived_groups.groupby([<span class="string">'Embarked'</span>]).Survived.mean())</span><br><span class="line">print(embarked_survived)</span><br><span class="line">plt.rcParams[<span class="string">'figure.figsize'</span>] =(<span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line">sns.barplot(x=<span class="string">'Embarked'</span>, y=<span class="string">'Survived'</span>, data=one_more_survived_groups)</span><br></pre></td></tr></table></figure>
<pre><code>{&apos;C&apos;: 0.6826923076923077, &apos;Q&apos;: 0.3181818181818182, &apos;S&apos;: 0.42443729903536975}





&lt;matplotlib.axes._subplots.AxesSubplot at 0x2d5890c9ba8&gt;
</code></pre><p><img src="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_194_2.png" alt="png"></p>
<h4 id="Fare-1"><a href="#Fare-1" class="headerlink" title="Fare"></a>Fare</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">one_more_survived_groups[<span class="string">'CategoricalFare'</span>] = pd.qcut(one_more_survived_groups[<span class="string">'Fare'</span>], <span class="number">10</span>)</span><br><span class="line">fare_survived = one_more_survived_groups.loc[:, [<span class="string">'CategoricalFare'</span>, <span class="string">'Survived'</span>]].groupby([<span class="string">'CategoricalFare'</span>]).mean()</span><br><span class="line">print(fare_survived)</span><br><span class="line">plt.xticks(rotation=<span class="number">270</span>)</span><br><span class="line">plt.rcParams[<span class="string">'figure.figsize'</span>] =(<span class="number">5</span>, <span class="number">5</span>)</span><br><span class="line">sns.barplot(x=<span class="string">'CategoricalFare'</span>, y=<span class="string">'Survived'</span>, data=one_more_survived_groups)</span><br><span class="line"><span class="comment">#one_more_survived_groups.drop(['CategoricalFare'], axis = 1, inplace=True)</span></span><br></pre></td></tr></table></figure>
<pre><code>                  Survived
CategoricalFare           
(-0.001, 11.133]  0.148936
(11.133, 15.5]    0.391304
(15.5, 20.25]     0.522727
(20.25, 25.467]   0.380952
(25.467, 27.9]    0.468085
(27.9, 39.688]    0.363636
(39.688, 57.0]    0.577778
(57.0, 78.85]     0.523810
(78.85, 134.5]    0.795918
(134.5, 512.329]  0.696970





&lt;matplotlib.axes._subplots.AxesSubplot at 0x2d58919feb8&gt;
</code></pre><p><img src="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_196_2.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">one_more_survived_groups[<span class="string">'CategoricalFare'</span>] = pd.qcut(one_more_survived_groups[<span class="string">'SingleTicketFare'</span>], <span class="number">16</span>)</span><br><span class="line">fare_survived = one_more_survived_groups.loc[:, [<span class="string">'CategoricalFare'</span>, <span class="string">'Survived'</span>]].groupby([<span class="string">'CategoricalFare'</span>]).mean()</span><br><span class="line">print(fare_survived)</span><br><span class="line">plt.xticks(rotation=<span class="number">270</span>)</span><br><span class="line">plt.rcParams[<span class="string">'figure.figsize'</span>] =(<span class="number">5</span>, <span class="number">5</span>)</span><br><span class="line">sns.barplot(x=<span class="string">'CategoricalFare'</span>, y=<span class="string">'Survived'</span>, data=one_more_survived_groups)</span><br><span class="line"><span class="comment">#one_more_survived_groups.drop(['CategoricalFare'], axis = 1, inplace=True)</span></span><br></pre></td></tr></table></figure>
<pre><code>                   Survived
CategoricalFare            
(-0.001, 4.65]     0.242424
(4.65, 5.231]      0.346154
(5.231, 6.238]     0.448276
(6.238, 6.938]     0.321429
(6.938, 7.25]      0.266667
(7.25, 7.775]      0.428571
(7.775, 8.05]      0.212121
(8.05, 9.188]      0.384615
(9.188, 11.0]      0.500000
(11.0, 13.0]       0.527778
(13.0, 23.539]     0.538462
(23.539, 26.55]    0.647059
(26.55, 28.99]     0.916667
(28.99, 37.482]    0.653846
(37.482, 43.833]   0.615385
(43.833, 128.082]  0.846154





&lt;matplotlib.axes._subplots.AxesSubplot at 0x2d5892217b8&gt;
</code></pre><p><img src="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_197_2.png" alt="png"></p>
<h4 id="Cabin"><a href="#Cabin" class="headerlink" title="Cabin"></a>Cabin</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">one_more_survived_groups.Cabin.fillna(<span class="string">'Unknown'</span>, inplace=<span class="keyword">True</span>)</span><br><span class="line">one_more_survived_groups[<span class="string">'OneBitCabin'</span>] = one_more_survived_groups.Cabin.apply(<span class="keyword">lambda</span> x: str(x)[<span class="number">0</span>])</span><br><span class="line">cabin_survived = one_more_survived_groups.loc[:, [<span class="string">'OneBitCabin'</span>, <span class="string">'Survived'</span>]].groupby([<span class="string">'OneBitCabin'</span>]).mean()</span><br><span class="line">print(cabin_survived)</span><br><span class="line">sns.barplot(x=<span class="string">'OneBitCabin'</span>, y=<span class="string">'Survived'</span>, data=one_more_survived_groups)</span><br><span class="line"><span class="comment">#one_more_survived_groups.drop(['OneBitCabin'], axis = 1, inplace=True)</span></span><br></pre></td></tr></table></figure>
<pre><code>             Survived
OneBitCabin          
A            0.666667
B            0.815789
C            0.619048
D            0.818182
E            0.736842
F            0.833333
G            0.500000
U            0.373770





&lt;matplotlib.axes._subplots.AxesSubplot at 0x2d5892d8208&gt;
</code></pre><p><img src="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_199_2.png" alt="png"></p>
<h4 id="Sex-1"><a href="#Sex-1" class="headerlink" title="Sex"></a>Sex</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sex_survived = dict(one_more_survived_groups.groupby([<span class="string">'Sex'</span>]).Survived.mean())</span><br><span class="line">print(sex_survived)</span><br><span class="line">plt.rcParams[<span class="string">'figure.figsize'</span>] =(<span class="number">5</span>, <span class="number">1</span>)</span><br><span class="line">sns.barplot(x=<span class="string">'Survived'</span>, y=<span class="string">'Sex'</span>, data=one_more_survived_groups, orient=<span class="string">'h'</span>)</span><br></pre></td></tr></table></figure>
<pre><code>{&apos;female&apos;: 0.7361111111111112, &apos;male&apos;: 0.23766816143497757}





&lt;matplotlib.axes._subplots.AxesSubplot at 0x2d5892d1c18&gt;
</code></pre><p><img src="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_201_2.png" alt="png"></p>
<h4 id="Age-1"><a href="#Age-1" class="headerlink" title="Age"></a>Age</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">print(np.sum(one_more_survived_groups.Age.isna()) / one_more_survived_groups.shape[<span class="number">0</span>])</span><br><span class="line">plt.xticks(rotation=<span class="number">270</span>)</span><br><span class="line">pylab.rcParams[<span class="string">'figure.figsize'</span>] =(<span class="number">24</span>, <span class="number">8</span>)</span><br><span class="line">sns.barplot(x=<span class="string">'Age'</span>, y=<span class="string">'Survived'</span>, data=one_more_survived_groups)</span><br></pre></td></tr></table></figure>
<pre><code>0.13861386138613863





&lt;matplotlib.axes._subplots.AxesSubplot at 0x2d58927ae80&gt;
</code></pre><p><img src="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_203_2.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getAgeSegment</span><span class="params">(age)</span>:</span></span><br><span class="line">    age_seg = <span class="number">3</span> <span class="comment"># 退休</span></span><br><span class="line">    <span class="keyword">if</span> age &lt;= <span class="number">15</span>:</span><br><span class="line">        age_seg = <span class="number">1</span> <span class="comment"># 小孩</span></span><br><span class="line">    <span class="keyword">elif</span> age &lt;= <span class="number">60</span>:  </span><br><span class="line">        age_seg = <span class="number">2</span> <span class="comment"># 未退休</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> np.int32(age_seg)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">one_more_survived_groups[<span class="string">'age_segment'</span>] = one_more_survived_groups.Age.apply(<span class="keyword">lambda</span> x: getAgeSegment(x))</span><br><span class="line">age_survived = dict(one_more_survived_groups.groupby([<span class="string">'age_segment'</span>]).Survived.mean())</span><br><span class="line">print(age_survived)</span><br><span class="line">plt.rcParams[<span class="string">'figure.figsize'</span>] = (<span class="number">5</span>, <span class="number">4</span>)</span><br><span class="line">sns.barplot(x=<span class="string">'age_segment'</span>, y=<span class="string">'Survived'</span>, data=one_more_survived_groups)</span><br></pre></td></tr></table></figure>
<pre><code>{1: 0.5822784810126582, 2: 0.48109965635738833, 3: 0.37681159420289856}





&lt;matplotlib.axes._subplots.AxesSubplot at 0x2d58956b278&gt;
</code></pre><p><img src="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_205_2.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> mean</span><br><span class="line">sex_age_survived = one_more_survived_groups.groupby([<span class="string">'age_segment'</span>, <span class="string">'Sex'</span>]).Survived.mean()</span><br><span class="line">print(sex_age_survived)</span><br><span class="line">sns.barplot(x=<span class="string">'age_segment'</span>, y=<span class="string">'Survived'</span>, hue=<span class="string">'Sex'</span>, data=one_more_survived_groups, estimator=mean)</span><br></pre></td></tr></table></figure>
<pre><code>age_segment  Sex   
1            female    0.641026
             male      0.525000
2            female    0.773973
             male      0.186207
3            female    0.677419
             male      0.131579
Name: Survived, dtype: float64





&lt;matplotlib.axes._subplots.AxesSubplot at 0x2d5895e2940&gt;
</code></pre><p><img src="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_206_2.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">one_more_survived_groups.columns</span><br></pre></td></tr></table></figure>
<pre><code>Index([&apos;SurnameGroupId&apos;, &apos;Cabin&apos;, &apos;Pclass&apos;, &apos;Embarked&apos;, &apos;Sex&apos;, &apos;Fare&apos;,
       &apos;TicketGroupId&apos;, &apos;SibSp&apos;, &apos;Parch&apos;, &apos;Age&apos;, &apos;Survived&apos;, &apos;Title&apos;,
       &apos;SurnameGroupSize&apos;, &apos;SingleTicketFare&apos;, &apos;CategoricalFare&apos;,
       &apos;OneBitCabin&apos;, &apos;age_segment&apos;],
      dtype=&apos;object&apos;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_perished_groups.columns</span><br></pre></td></tr></table></figure>
<pre><code>Index([&apos;SurnameGroupId&apos;, &apos;Cabin&apos;, &apos;Pclass&apos;, &apos;Embarked&apos;, &apos;Sex&apos;, &apos;Fare&apos;,
       &apos;TicketGroupId&apos;, &apos;SibSp&apos;, &apos;Parch&apos;, &apos;Age&apos;, &apos;Survived&apos;, &apos;Title&apos;,
       &apos;SurnameGroupSize&apos;, &apos;SingleTicketFare&apos;],
      dtype=&apos;object&apos;)
</code></pre><h4 id="women-children-group"><a href="#women-children-group" class="headerlink" title="women-children-group"></a>women-children-group</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">indices_boy_groups = ((one_more_survived_groups.Age &lt;= children_age_upper_limit) &amp; (one_more_survived_groups.Sex == <span class="string">'male'</span>)) | (one_more_survived_groups.Title == <span class="string">'Master'</span>)</span><br><span class="line">indices_female_groups = (one_more_survived_groups.Sex == <span class="string">'female'</span>)</span><br><span class="line"></span><br><span class="line">more_one_survived_wcg = one_more_survived_groups.loc[indices_boy_groups|indices_female_groups]</span><br><span class="line">more_one_survived_wcg.shape[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<pre><code>358
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">indices_female_groups = <span class="keyword">None</span></span><br><span class="line">indices_boy_groups = <span class="keyword">None</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">more_one_survived_wcg.head()</span><br></pre></td></tr></table></figure>
<table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>SurnameGroupId</th><br>      <th>Cabin</th><br>      <th>Pclass</th><br>      <th>Embarked</th><br>      <th>Sex</th><br>      <th>Fare</th><br>      <th>TicketGroupId</th><br>      <th>SibSp</th><br>      <th>Parch</th><br>      <th>Age</th><br>      <th>Survived</th><br>      <th>Title</th><br>      <th>SurnameGroupSize</th><br>      <th>SingleTicketFare</th><br>      <th>CategoricalFare</th><br>      <th>OneBitCabin</th><br>      <th>age_segment</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>279</th><br>      <td>Abbott-3-S-20.25-C.A. 26__</td><br>      <td>Unknown</td><br>      <td>3</td><br>      <td>S</td><br>      <td>female</td><br>      <td>20.25</td><br>      <td>3-S-20.25-C.A. 2673</td><br>      <td>1</td><br>      <td>1</td><br>      <td>35.00</td><br>      <td>1.0</td><br>      <td>Mrs</td><br>      <td>3</td><br>      <td>6.750</td><br>      <td>(6.238, 6.938]</td><br>      <td>U</td><br>      <td>2</td><br>    </tr><br>    <tr><br>      <th>1283</th><br>      <td>Abbott-3-S-20.25-C.A. 26__</td><br>      <td>Unknown</td><br>      <td>3</td><br>      <td>S</td><br>      <td>male</td><br>      <td>20.25</td><br>      <td>3-S-20.25-C.A. 2673</td><br>      <td>0</td><br>      <td>2</td><br>      <td>13.00</td><br>      <td>NaN</td><br>      <td>Master</td><br>      <td>3</td><br>      <td>6.750</td><br>      <td>(6.238, 6.938]</td><br>      <td>U</td><br>      <td>1</td><br>    </tr><br>    <tr><br>      <th>874</th><br>      <td>Abelson-2-C-24.0-P/PP 33__</td><br>      <td>Unknown</td><br>      <td>2</td><br>      <td>C</td><br>      <td>female</td><br>      <td>24.00</td><br>      <td>2-C-24.0-P/PP 3381</td><br>      <td>1</td><br>      <td>0</td><br>      <td>28.00</td><br>      <td>1.0</td><br>      <td>Mrs</td><br>      <td>2</td><br>      <td>12.000</td><br>      <td>(11.0, 13.0]</td><br>      <td>U</td><br>      <td>2</td><br>    </tr><br>    <tr><br>      <th>855</th><br>      <td>Aks-3-S-9.35-3920__</td><br>      <td>Unknown</td><br>      <td>3</td><br>      <td>S</td><br>      <td>female</td><br>      <td>9.35</td><br>      <td>3-S-9.35-392091</td><br>      <td>0</td><br>      <td>1</td><br>      <td>18.00</td><br>      <td>1.0</td><br>      <td>Mrs</td><br>      <td>2</td><br>      <td>4.675</td><br>      <td>(4.65, 5.231]</td><br>      <td>U</td><br>      <td>2</td><br>    </tr><br>    <tr><br>      <th>1198</th><br>      <td>Aks-3-S-9.35-3920__</td><br>      <td>Unknown</td><br>      <td>3</td><br>      <td>S</td><br>      <td>male</td><br>      <td>9.35</td><br>      <td>3-S-9.35-392091</td><br>      <td>0</td><br>      <td>1</td><br>      <td>0.83</td><br>      <td>NaN</td><br>      <td>Master</td><br>      <td>2</td><br>      <td>4.675</td><br>      <td>(4.65, 5.231]</td><br>      <td>U</td><br>      <td>1</td><br>    </tr><br>  </tbody><br></table>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tmp = more_one_survived_wcg.groupby([<span class="string">'SurnameGroupId'</span>]).Survived.mean().value_counts()</span><br><span class="line">tmp</span><br></pre></td></tr></table></figure>
<pre><code>1.00    122
0.00     34
0.75      1
0.50      1
Name: Survived, dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(tmp[<span class="number">1</span>] + tmp[<span class="number">0</span>]) / tmp.values.sum()</span><br></pre></td></tr></table></figure>
<pre><code>0.9873417721518988
</code></pre><h5 id="Pclass-1"><a href="#Pclass-1" class="headerlink" title="Pclass"></a>Pclass</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pylab.rcParams[<span class="string">'figure.figsize'</span>] = (<span class="number">2.0</span>, <span class="number">4.0</span>) </span><br><span class="line">plt.yticks(np.linspace(<span class="number">0.1</span>, <span class="number">1.0</span>, <span class="number">10</span>))</span><br><span class="line">sns.barplot(x=<span class="string">'Pclass'</span>, y=<span class="string">'Survived'</span>, data=more_one_survived_wcg)</span><br></pre></td></tr></table></figure>
<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x2d58a638d68&gt;
</code></pre><p><img src="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_216_1.png" alt="png"></p>
<h5 id="Embarked-1"><a href="#Embarked-1" class="headerlink" title="Embarked"></a>Embarked</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pylab.rcParams[<span class="string">'figure.figsize'</span>] = (<span class="number">5.0</span>, <span class="number">2.0</span>) </span><br><span class="line">plt.xticks(ticks=np.linspace(<span class="number">0.1</span>, <span class="number">1.0</span>, <span class="number">10</span>))</span><br><span class="line">sns.barplot(x=<span class="string">'Survived'</span>, y=<span class="string">'Embarked'</span>, data=more_one_survived_wcg, orient=<span class="string">'h'</span>)</span><br></pre></td></tr></table></figure>
<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x2d58a695e48&gt;
</code></pre><p><img src="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_218_1.png" alt="png"></p>
<h5 id="Cabin-1"><a href="#Cabin-1" class="headerlink" title="Cabin"></a>Cabin</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">more_one_survived_wcg[<span class="string">'Cabin'</span>] = more_one_survived_wcg.Cabin.fillna(<span class="string">"Unknown"</span>)</span><br><span class="line">more_one_survived_wcg[<span class="string">'CabinOneBit'</span>] = more_one_survived_wcg.Cabin.apply(<span class="keyword">lambda</span> x: str(x)[<span class="number">0</span>])</span><br><span class="line">pylab.rcParams[<span class="string">'figure.figsize'</span>] = (<span class="number">8.0</span>, <span class="number">5.0</span>) </span><br><span class="line">plt.xticks(ticks=np.linspace(<span class="number">0.1</span>, <span class="number">1.0</span>, <span class="number">10</span>))</span><br><span class="line">sns.barplot(x=<span class="string">'Survived'</span>, y=<span class="string">'CabinOneBit'</span>, data=more_one_survived_wcg, orient=<span class="string">'h'</span>)</span><br></pre></td></tr></table></figure>
<pre><code>C:\Anaconda3\lib\site-packages\ipykernel\__main__.py:1: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy
  if __name__ == &apos;__main__&apos;:
C:\Anaconda3\lib\site-packages\ipykernel\__main__.py:2: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy
  from ipykernel import kernelapp as app





&lt;matplotlib.axes._subplots.AxesSubplot at 0x2d58917f6a0&gt;
</code></pre><p><img src="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_220_2.png" alt="png"></p>
<h5 id="Fare-2"><a href="#Fare-2" class="headerlink" title="Fare"></a>Fare</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">more_one_survived_wcg[<span class="string">'CategoricalFare'</span>] = pd.qcut(more_one_survived_wcg[<span class="string">'Fare'</span>], <span class="number">10</span>)</span><br><span class="line">fare_survived = more_one_survived_wcg.loc[:,[<span class="string">'CategoricalFare'</span>, <span class="string">'Survived'</span>]].groupby([<span class="string">'CategoricalFare'</span>]).mean()</span><br><span class="line">plt.xticks(rotation=<span class="number">270</span>)</span><br><span class="line">plt.yticks(ticks=np.linspace(<span class="number">0.1</span>, <span class="number">1.0</span>, <span class="number">10</span>))</span><br><span class="line">pylab.rcParams[<span class="string">'figure.figsize'</span>] =(<span class="number">10</span>, <span class="number">5</span>)</span><br><span class="line">sns.barplot(x=<span class="string">'CategoricalFare'</span>, y=<span class="string">'Survived'</span>, data=more_one_survived_wcg, )</span><br><span class="line"><span class="comment">#one_more_survived_groups.drop(['CategoricalFare'], axis = 1, inplace=True)</span></span><br></pre></td></tr></table></figure>
<pre><code>C:\Anaconda3\lib\site-packages\ipykernel\__main__.py:1: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy
  if __name__ == &apos;__main__&apos;:





&lt;matplotlib.axes._subplots.AxesSubplot at 0x2d58a760eb8&gt;
</code></pre><p><img src="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_222_2.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(fare_survived)</span><br></pre></td></tr></table></figure>
<pre><code>                    Survived
CategoricalFare             
(7.749, 14.454]     0.517241
(14.454, 15.98]     0.700000
(15.98, 21.075]     0.645161
(21.075, 26.0]      0.727273
(26.0, 29.125]      0.473684
(29.125, 39.458]    0.583333
(39.458, 61.899]    0.653846
(61.899, 82.046]    0.846154
(82.046, 146.521]   1.000000
(146.521, 512.329]  0.900000
</code></pre><h5 id="Age-2"><a href="#Age-2" class="headerlink" title="Age"></a>Age</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">more_one_survived_wcg.Age.isna().sum() / more_one_survived_wcg.shape[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<pre><code>0.12569832402234637
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getAgeSegment</span><span class="params">(age)</span>:</span></span><br><span class="line">    age_seg = <span class="number">5</span> <span class="comment"># </span></span><br><span class="line">    <span class="keyword">if</span> age &lt;= <span class="number">12</span>: <span class="comment"># children</span></span><br><span class="line">        age_seg = <span class="number">1</span> </span><br><span class="line">    <span class="keyword">elif</span> age &lt;= <span class="number">18</span>: <span class="comment"># adults</span></span><br><span class="line">        age_seg = <span class="number">2</span></span><br><span class="line">    <span class="keyword">elif</span> age &lt;= <span class="number">45</span>:</span><br><span class="line">        age_seg = <span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> age &lt;= <span class="number">60</span>: <span class="comment"># retirement</span></span><br><span class="line">        age_seg = <span class="number">4</span></span><br><span class="line">    <span class="keyword">return</span> np.int32(age_seg)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">more_one_survived_wcg[<span class="string">'AgeSegment'</span>] = more_one_survived_wcg.Age.apply(<span class="keyword">lambda</span> x: getAgeSegment(x))</span><br><span class="line">age_survived = dict(more_one_survived_wcg.groupby([<span class="string">'AgeSegment'</span>]).Survived.mean())</span><br><span class="line">print(age_survived)</span><br><span class="line">plt.xticks(ticks=np.linspace(<span class="number">0.1</span>, <span class="number">1.0</span>, <span class="number">10</span>))</span><br><span class="line">plt.rcParams[<span class="string">'figure.figsize'</span>] = (<span class="number">6</span>, <span class="number">3</span>)</span><br><span class="line">sns.barplot(x=<span class="string">'Survived'</span>, y=<span class="string">'AgeSegment'</span>, data=more_one_survived_wcg, orient=<span class="string">'h'</span>)</span><br></pre></td></tr></table></figure>
<pre><code>{1: 0.5797101449275363, 2: 0.7272727272727273, 3: 0.7767857142857143, 4: 0.8421052631578947, 5: 0.6571428571428571}


C:\Anaconda3\lib\site-packages\ipykernel\__main__.py:1: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy
  if __name__ == &apos;__main__&apos;:





&lt;matplotlib.axes._subplots.AxesSubplot at 0x2d58918e6d8&gt;
</code></pre><p><img src="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_227_3.png" alt="png"></p>
<h4 id="整组幸存情况未知的预测策略"><a href="#整组幸存情况未知的预测策略" class="headerlink" title="整组幸存情况未知的预测策略"></a>整组幸存情况未知的预测策略</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">one_more_survived_groups[one_more_survived_groups.SurnameGroupId.notna()].shape[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<pre><code>606
</code></pre><h3 id="单独出行"><a href="#单独出行" class="headerlink" title="单独出行"></a>单独出行</h3><p>单独出行即 <code>SurnameGroupSize==1</code> 的乘客：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">solo_passengers = all_data.loc[all_data.SurnameGroupSize == <span class="number">1</span>].drop([<span class="string">'Ticket'</span>, <span class="string">'Title'</span>, <span class="string">'Surname'</span>, <span class="string">'SurnameGroupSize'</span>, <span class="string">'TicketGroupSize'</span>, <span class="string">'FamilySize'</span>], axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'the number of solo passengers: %d'</span> % solo_passengers.shape[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>
<pre><code>the number of solo passengers: 659
</code></pre><h4 id="Sex-2"><a href="#Sex-2" class="headerlink" title="Sex"></a>Sex</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plt.rcParams[<span class="string">'figure.figsize'</span>] =(<span class="number">4</span>, <span class="number">4</span>)</span><br><span class="line">sns.barplot(x=<span class="string">'Sex'</span>, y=<span class="string">'Survived'</span>, data=solo_passengers)</span><br></pre></td></tr></table></figure>
<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x2d58a84e160&gt;
</code></pre><p><img src="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_233_1.png" alt="png"></p>
<h4 id="Age-3"><a href="#Age-3" class="headerlink" title="Age"></a>Age</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">solo_passengers[<span class="string">'age_segment'</span>] = solo_passengers.Age.apply(<span class="keyword">lambda</span> x: getAgeSegment(x))</span><br><span class="line">age_survived = dict(solo_passengers.groupby([<span class="string">'age_segment'</span>]).Survived.mean())</span><br><span class="line">print(age_survived)</span><br><span class="line">plt.rcParams[<span class="string">'figure.figsize'</span>] =(<span class="number">5</span>, <span class="number">4</span>)</span><br><span class="line">sns.barplot(x=<span class="string">'age_segment'</span>, y=<span class="string">'Survived'</span>, data=solo_passengers)</span><br></pre></td></tr></table></figure>
<pre><code>{1: nan, 2: 0.41935483870967744, 3: 0.2964426877470356, 4: 0.2894736842105263, 5: 0.23846153846153847}





&lt;matplotlib.axes._subplots.AxesSubplot at 0x2d58a8b4b70&gt;
</code></pre><p><img src="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_235_2.png" alt="png"></p>
<h4 id="Sex-and-Age"><a href="#Sex-and-Age" class="headerlink" title="Sex and Age"></a>Sex and Age</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> mean</span><br><span class="line">sex_age_survived = solo_passengers.groupby([<span class="string">'age_segment'</span>, <span class="string">'Sex'</span>]).Survived.mean()</span><br><span class="line">print(sex_age_survived)</span><br><span class="line">sns.barplot(x=<span class="string">'age_segment'</span>, y=<span class="string">'Survived'</span>, hue=<span class="string">'Sex'</span>, data=solo_passengers, estimator=mean)</span><br></pre></td></tr></table></figure>
<pre><code>age_segment  Sex   
1            male           NaN
2            female    0.785714
             male      0.117647
3            female    0.745098
             male      0.183168
4            female    0.875000
             male      0.133333
5            female    0.720000
             male      0.123810
Name: Survived, dtype: float64





&lt;matplotlib.axes._subplots.AxesSubplot at 0x2d58a91b208&gt;
</code></pre><p><img src="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_237_2.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.barplot(x=<span class="string">'Pclass'</span>, y=<span class="string">'Survived'</span>, hue=<span class="string">'Sex'</span>, data=solo_passengers, estimator=mean)</span><br></pre></td></tr></table></figure>
<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x2d58a947d30&gt;
</code></pre><p><img src="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_238_1.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">solo_passengers[<span class="string">'CategoricalFare'</span>] = pd.qcut(solo_passengers[<span class="string">'Fare'</span>], <span class="number">8</span>)</span><br><span class="line">fare_survived = solo_passengers.loc[:, [<span class="string">'CategoricalFare'</span>, <span class="string">'Survived'</span>]].groupby([<span class="string">'CategoricalFare'</span>]).mean()</span><br><span class="line">print(fare_survived)</span><br><span class="line">plt.xticks(rotation=<span class="number">270</span>)</span><br><span class="line">sns.barplot(x=<span class="string">'CategoricalFare'</span>, y=<span class="string">'Survived'</span>, data=solo_passengers)</span><br><span class="line">solo_passengers.drop([<span class="string">'CategoricalFare'</span>], axis = <span class="number">1</span>, inplace=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure>
<pre><code>                  Survived
CategoricalFare           
(-0.001, 7.25]    0.144928
(7.25, 7.75]      0.339623
(7.75, 7.879]     0.333333
(7.879, 8.05]     0.157895
(8.05, 9.5]       0.142857
(9.5, 13.0]       0.387500
(13.0, 26.55]     0.513514
(26.55, 135.633]  0.431818
</code></pre><p><img src="http://pkaunwk1s.bkt.clouddn.com/gitpages/kaggle/titanic/output_239_1.png" alt="png"></p>
<h4 id="单独出行的男孩"><a href="#单独出行的男孩" class="headerlink" title="单独出行的男孩"></a>单独出行的男孩</h4><p>借此查看一下，所有<code>Master</code>的随行成员数量</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tmp = all_data.loc[index_boy, <span class="string">'SurnameGroupSize'</span>]</span><br><span class="line">tmp.value_counts()</span><br></pre></td></tr></table></figure>
<pre><code>3     23
7      9
6      8
2      6
4      5
5      4
8      3
11     2
1      2
Name: SurnameGroupSize, dtype: int64
</code></pre><p>称谓是 <code>Master</code> 有1个是单独出行的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_data.loc[(index_boy) &amp; (all_data.SurnameGroupSize == <span class="number">1</span>)]</span><br></pre></td></tr></table></figure>
<p><table><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>Age</th><br>      <th>Cabin</th><br>      <th>Embarked</th><br>      <th>Fare</th><br>      <th>Name</th><br>      <th>Parch</th><br>      <th>PassengerId</th><br>      <th>Pclass</th><br>      <th>Sex</th><br>      <th>SibSp</th><br>      <th>…</th><br>      <th>Ticket</th><br>      <th>TicketSize</th><br>      <th>SingleTicketFare</th><br>      <th>Title</th><br>      <th>Surname</th><br>      <th>FamilySize</th><br>      <th>SurnameGroupId</th><br>      <th>TicketGroupId</th><br>      <th>SurnameGroupSize</th><br>      <th>TicketGroupSize</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>912</th><br>      <td>9.0</td><br>      <td>NaN</td><br>      <td>S</td><br>      <td>3.1708</td><br>      <td>Olsen, Master. Artur Karl</td><br>      <td>1</td><br>      <td>913</td><br>      <td>3</td><br>      <td>male</td><br>      <td>0</td><br>      <td>…</td><br>      <td>C 17368</td><br>      <td>1</td><br>      <td>3.1708</td><br>      <td>Master</td><br>      <td>Olsen</td><br>      <td>4</td><br>      <td>Olsen-3-S-3.1708-C 173__</td><br>      <td>3-S-3.1708-C 17368</td><br>      <td>1</td><br>      <td>1</td><br>    </tr><br>    <tr><br>      <th>1230</th><br>      <td>NaN</td><br>      <td>NaN</td><br>      <td>C</td><br>      <td>7.2292</td><br>      <td>Betros, Master. Seman</td><br>      <td>0</td><br>      <td>1231</td><br>      <td>3</td><br>      <td>male</td><br>      <td>0</td><br>      <td>…</td><br>      <td>2622</td><br>      <td>1</td><br>      <td>7.2292</td><br>      <td>Master</td><br>      <td>Betros</td><br>      <td>2</td><br>      <td>Betros-3-C-7.2292-26__</td><br>      <td>3-C-7.2292-2622</td><br>      <td>1</td><br>      <td>1</td><br>    </tr><br>  </tbody><br></table></p>
<p>2 rows × 21 columns</p>

<h4 id="单独出行的女性"><a href="#单独出行的女性" class="headerlink" title="单独出行的女性"></a>单独出行的女性</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tmp = train.loc[(train.Sex == <span class="string">'female'</span>) &amp; (train.SurnameGroupSize == <span class="number">1</span>), <span class="string">'Survived'</span>].value_counts()</span><br><span class="line">tmp</span><br></pre></td></tr></table></figure>
<pre><code>1.0    74
0.0    24
Name: Survived, dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmp[<span class="number">0</span>]/ tmp.values.sum()</span><br></pre></td></tr></table></figure>
<pre><code>0.24489795918367346
</code></pre><h3 id="最后的特征"><a href="#最后的特征" class="headerlink" title="最后的特征"></a>最后的特征</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_data.columns</span><br></pre></td></tr></table></figure>
<pre><code>Index([&apos;Age&apos;, &apos;Cabin&apos;, &apos;Embarked&apos;, &apos;Fare&apos;, &apos;Name&apos;, &apos;Parch&apos;, &apos;PassengerId&apos;,
       &apos;Pclass&apos;, &apos;Sex&apos;, &apos;SibSp&apos;, &apos;Survived&apos;, &apos;Ticket&apos;, &apos;TicketSize&apos;,
       &apos;SingleTicketFare&apos;, &apos;Title&apos;, &apos;Surname&apos;, &apos;FamilySize&apos;, &apos;SurnameGroupId&apos;,
       &apos;TicketGroupId&apos;, &apos;SurnameGroupSize&apos;, &apos;TicketGroupSize&apos;],
      dtype=&apos;object&apos;)
</code></pre><h3 id="K折交叉验证"><a href="#K折交叉验证" class="headerlink" title="K折交叉验证"></a>K折交叉验证</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">custom_cv</span><span class="params">(dataset, num_fold = <span class="number">5</span>, verbose = False, num_trial = <span class="number">5</span>)</span>:</span></span><br><span class="line">    sum_accuracy_all_trial = <span class="number">0.0</span></span><br><span class="line">    size_test_set_in_cv = dataset.shape[<span class="number">0</span>] // num_fold    </span><br><span class="line">    engineeringFeatures(dataset, verbose)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, num_trial):</span><br><span class="line">        sum_accuracy_per_trial = <span class="number">0.0</span></span><br><span class="line">        all_set_in_cv = dataset.sample(n = train.shape[<span class="number">0</span>], random_state= i)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>, num_fold):</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># get indices of test set and train set in cross validation</span></span><br><span class="line">            start_index_test_set = j * size_test_set_in_cv</span><br><span class="line">            indices_test_set_in_cv = np.linspace(<span class="number">0</span>, size_test_set_in_cv - <span class="number">1</span>, num = size_test_set_in_cv, dtype=np.int32) + start_index_test_set</span><br><span class="line">            indices_train_set_in_cv = all_set_in_cv.drop(labels=indices_test_set_in_cv).index</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># get WomanChildGroupSurvived in train set </span></span><br><span class="line">            getWomanChildrenGroupSurvived(all_set_in_cv, indices_train_set_in_cv)</span><br><span class="line">            <span class="comment"># set WomanChildGroupSurvived in test set</span></span><br><span class="line">            setWomenChildGroupSurvivedInTestSet(all_set_in_cv, indices_test_set_in_cv)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># get SurnameGroupSurvived</span></span><br><span class="line">            <span class="comment">#getSurnameGroupSurvived(all_set_in_cv, indices_train_set_in_cv)</span></span><br><span class="line">            <span class="comment">#setSurnameGroupSurvivedInTestSet(all_set_in_cv, indices_test_set_in_cv)</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># female and boy rules</span></span><br><span class="line">            all_set_in_cv = predictionByWomanBoyRules(all_set_in_cv)</span><br><span class="line"></span><br><span class="line">            accuracy_per_time = np.sum(all_set_in_cv.iloc[indices_test_set_in_cv, :].Predict.astype(np.int32).values == all_set_in_cv.iloc[indices_test_set_in_cv, :].Survived.astype(np.int32).values) / size_test_set_in_cv</span><br><span class="line">            sum_accuracy_per_trial += accuracy_per_time  </span><br><span class="line">            <span class="comment"># the end of for j in range(0, num_fold)</span></span><br><span class="line">            </span><br><span class="line">        sum_accuracy_per_trial = sum_accuracy_per_trial / num_fold</span><br><span class="line">        sum_accuracy_all_trial += sum_accuracy_per_trial</span><br><span class="line">        <span class="keyword">if</span> verbose == <span class="keyword">True</span>:</span><br><span class="line">            print(<span class="string">"Trial %d has %d-fold CV accuracy = %f"</span> % (i + <span class="number">1</span>, num_fold, sum_accuracy_per_trial)) </span><br><span class="line">        <span class="comment"># the end of for i in range(0, num_trial)</span></span><br><span class="line">        </span><br><span class="line">    print(<span class="string">'Average accuracy in trials of total %d times  = %f'</span> % (num_trial, sum_accuracy_all_trial / num_trial))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">custom_cv(num_fold = <span class="number">10</span>, verbose = <span class="keyword">True</span>, num_trial = <span class="number">10</span>, dataset = pd.read_csv(<span class="string">'./data/train.csv'</span>))</span><br></pre></td></tr></table></figure>
<pre><code>Tottaly 179 solo passengers satifies the condtions
Totally adding 46  nannies, cousins and firends to surname groups
Trial 1 has 10-fold CV accuracy = 0.865169
Trial 2 has 10-fold CV accuracy = 0.866292
Trial 3 has 10-fold CV accuracy = 0.866292
Trial 4 has 10-fold CV accuracy = 0.860674
Trial 5 has 10-fold CV accuracy = 0.865169
Trial 6 has 10-fold CV accuracy = 0.864045
Trial 7 has 10-fold CV accuracy = 0.866292
Trial 8 has 10-fold CV accuracy = 0.865169
Trial 9 has 10-fold CV accuracy = 0.862921
Trial 10 has 10-fold CV accuracy = 0.864045
Average accuracy in trials of total 10 times  = 0.864607
</code></pre><h3 id="预测"><a href="#预测" class="headerlink" title="预测"></a>预测</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#getSurnameGroupSurvived(all_data, train.index)</span></span><br><span class="line"><span class="comment">#setSurnameGroupSurvivedInTestSet(all_data, test.index)</span></span><br><span class="line"></span><br><span class="line">all_data[<span class="string">'WomanChildGroupSurvived'</span>] = np.NaN</span><br><span class="line">getWomanChildrenGroupSurvived(all_data, train.index)</span><br><span class="line">setWomenChildGroupSurvivedInTestSet(all_data, test.index)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_data.columns</span><br></pre></td></tr></table></figure>
<pre><code>Index([&apos;Age&apos;, &apos;Cabin&apos;, &apos;Embarked&apos;, &apos;Fare&apos;, &apos;Name&apos;, &apos;Parch&apos;, &apos;PassengerId&apos;,
       &apos;Pclass&apos;, &apos;Sex&apos;, &apos;SibSp&apos;, &apos;Survived&apos;, &apos;Ticket&apos;, &apos;TicketSize&apos;,
       &apos;SingleTicketFare&apos;, &apos;Title&apos;, &apos;Surname&apos;, &apos;FamilySize&apos;, &apos;SurnameGroupId&apos;,
       &apos;TicketGroupId&apos;, &apos;SurnameGroupSize&apos;, &apos;TicketGroupSize&apos;,
       &apos;SurnameGroupSurvived&apos;, &apos;WomanChildGroupSurvived&apos;, &apos;WomanChildGroupId&apos;],
      dtype=&apos;object&apos;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">all_data = predictionByWomanBoyRules(all_data)</span><br><span class="line">np.sum(all_data.Predict[:train.shape[<span class="number">0</span>]] == all_data.Survived[:train.shape[<span class="number">0</span>]]) / train.shape[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<pre><code>0.8720538720538721
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PassengerId = np.array(range(<span class="number">892</span>, <span class="number">892</span> + test.shape[<span class="number">0</span>]))</span><br><span class="line">submission = pd.DataFrame(&#123;<span class="string">"PassengerId"</span>: PassengerId, <span class="string">"Survived"</span>: all_data.Predict[train.shape[<span class="number">0</span>]:].astype(np.int32)&#125;)</span><br><span class="line">submission.index=range(<span class="number">0</span>, test.shape[<span class="number">0</span>])</span><br><span class="line">submission.to_csv(<span class="string">'./data/'</span> + <span class="string">"2.csv"</span>, index=<span class="keyword">False</span>)</span><br></pre></td></tr></table></figure></class></table>
      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:</strong>
    SnailDove
  </li>
  <li class="post-copyright-link">
    <strong>Post link:</strong>
    <a href="https://snaildove.github.io/2019/01/06/name_and_sex/" title="kaggle首战Titanic 82.275%">https://snaildove.github.io/2019/01/06/name_and_sex/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice: </strong>
    All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> unless stating additionally.
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/kaggle/" rel="tag"><i class="fa fa-tag"></i> kaggle</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        

        

        
          
          <div id="needsharebutton-postbottom">
            <span class="btn">
              <i class="fa fa-share-alt" aria-hidden="true"></i>
            </span>
          </div>
        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/12/28/foundations_of_spark_programming/" rel="next" title="spark编程基础笔记">
                <i class="fa fa-chevron-left"></i> spark编程基础笔记
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zMjg4NC85NDQ1"></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="SnailDove" />
            
              <p class="site-author-name" itemprop="name">SnailDove</p>
              <p class="site-description motion-element" itemprop="description">keep enthusiasm</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">105</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">24</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            
            
			<script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>
			<script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>
			<div class="widget-wrap">
				<h4 class="widget-title">Tag Cloud</h4>
					<div id="myCanvasContainer" class="widget tagcloud">
					<canvas width="250" height="250" id="resCanvas" style="width=100%">
						<ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Basic-Algorithm/">Basic Algorithm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Calculus-and-Differential/">Calculus and Differential</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Data-Structure/">Data Structure</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Improving-Deep-Neural-Networks/">Improving Deep Neural Networks</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Information-Theory/">Information Theory</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Latex/">Latex</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Machine-Learning/">Machine Learning</a><span class="tag-list-count">26</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Machine-Learning-by-Andrew-NG/">Machine Learning by Andrew NG</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python-Data-Science-Cookbook/">Python Data Science Cookbook</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Structuring-Machine-Learning-Projects/">Structuring Machine Learning Projects</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/convolutional-neural-networks/">convolutional-neural-networks</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/deep-learning/">deep learning</a><span class="tag-list-count">41</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/english/">english</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kaggle/">kaggle</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linear-algebra/">linear_algebra</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/neural-networks-deep-learning/">neural-networks-deep-learning</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nlp-sequence-models/">nlp-sequence-models</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/probability/">probability</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spark/">spark</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/统计学习方法/">统计学习方法</a><span class="tag-list-count">4</span></li></ul>
					</canvas>
				</div>
			</div>
			
          </nav>
          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="mailto:ruitongbao@yeah.net" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://weibo.com/brt10" target="_blank" title="Weibo">
                      
                        <i class="fa fa-fw fa-weibo"></i>Weibo</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://ocw.mit.edu/courses/mathematics/18-06sc-linear-algebra-fall-2011/" title="Linear Algebra on MIT" target="_blank">Linear Algebra on MIT</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://ocw.mit.edu/courses/mathematics/18-05-introduction-to-probability-and-statistics-spring-2014/" title="Probability-and-statistics on MIT" target="_blank">Probability-and-statistics on MIT</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#读取数据"><span class="nav-text">读取数据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#查看数据集基本信息"><span class="nav-text">查看数据集基本信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看缺失数据"><span class="nav-text">查看缺失数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看特征的分布信息"><span class="nav-text">查看特征的分布信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Fare"><span class="nav-text">Fare</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sex"><span class="nav-text">Sex</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Age"><span class="nav-text">Age</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#undefined"><span class="nav-text"> 目标 </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Name"><span class="nav-text">Name</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#提取称谓字段Title"><span class="nav-text">提取称谓字段Title</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Master"><span class="nav-text">Master</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Title的性别分布"><span class="nav-text">Title的性别分布</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#提取姓氏字段-Surname"><span class="nav-text">提取姓氏字段 Surname</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#提取FamilySize"><span class="nav-text">提取FamilySize</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#遇难的女性所在的分组情况："><span class="nav-text">遇难的女性所在的分组情况：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#幸存的女性所在的分组情况："><span class="nav-text">幸存的女性所在的分组情况：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#遇难的男孩所在的分组情况"><span class="nav-text">遇难的男孩所在的分组情况</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#幸存男孩所在的分组"><span class="nav-text">幸存男孩所在的分组</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#幸存成年男性所在分组情况"><span class="nav-text">幸存成年男性所在分组情况</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#遇难成年男性所在分组情况"><span class="nav-text">遇难成年男性所在分组情况</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#整组幸存情况都未知"><span class="nav-text">整组幸存情况都未知</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#至少一个人生存情况可知的组"><span class="nav-text">至少一个人生存情况可知的组</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Pclass"><span class="nav-text">Pclass</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Embarked"><span class="nav-text">Embarked</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Fare-1"><span class="nav-text">Fare</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Cabin"><span class="nav-text">Cabin</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Sex-1"><span class="nav-text">Sex</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Age-1"><span class="nav-text">Age</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#women-children-group"><span class="nav-text">women-children-group</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Pclass-1"><span class="nav-text">Pclass</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Embarked-1"><span class="nav-text">Embarked</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Cabin-1"><span class="nav-text">Cabin</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Fare-2"><span class="nav-text">Fare</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Age-2"><span class="nav-text">Age</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#整组幸存情况未知的预测策略"><span class="nav-text">整组幸存情况未知的预测策略</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#单独出行"><span class="nav-text">单独出行</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Sex-2"><span class="nav-text">Sex</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Age-3"><span class="nav-text">Age</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Sex-and-Age"><span class="nav-text">Sex and Age</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#单独出行的男孩"><span class="nav-text">单独出行的男孩</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#单独出行的女性"><span class="nav-text">单独出行的女性</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#最后的特征"><span class="nav-text">最后的特征</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#K折交叉验证"><span class="nav-text">K折交叉验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#预测"><span class="nav-text">预测</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">SnailDove</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count</span>
    
    <span title="Site words total count">581.4k</span>
  
</div>



<!-- 
注释掉底部hexo主题提示:强有力


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




-->

        
<div class="busuanzi-count">
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="post-meta-item-text">Visitors</span>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
	  <span class="post-meta-item-text">Total hits</span>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  









  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three-waves.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  










  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">

  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
      pbOptions = {};
      
          pbOptions.iconStyle = "box";
      
          pbOptions.boxForm = "horizontal";
      
          pbOptions.position = "bottomCenter";
      
          pbOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
  </script>

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

  
  <!-- 添加网站宠物 -->
  
<div id="hexo-helper-live2d">
  <canvas id="live2dcanvas" width="150" height="300"></canvas>
</div>
<style>
  #live2dcanvas{
    position: fixed;
    width: 150px;
    height: 300px;
    opacity:0.7;
    right: 0px;
    z-index: 999;
    pointer-events: none;
    bottom: -20px;
  }
</style>
<script type="text/javascript" src="/live2d/device.min.js"></script>
<script type="text/javascript">
const loadScript = function loadScript(c,b){var a=document.createElement("script");a.type="text/javascript";"undefined"!=typeof b&&(a.readyState?a.onreadystatechange=function(){if("loaded"==a.readyState||"complete"==a.readyState)a.onreadystatechange=null,b()}:a.onload=function(){b()});a.src=c;document.body.appendChild(a)};
(function(){
  if((typeof(device) != 'undefined') && (device.mobile())){
    document.getElementById("live2dcanvas").style.width = '75px';
    document.getElementById("live2dcanvas").style.height = '150px';
  }else
    if (typeof(device) === 'undefined') console.error('Cannot find current-device script.');
  loadScript("/live2d/script.js", function(){loadlive2d("live2dcanvas", "/live2d/assets/z16.model.json", 0.5);});
})();
</script>

  
</body>
<!--崩溃欺骗-->
<script type="text/javascript" src="/js/src/crash_cheat.js"></script>
</html>
